<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="An overview of all TADA Module 1 functions and a recommended workflow.">
<title>TADA Module 1: Water Quality Portal Data Discovery and Cleaning • TADA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TADA Module 1: Water Quality Portal Data Discovery and Cleaning">
<meta property="og:description" content="An overview of all TADA Module 1 functions and a recommended workflow.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TADA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CONTRIBUTING.html">Contributing</a>
    <a class="dropdown-item" href="../articles/TADAModule1_AdvancedTraining.html">TADA Module 1: Training for Intermediate/Advanced R Users</a>
    <a class="dropdown-item" href="../articles/TADAModule1_BeginnerTraining.html">TADA Module 1: Training for Beginner R Users</a>
    <a class="dropdown-item" href="../articles/TADAModule1.html">TADA Module 1: Water Quality Portal Data Discovery and Cleaning</a>
    <a class="dropdown-item" href="../articles/TADAModule2.html">TADA Module 2: Geospatial Functions</a>
    <a class="dropdown-item" href="../articles/WQXValidationService.html">WQX QAQC Service User Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/TADA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>TADA Module 1: Water Quality Portal Data Discovery and Cleaning</h1>
                        <h4 data-toc-skip class="author">TADA Team</h4>
            
            <h4 data-toc-skip class="date">2024-04-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/TADA/blob/HEAD/vignettes/TADAModule1.Rmd" class="external-link"><code>vignettes/TADAModule1.Rmd</code></a></small>
      <div class="d-none name"><code>TADAModule1.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette walks through how to use the TADA R Package to discover
and clean (i.e., wrangle, Quality Assure and Quality Control (QAQC), and
harmonize) <a href="https://www.waterqualitydata.us/" class="external-link">Water Quality
Portal (WQP)</a> data from multiple organizations.</p>
</div>
<div class="section level2">
<h2 id="install-and-load-packages">Install and load packages<a class="anchor" aria-label="anchor" href="#install-and-load-packages"></a>
</h2>
<p>First, install and load the remotes package specifying the repo. This
is needed before installing TADA because it is only available on GitHub
(not CRAN).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span>,</span>
<span>  repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, install and load TADA using the remotes package. USGS’s
dataRetrieval and other TADA R Package dependencies will also be
downloaded automatically from CRAN with the TADA install. If desired,
the development version of dataRetrieval can be downloaded directly from
GitHub (un-comment).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADA"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remotes::install_github("USGS-R/dataRetrieval", dependencies=TRUE)</span></span>
<span></span>
<span><span class="co"># if you experience any issues installing TADA, try un-commenting and running</span></span>
<span><span class="co"># the line below before the install</span></span>
<span><span class="co"># options(download.file.method = "wininet")</span></span></code></pre></div>
<p>Finally, use the <strong>library()</strong> function to load the TADA
R Package into your R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/TADA/">TADA</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-wqp-data">Retrieve WQP data<a class="anchor" aria-label="anchor" href="#retrieve-wqp-data"></a>
</h2>
<p>WQP data is retrieved and processed for compatibility with TADA. This
function, <strong>TADA_DataRetrieval</strong>, builds on USGS’s
dataRetrieval R package functions. It joins three WQP profiles: Site,
Sample Results (physical/chemical metadata), and Project. In addition,
it changes all data in the Characteristic, Speciation, Fraction, and
Unit fields to uppercase, removes exact duplicates, and addresses result
values that include special characters.</p>
<p>This function uses the same inputs as the dataRetrieval
<code>readWQPdata</code> function. <code>readWQPdata</code> does not
restrict the characteristics pulled from <a href="https://www.waterqualitydata.us/" class="external-link">Water Quality Portal
(WQP)</a>.</p>
<p>Data retrieval filters include:</p>
<ul>
<li><p>startDate</p></li>
<li><p>endDate</p></li>
<li><p>characteristicName</p></li>
<li><p>sampleMedia</p></li>
<li><p>siteType</p></li>
<li><p>statecode (review list of possible state and territory <a href="https://www2.census.gov/geo/docs/reference/state.txt" class="external-link">abbreviations</a>)</p></li>
<li><p>countycode</p></li>
<li><p>siteid</p></li>
<li><p>organization</p></li>
<li><p>project</p></li>
<li><p>huc</p></li>
<li><p>characteristicType</p></li>
</ul>
<p>The default TADA_DataRetrieval function automatically runs the
<strong>TADA_AutoClean</strong> function. In this example, we will set
<strong>TADA_AutoClean = FALSE</strong> and run it as a separate step in
the work flow.</p>
<p>Tips:</p>
<ol style="list-style-type: decimal">
<li>
<p>All the query filters for the WQP work as an AND but within the
fields there are ORs. For example:</p>
<ul>
<li><p>Characteristics: If you choose pH &amp; DO - it’s an OR. This
means you will retrieve both pH OR DO data if available.</p></li>
<li><p>States: Similarly, if you choose VA and IL, it’s an OR. This
means you will retrieve both VA OR IL data if available.</p></li>
<li><p>Combinations of fields are ANDs, such as State/VA AND
Characteristic/DO”. This means you will receive all DO data available in
VA.</p></li>
<li><p>“Characteristic” and “Characteristic Type” also work as an AND.
This means that the Characteristic must fall within the
CharacteristicGroup if both filters are being used, if not you will get
an error.</p></li>
</ul>
</li>
<li><p>The “siteid” is a general term WQP uses to describe both Site IDs
from USGS databases and Monitoring Location Identifiers (from WQX). Each
monitoring location in the Water Quality Portal (WQP) has a unique
Monitoring Location Identifier, regardless of the database from which it
derives. The Monitoring Location Identifier from the WQP is the
concatenated Organization Identifier plus the Site ID number. Site IDs
that only include a number are only unique identifiers for monitoring
locations within USGS NWIS or EPA’s WQX databases separately.</p></li>
</ol>
<p>Additional resources:</p>
<ul>
<li><p>Review function documentation by entering the following code into
the console: ?TADA_DataRetrieval</p></li>
<li><p><a href="https://CRAN.R-project.org/package=dataRetrieval" class="external-link">Introduction to
the dataRetrieval package</a></p></li>
<li><p><a href="https://rdrr.io/cran/dataRetrieval/man/readWQPdata.html" class="external-link">General
Data Import from Water Quality Portal</a></p></li>
<li><p><a href="https://www.waterqualitydata.us/webservices_documentation/" class="external-link">Water
Quality Portal Web Services Guide</a></p></li>
<li><p><a href="https://owi.usgs.gov/R/dataRetrieval.html" class="external-link">dataRetrieval
Tutorial</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="dataretrieval">dataRetrieval<a class="anchor" aria-label="anchor" href="#dataretrieval"></a>
</h2>
<p>Uncomment below if you would like to review differences between the
profiles you would get using readWQPdata vs. TADA_DataRetrieval. The
profiles are different because TADA_DataRetrieval automatically joins in
data from multiple WQP profiles, and does some additional data cleaning
as part of the data retrieval process.</p>
<p>This example includes monitoring data collected from Jan 2018 to Jan
2019 by six organizations: 1) Red Lake Band of Chippewa Indians, 2) Sac
&amp; Fox Nation, 3) Pueblo of Pojoaque, 4) Minnesota Chippewa Tribe
(Fond du Lac Band), 5) Pueblo of Tesuque, and 6) The Chickasaw
Nation</p>
<p>We will move forward with this example in the remainder of the
vignette.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dataRetrieval_example &lt;- dataRetrieval::readWQPdata(organization = c("REDLAKE_WQX", "SFNOES_WQX", "PUEBLO_POJOAQUE", "FONDULAC_WQX", "PUEBLOOFTESUQUE", "CNENVSER"), startDate = "2018-01-01", endDate = "2019-01-01", ignore_attributes = TRUE)</span></span></code></pre></div>
<p>Use the code below to download data from the WQP using
TADA_DataRetrieval. Edit the code chuck below to define your own WQP
query inputs.</p>
<p>Downloads using TADA_DataRetrieval will have the same columns each
time, but be aware that data are uploaded to the Water Quality Portal by
individual organizations, which may or may not follow the same
conventions. Data and metadata quality are not guaranteed! Make sure to
carefully explore any data and make conservative quality assurance
decisions where information is limited.</p>
<p>Note: TADA_DataRetrieval (by leveraging dataRetrieval), automatically
converts the date times to UTC. It also automatically converts the data
to dates, datetimes, and numerics based on a standard algorithm.</p>
<p>Enter ?TADA_DataRetrieval into the console to review more example
queries and additional information.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_DataRetrieval.html">TADA_DataRetrieval</a></span><span class="op">(</span>organization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REDLAKE_WQX"</span>, <span class="st">"SFNOES_WQX"</span>, <span class="st">"PUEBLO_POJOAQUE"</span>, <span class="st">"FONDULAC_WQX"</span>, <span class="st">"PUEBLOOFTESUQUE"</span>, <span class="st">"CNENVSER"</span><span class="op">)</span>, startDate <span class="op">=</span> <span class="st">"2018-01-01"</span>, endDate <span class="op">=</span> <span class="st">"2019-01-01"</span>, applyautoclean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>If you need to download a large amount of data from across a large
area, and the TADA_DataRetrieval function is not working due to WQP
timeout issues, then the <strong>TADA_BigDataRetrieval</strong> function
may work better.</p>
<p>This function does multiple synchronous data calls to the WQP
(waterqualitydata.us). It uses the WQP summary service to limit the
sites downloaded to only those with relevant data. It pulls back data
from set number of stations at a time and then joins the data back
together to produce a single TADA compatible dataframe as the
output.</p>
<p>See ?TADA_BigDataRetrieval for more details. WARNING, some of the
examples below can take multiple HOURS to run. The total run time
depends on your query inputs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># AK_AL_WaterTemp &lt;- TADA_BigDataRetrieval(startDate = "2000-01-01", endDate = "2022-12-31", characteristicName = "Temperature, water", statecode = c("AK","AL"))</span></span>
<span></span>
<span><span class="co"># AllWaterTemp &lt;- TADA_BigDataRetrieval(characteristicName = "Temperature, water")</span></span>
<span></span>
<span><span class="co"># AllPhosphorus &lt;- TADA_BigDataRetrieval(characteristicName = "Phosphorus")</span></span>
<span></span>
<span><span class="co"># AllCT &lt;- TADA_BigDataRetrieval(statecode = "CT")</span></span></code></pre></div>
<p>Some TADA users are interested in using WQP data for surface water
only or for analysis of some non-water data. The
<strong>TADA_AnalysisDataFilter</strong> function can assist in
identifying results of interest. Multiple columns are used to identify
groundwater results as different organizations may populate different
combinations of fields in order to identify a result as groundwater.</p>
<p>This function identifies surface water, groundwater, and sediment
results. Users can specify whether all results should be returned with a
new column, <em>TADA.UseForAnalysis.Flag</em>,identifying if the result
should be included in further analysis or if only results that should be
in included are returned.</p>
<p>The defaults are to include surface water, exclude groundwater and
sediment, and to return only the results that should be used for
analysis (clean = TRUE). This is shown in the active example below. If
you would like to see all results with the
<em>TADA.UseForAnalysis.Flag</em> column, you can uncomment the example
where clean = FALSE.</p>
<p>If you are not interested in using
<strong>TADA_AnalysisDataFilter</strong>, but would like to filter by
activity media, uncomment the example to filter for water data only by
using dplyr::filter() with TADA.ActivityMediaName.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to retain only results for use in analysis</span></span>
<span><span class="va">TADAProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AnalysisDataFilter.html">TADA_AnalysisDataFilter</a></span><span class="op">(</span><span class="va">TADAProfile</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  surface_water <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ground_water <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sediment <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add TADA.UseForAnalysis.Flag column to identify which results should be used for analysis</span></span>
<span><span class="co"># TADAProfile &lt;- TADA_AnalysisDataFilter(TADAProfile, clean = FALSE)</span></span>
<span></span>
<span><span class="co"># Remove data for non-water media types, alternate workflow without using TADA_AnalysisDataFilter()</span></span>
<span><span class="co"># TADAProfile &lt;- dplyr::filter(TADAProfile, TADA.ActivityMediaName == "WATER")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="autoclean">AutoClean<a class="anchor" aria-label="anchor" href="#autoclean"></a>
</h2>
<p>Now <strong>TADA_AutoClean</strong> can be run on a smaller dataset
after unnecessary results have been removed. It performs the following
functions on the data retrieved from the WQP:</p>
<ul>
<li><p><strong>TADA_ConvertSpecialChars</strong> - converts result value
columns to numeric and flags non-numeric values that could not be
converted.</p></li>
<li><p><strong>TADA_ConvertResultUnits</strong> - unifies result units
for easier quality control and review</p></li>
<li><p><strong>TADA_ConvertDepthUnits</strong> - converts depth units to
a consistent unit (meters).</p></li>
<li><p><strong>TADA_IDCensoredData</strong> - categorizes detection
limit data and identifies mismatches in result detection condition and
result detection limit type.</p></li>
<li><p>Other helpful actions - converts important text columns to all
upper-case letters, removes exact duplicates, and uses WQX format rules
to harmonize specific NWIS metadata conventions (e.g. move
characteristic speciation from the TADA.ResultMeasure.MeasureUnitCode
column to the TADA.MethodSpeciationName column)</p></li>
</ul>
<p>As a general rule, TADA functions do not change any contents in the
WQP-served columns. Instead, they add new columns with the prefix
“TADA.” The following columns are numeric versions of their WQP
origins:</p>
<pre><code><span><span class="op">-</span>   <span class="va">TADA.ResultMeasureValue</span></span>
<span></span>
<span><span class="op">-</span>   <span class="va">TADA.DetectionQuantitationLimitMeasure.MeasureValue</span></span>
<span></span>
<span><span class="op">-</span>   <span class="va">TADA.LatitudeMeasure</span></span>
<span></span>
<span><span class="op">-</span>   <span class="va">TADA.LongitudeMeasure</span></span></code></pre>
<p>These functions also add the columns
TADA.ResultMeasureValueDataTypes.Flag and
TADA.DetectionQuantitationLimitMeasure.MeasureValueDataTypes.Flag, which
provide information about the result values that is needed to address
censored data later on (i.e., nondetections). Specifically, these new
columns flag if special characters are included in result values, and
specifies what the special characters are.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run TADA_AutoClean on filtered dataset to convert special characters, result units, and depth units and identify censored data.</span></span>
<span></span>
<span><span class="va">TADAProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AutoClean.html">TADA_AutoClean</a></span><span class="op">(</span><span class="va">TADAProfile</span><span class="op">)</span></span></code></pre></div>
<p>Review all column names in the TADA Profile to familiarize yourself
with the dataset after TADA_AutoClean has added additional TADA prefixed
columns. <strong>TADA_SummarizeColumn</strong> summarizes the data set
based on the user specified column and returns a dataframe displaying
the number of sites and number of records for each unique value in the
specified column. The example below uses TADA.CharacteristicName.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View column names for TADAProfile</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">TADAProfile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review the number of sites and number of records for each CharacteristicName in TADAProfile</span></span>
<span><span class="va">TADAProfile_CharSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SummarizeColumn.html">TADA_SummarizeColumn</a></span><span class="op">(</span><span class="va">TADAProfile</span>, <span class="st">"TADA.CharacteristicName"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View TADAProfile_CharSummary</span></span>
<span><span class="va">TADAProfile_CharSummary</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="invalid-coordinates">Invalid coordinates<a class="anchor" aria-label="anchor" href="#invalid-coordinates"></a>
</h2>
<p>Review station locations and summary information using the
<strong>TADA_OverviewMap</strong> function.
<strong>TADA_OverviewMap</strong> counts the number of unique results,
characteristics, and organizations at each monitoring location in the
dataset and creates a tidy map for reviewing summary stats spatially.
Larger point sizes indicate more results collected at a given site,
while darker blue colors indicate more unique characteristics collected
at the site. Users may click on a site to view a pop-up with this
summary information, including the number of organizations that reported
results at that site. This map may inform a user’s decision to
remove/correct sites that are outside the US.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_OverviewMap.html">TADA_OverviewMap</a></span><span class="op">(</span><span class="va">TADAProfile</span><span class="op">)</span></span></code></pre></div>
<p>The TADA <strong>TADA_FlagCoordinates</strong> function identifies
and flags potentially invalid coordinate data. While its functionality
is showcased here, it is always important to review any invalid outputs
before cleaning to reduce the risk of leaving out usable data/sites.</p>
<p>Allowable values for clean_outsideUSA are “no”, “remove”, or “change
sign”. The default is “no” which flags latitude and longitude
coordinates outside the USA. Assigning clean_ousideUSA = “remove” will
remove rows of data with coordinates outside the USA. And assigning
clean_outsideUSA = “change sign” will flip the sign of latitude or
longitude coordinates flagged as outside the USA. The “change sign”
option should only be used when it is known that coordinates were
entered with the wrong sign in WQX; additionally, the data owner should
fix these incorrect coordinates in the raw data through the WQX - for
assistance email the WQX help desk: WQX@epa.gov</p>
<p>Allowable values for clean_imprecise are TRUE or FALSE. The default
is FALSE which flags rows of data with invalid or imprecise coordinates
without removing them. Assigning clean_imprecise = TRUE will remove rows
of data with invalid or imprecise coordinates.</p>
<p>Allowable values for flaggedonly are TRUE or FALSE. The default is
FALSE which keeps all rows of data regardless of flag status. Assigning
flaggedonly = TRUE filters the dataframe to show only rows of data which
are flagged.</p>
<p>When clean_outsideUSA = “no” and/or clean_imprecise = FALSE, a column
will be appended titled “TADA.InvalidCoordinates.Flag” with the
following flags (if relevant to dataframe):</p>
<ul>
<li><p>If the latitude is less than zero, the row will be flagged with
“LAT_OutsideUSA”. (Exception for American Samoa)</p></li>
<li><p>If the longitude is greater than zero AND less than 145, the row
will be flagged as “LONG_OutsideUSA”. (Exceptions for Guam and the
Northern Mariana Islands)</p></li>
<li><p>If the latitude or longitude contains the string, “999”, the row
will be flagged as invalid.</p></li>
<li><p>Finally, precision can be measured by the number of decimal
places in the latitude and longitude provided. If either does not have
any numbers to the right of the decimal point, the row will be flagged
as “Imprecise”.</p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flag only</span></span>
<span><span class="va">TADAProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagCoordinates.html">TADA_FlagCoordinates</a></span><span class="op">(</span><span class="va">TADAProfile</span>, clean_outsideUSA <span class="op">=</span> <span class="st">"no"</span>, clean_imprecise <span class="op">=</span> <span class="cn">FALSE</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># review unique flags in TADAProfileClean1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean1</span><span class="op">$</span><span class="va">TADA.InvalidCoordinates.Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># review unique MonitoringLocationIdentifiers in your flag dataframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean1</span><span class="op">$</span><span class="va">MonitoringLocationIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Unique_InvalidCoordinateFlags</span> <span class="op">&lt;-</span> <span class="va">TADAProfileClean1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"MonitoringLocationIdentifier"</span>,</span>
<span>    <span class="st">"MonitoringLocationName"</span>,</span>
<span>    <span class="st">"TADA.InvalidCoordinates.Flag"</span>,</span>
<span>    <span class="st">"OrganizationIdentifier"</span>,</span>
<span>    <span class="st">"TADA.LongitudeMeasure"</span>,</span>
<span>    <span class="st">"TADA.LatitudeMeasure"</span>,</span>
<span>    <span class="st">"MonitoringLocationTypeName"</span>,</span>
<span>    <span class="st">"CountryCode"</span>,</span>
<span>    <span class="st">"StateCode"</span>,</span>
<span>    <span class="st">"CountyCode"</span>,</span>
<span>    <span class="st">"HUCEightDigitCode"</span>,</span>
<span>    <span class="st">"MonitoringLocationDescriptionText"</span>,</span>
<span>    <span class="st">"ProjectName"</span>,</span>
<span>    <span class="st">"ProjectIdentifier"</span>,</span>
<span>    <span class="st">"OrganizationFormalName"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Unique_InvalidCoordinateFlags</span></span>
<span></span>
<span><span class="co"># if needed, un-comment below to change the sign for all data for sites flagged as outside the USA. You can also change FALSE to TRUE if you want to remove sites outside of the US or sites with imprecise lat/longs</span></span>
<span></span>
<span><span class="co"># TADAProfileClean1 &lt;- TADA_FlagCoordinates(TADAProfile, clean_outsideUSA = "change sign", clean_imprecise = FALSE, flaggedonly = FALSE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="depth-unit-conversions">Depth unit conversions<a class="anchor" aria-label="anchor" href="#depth-unit-conversions"></a>
</h2>
<p>The <strong>TADA_ConvertDepthUnits</strong> function converts depth
units to a consistent unit. Depth values and units are most commonly
associated with lake data, and are populated in the
<em>ActivityDepthHeightMeasure</em>,
<em>ActivityTopDepthHeightMeasure</em>,
<em>ActivityBottomDepthHeightMeasure</em>, and
<em>ResultDepthHeightMeasure</em> Result Value/Unit columns.</p>
<p>Allowable values for ‘unit’ are either ‘m’ (meter), ‘ft’ (feet), or
‘in’ (inch). ‘unit’ accepts only one allowable value as an input.
Default is unit = “m”.</p>
<p>Note that upon download using <strong>TADA_DataRetrieval</strong>,
all depth columns are converted to meters by default. However, the user
may choose to run the <strong>TADA_ConvertDepthUnits</strong> function
on their dataset to convert to another unit. See function documentation
for additional input options by entering the following code in the
console: ?TADA_ConvertDepthUnits</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># converts all depth profile data to meters</span></span>
<span><span class="va">TADAProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_ConvertDepthUnits.html">TADA_ConvertDepthUnits</a></span><span class="op">(</span><span class="va">TADAProfileClean1</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"ft"</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="statistically-aggregated-data">Statistically aggregated data<a class="anchor" aria-label="anchor" href="#statistically-aggregated-data"></a>
</h2>
<p>The <strong>TADA_FindContinuousData</strong> function checks for and
removes statistically aggregated high frequency (i.e., continuous) data,
if present.</p>
<p>The Water Quality Portal (WQP) is not currently designed to store
high-frequency sensor data (more than 1 value per day). However,
sometimes data providers choose to aggregate their continuous data to a
daily avg, max, or min value, and then submit that aggregated data to
the WQP through WQX. Alternatively, some organizations aggregate their
high frequency data (15 min or 1 hour data) to 2 or 4 hour interval
averages, and they also submit that data to the WQP through WQX. This
type of high frequency data may (or may not) be suitable for integration
with discrete water quality data for assessments. Therefore, this
function uses metadata submitted by data providers to flag rows with
aggregated continuous data. This is done by flagging results where the
ResultDetectionConditionText = “Reported in Raw Data (attached)”.</p>
<ul>
<li><p>When clean = FALSE, a column titled
“TADA.AggregatedContinuousData” is added to the dataframe to indicate if
the row includes aggregated continuous data, “Y”, or not, “N”.</p></li>
<li><p>When clean = TRUE, rows with aggregated continuous data are
removed from the dataframe and no column will be appended. The default
is clean = TRUE.</p></li>
</ul>
<p>An additional input called flaggedonly will allow the user to filter
data to show only rows of aggregated continuous data. Allowable values
for flaggedonly are TRUE or FALSE. The default is FALSE which keeps all
rows of data regardless of flag status. Assigning flaggedonly = TRUE
filters the dataframe to show only rows of data which are flagged
“Y”.</p>
<p>See function documentation for additional function options by
entering the following code in the console: ?TADA_FindContinuousData</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindContinuousData.html">TADA_FindContinuousData</a></span><span class="op">(</span><span class="va">TADAProfileClean1</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># uncomment below to create a dataframe of only the aggregated continuous data</span></span>
<span></span>
<span><span class="co"># TADAProfile_aggcont &lt;- TADA_FindContinuousData(TADAProfileClean3, clean = FALSE, flaggedonly = TRUE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wqx-quality-assurance-and-quality-control-qaqc-service-result-flags">WQX Quality Assurance and Quality Control (QAQC) Service Result
Flags<a class="anchor" aria-label="anchor" href="#wqx-quality-assurance-and-quality-control-qaqc-service-result-flags"></a>
</h2>
<p>Run the following result functions to address invalid method,
fraction, speciation, and unit metadata by characteristic. The default
is clean = TRUE, which will remove invalid results. You can change this
to clean = FALSE to flag results, but not remove them.</p>
<p>See documentation for more details:</p>
<ul>
<li>
<p>?<strong>TADA_FlagMethod</strong></p>
<ul>
<li><p>When clean = FALSE, this function adds the following column to
your dataframe: TADA.AnalyticalMethod.Flag. This column flags invalid
TADA.CharacteristicName, ResultAnalyticalMethod/MethodIdentifier, and
ResultAnalyticalMethod/MethodIdentifierContext combinations in your
dataframe either “NonStandardized”, “Invalid”, or “Valid”.</p></li>
<li><p>When clean = TRUE, “Invalid” rows are removed from the dataframe
and no column will be appended.</p></li>
<li><p>When flaggedonly = TRUE, the dataframe is filtered to only the
rows flagged as “Invalid”; default is flaggedonly = FALSE.</p></li>
</ul>
</li>
<li>
<p>?<strong>TADA_FlagSpeciation</strong></p>
<ul>
<li>
<p>When clean = “none”, this function adds the following column to
your dataframe: TADA.MethodSpeciation.Flag. This column flags each
TADA.CharacteristicName and MethodSpeciationName combination in your
dataframe as either “NonStandardized”,</p>
<p>“Invalid”, or “Valid”.</p>
</li>
<li><p>When clean = “invalid_only”, only “Invalid” rows are removed from
the dataframe. Default is clean = “invalid_only”.</p></li>
<li><p>When clean = “nonstandardized_only”, only “NonStandardized” rows
are removed from the dataframe.</p></li>
<li><p>When clean = “both”, “Invalid” and “NonStandardized” rows are
removed from the dataframe.</p></li>
<li><p>When clean = “none”, no rows are removed from the
dataframe.</p></li>
<li><p>When flaggedonly = TRUE, the dataframe is filtered to only the
rows flagged as “Invalid” or “NonStandardized”; default is flaggedonly =
FALSE.</p></li>
</ul>
</li>
<li>
<p>?<strong>TADA_FlagResultUnit</strong></p>
<ul>
<li><p>When clean = FALSE, the following column will be added to your
dataframe: TADA.ResultUnit.Flag. This column flags each
TADA.CharacteristicName, TADA.ActivityMediaName, and
TADA.ResultMeasure.MeasureUnitCode combination in your dataframe as
either “NonStandardized”, “Invalid”, or “Valid”.</p></li>
<li><p>When clean = TRUE, “Invalid” rows are removed from the dataframe
and no column will be appended.</p></li>
<li><p>When flaggedonly = TRUE, the dataframe is filtered to only the
rows flagged as “Invalid”; default is flaggedonly = FALSE.</p></li>
</ul>
</li>
<li>
<p>?<strong>TADA_FlagFraction</strong></p>
<ul>
<li>When clean = FALSE, this function adds the following column to your
dataframe: TADA.SampleFraction.Flag. This column flags each
TADA.CharacteristicName and TADA.ResultSampleFractionText combination in
your dataframe as either “NonStandardized”, “Invalid”, or “Valid”.</li>
<li>When clean = TRUE, “Invalid” rows are removed from the dataframe and
no column will be appended.</li>
<li>When flaggedonly = TRUE, the dataframe is filtered to only the rows
flagged as “Invalid”; default is flaggedonly = FALSE.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMethod.html">TADA_FlagMethod</a></span><span class="op">(</span><span class="va">TADAProfileClean1</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction</a></span><span class="op">(</span><span class="va">TADAProfileClean2</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation</a></span><span class="op">(</span><span class="va">TADAProfileClean2</span>, clean <span class="op">=</span> <span class="st">"invalid_only"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit</a></span><span class="op">(</span><span class="va">TADAProfileClean2</span>, clean <span class="op">=</span> <span class="st">"invalid_only"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wqx-national-upper-and-lower-thresholds">WQX national upper and lower thresholds<a class="anchor" aria-label="anchor" href="#wqx-national-upper-and-lower-thresholds"></a>
</h2>
<p>Run the following code to flag or remove results that are above or
below the national upper and lower bound for each characteristic and
unit combination. See documentation for more details:</p>
<ul>
<li>
<p>?<strong>TADA_FlagAboveThreshold</strong></p>
<ul>
<li><p>When clean = FALSE, the following column is added to your
dataframe: TADA.ResultValueAboveUpperThreshold.Flag. This column flags
rows with data that are above the upper WQX threshold. The default is
clean = FALSE.</p></li>
<li><p>When clean = TRUE, data that is above the upper WQX threshold is
removed from the dataframe.</p></li>
<li><p>When flaggedonly = TRUE, the dataframe is filtered to only the
rows flagged as above the upper WQX threshold; default is flaggedonly =
FALSE.</p></li>
</ul>
</li>
<li>
<p>?<strong>TADA_FlagBelowThreshold</strong></p>
<ul>
<li><p>When clean = FALSE, the following column is added to your
dataframe: TADA.ResultValueBelowLowerThreshold.Flag. This column flags
rows with data that are below the lower WQX threshold. The default is
clean = FALSE.</p></li>
<li><p>When clean = TRUE, data that is below the lower WQX threshold is
removed from the dataframe.</p></li>
<li><p>When flaggedonly = TRUE, the dataframe is filtered to only the
rows flagged as below the lower WQX threshold; default is flaggedonly =
FALSE.</p></li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagAboveThreshold.html">TADA_FlagAboveThreshold</a></span><span class="op">(</span><span class="va">TADAProfileClean2</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagBelowThreshold.html">TADA_FlagBelowThreshold</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="potential-duplicates">Potential duplicates<a class="anchor" aria-label="anchor" href="#potential-duplicates"></a>
</h2>
<p>Sometimes multiple organizations submit the exact same data to Water
Quality Portal (WQP), which can affect water quality analyses and
assessments. Similarly, organizations occasionally submit the same data
multiple times to the Portal. The following functions check for and
identify data that may be duplicates based on date, time,
characteristic, result value, and a distance buffer. Each pair or group
of potential duplicate rows is flagged with a unique ID. For more
information, review the documentation by entering the following into the
console:</p>
<ul>
<li>?<strong>TADA_FindPotentialDuplicatesMultipleOrgs</strong>
</li>
<li>?<strong>TADA_FindPotentialDuplicatesSingleOrg</strong>
</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindPotentialDuplicatesSingleOrg.html">TADA_FindPotentialDuplicatesSingleOrg</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindPotentialDuplicatesMultipleOrgs.html">TADA_FindPotentialDuplicatesMultipleOrgs</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>,</span>
<span>  dist_buffer <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  org_hierarchy <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="review-qapp-information">Review QAPP information<a class="anchor" aria-label="anchor" href="#review-qapp-information"></a>
</h2>
<p>The <strong>TADA_FindQAPPApproval</strong> function checks data for
an approved QAPP.</p>
<p>This function checks to see if there is any information in the column
“QAPPApprovedIndicator”. Some organizations submit data for this field
to indicate if the data produced has an approved Quality Assurance
Project Plan (QAPP) or not. In this field, Y indicates yes, N indicates
no.</p>
<p>This function has three default inputs: clean = TRUE, cleanNA =
FALSE, and flaggedonly = FALSE. These defaults remove rows of data where
the QAPPApprovedIndicator equals “N”.</p>
<p>Users could alternatively remove both N’s and NA’s using the inputs
clean = TRUE, cleanNA = TRUE, and flaggedonly = FALSE.</p>
<p>Additionally, users could filter to show only N’s and NA’s by using
the inputs clean = FALSE, cleanNA = FALSE, and flaggedonly = TRUE.</p>
<p>If clean = FALSE, cleanNA = FALSE, and flaggedonly = FALSE, the
function will not do anything.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQAPPApproval.html">TADA_FindQAPPApproval</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>, clean <span class="op">=</span> <span class="cn">FALSE</span>, cleanNA <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The <strong>TADA_FindQAPPDoc</strong> function checks to see if a
QAPP Doc is Available</p>
<p>This function checks data submitted under the “ProjectFileUrl” column
to determine if a QAPP document is available to review. When clean =
FALSE, a column will be appended to flag results that do have an
associated QAPP document URL provided. When clean = TRUE, rows that do
not have an associated QAPP document are removed from the dataframe and
no column will be appended. When flaggedonly = TRUE, the dataframe is
filtered to show only rows that do not have an associated QAPP document.
The defaults are clean = FALSE and flaggedonly = FALSE. This function
should only be used to remove data if an accompanying QAPP document is
required to use data in assessments.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQAPPDoc.html">TADA_FindQAPPDoc</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-dataframe-filtering">Full Dataframe Filtering<a class="anchor" aria-label="anchor" href="#full-dataframe-filtering"></a>
</h2>
<p>In this section a TADA user will want to review the unique values in
specific fields and may choose to remove data with particular
values.</p>
<p>To start, review the list of common fields used for filtering, and
the number of unique values in each field using the
<strong>TADA_FieldCounts</strong> function.</p>
<p>This function returns counts for you entire data frame for each of
the following fields (if populated, columns that are populated only with
NA’s are not included in the output):</p>
<ul>
<li><p><em>ActivityTypeCode</em></p></li>
<li><p><em>TADA.ActivityMediaName</em></p></li>
<li><p><em>ActivityMediaSubdivisionName</em></p></li>
<li><p><em>ActivityCommentText</em></p></li>
<li><p><em>MonitoringLocationTypeName</em></p></li>
<li><p><em>StateCode</em></p></li>
<li><p><em>OrganizationFormalName</em></p></li>
<li><p><em>TADA.CharacteristicName</em></p></li>
<li><p><em>HydrologicCondition</em></p></li>
<li><p><em>HydrologicEvent</em></p></li>
<li><p><em>BiologicalIntentName</em></p></li>
<li><p><em>MeasureQualifierCode</em></p></li>
<li><p><em>ActivityGroup</em></p></li>
<li><p><em>AssemblageSampledName</em></p></li>
<li><p><em>ProjectName</em></p></li>
<li><p><em>CharacteristicNameUserSupplied</em></p></li>
<li><p><em>DetectionQuantitationLimitTypeName</em></p></li>
<li><p><em>SampleTissueAnatomyName</em></p></li>
<li><p><em>LaboratoryName</em></p></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># multiple options</span></span>
<span></span>
<span><span class="co"># print table to console</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create object of table</span></span>
<span><span class="va">fieldCounts_Table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span><span class="op">)</span></span></code></pre></div>
<p>Next, choose a field from the list generated above to view a summary
table or pie chart of the counts of unique values in that field using
<strong>TADA_FieldValuesTable</strong> or
<strong>TADA_FieldValuesPie</strong>. We’ll start with
<em>ActivityTypeCode</em>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>, field <span class="op">=</span> <span class="st">"ActivityTypeCode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>, field <span class="op">=</span> <span class="st">"ActivityTypeCode"</span><span class="op">)</span></span></code></pre></div>
<p>The <em>ActivityTypeCode</em> field has multiple unique values.
Before we remove the QC samples/measurements from this dataset to
prepare for analyses, lets review flagged Quality Control (QC) values
using the <strong>TADA_FindQCActivities</strong> function, which adds a
new TADA <em>TADA.ActivityType.Flag</em> column.</p>
<p>For example, the new <em>QC_replicate</em> flag in
<strong>TADA.ActivityType.Flag</strong> column indicates that the
flagged rows include any of the following replicate values: -
<em>Quality Control Field Replicate Habitat Assessment</em> -
<em>Quality Control Field Replicate Msr/Obs</em> - <em>Quality Control
Field Replicate Portable Data Logger</em> - <em>Quality Control Field
Replicate Sample-Composite</em> - <em>Quality Control Sample-Field
Replicate</em></p>
<p>See WQX domain file to review all the
<strong>ActivityTypeCode</strong> allowable values: <a href="https://cdx.epa.gov/wqx/download/DomainValues/ActivityType.CSV" class="external-link uri">https://cdx.epa.gov/wqx/download/DomainValues/ActivityType.CSV</a></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Review flagged QC samples using the TADA_FindQCActivities function:</span></span>
<span><span class="co"># enter ?TADA_FindQCActivities into the console for more information</span></span>
<span><span class="va">TADAProfileClean3a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flaggedonly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter to review only data where the TADA.ActivityType.Flag = "QC_replicate"</span></span>
<span><span class="va">TADAProfileClean3a</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADAProfileClean3a</span>, <span class="va">TADA.ActivityType.Flag</span> <span class="op">==</span> <span class="st">"QC_replicate"</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s run <strong>TADA_PairReplicates</strong> to see if any
replicates in this dataframe can be paired with their original (parent)
samples/measurements.</p>
<p>We found over 100 replicates in this dataframe that have a paired
parent sample/measurement (based on a 10-minute time window, which can
be adjusted if desired). Enter ?TADA_PairReplicates into the console for
more details.</p>
<p>What are replicate samples and how are they used in water
analyses?</p>
<p>Replicate field samples are samples taken to assess the
reproducibility of the sampling technique or analytical method. They are
independently carried through all the steps of the sampling and
measurement process in an identical manner to their associated routine
field sample and used to measure the precision of the total sampling
method.</p>
<p>Theoretically, the analysis of a replicate field sample should yield
a very similar result as its associated routine field sample. If the
results are not the same or acceptably similar, it could signal possible
contamination or other issues in the sampling chain. However, water
quality can vary at very small scales. So, the field replicate can mix
up analytical precision with small scale variability. Field replicates
tell you the potential for your method to yield the same results at a
single time and place, to the extent that you are actually in exactly
the same place, and the few seconds (or any defined time window) from
one sample to the next does not matter, and the water isn’t moving. Be
careful about labeling data as imprecise or bad based on this alone.</p>
<p>Users of TADA have noted that it would be useful to incorporate
replicate field samples into water quality data analysis by (a) flagging
routine field sample measurements whose associated replicate field
sample measurements are outside of a user-defined window of precision
(relative percent difference or absolute difference) and/or (b)
averaging or randomly replacing routine field sample measurements with
their associated replicate field sample measurements.</p>
<p>For now, users can perform these subsequent analyses outside of TADA.
A two-stage data-quality-indicator, where low values should be within
the absolute difference limit and high values within the Relative
Percent Difference (RPD) limit, may be appropriate. RPD is the
calculated difference (RPD) between the routine sample result and its
associated replicate sample result. For example, if the RPD/CV exceeds
20% some water quality, analysts consider that to be a potentially
concerning lack of precision, especially for non-particulate analytes.
However, depending on the characteristic being analyzed and the sampling
method, acceptable RPDs can vary widely. Therefore, it is best for the
user to define their own level of RPD acceptability. In addition, a
tiered approach may be more appropriate, where the widely used 20% RPD
for measurements can be used for results above XX-times the detection
limit, but also an absolute difference approach can be used for those
result-values near the detection limit, or lower than the detection
limit (e.g., phosphorus). An absolute difference approach is more
appropriate when implementing RPD for samples close to the detection
limit, as even small absolute differences might show up as large
relative percent differences that “fail” the 20% RPD test.</p>
<p>For example, when nutrient concentrations are close to detection
limit, it becomes impossible to have a low RPD. In this scenario, high
RPD’s are acceptable because if you stand back and look at ALL the data,
and not just the replicates, these data may be agreeing perfectly well
that nutrients are very low. DO NOT throw out data if RPD is &gt;20%,
unless you have good reason, or you will potentially bias your data
toward high concentrations. QA procedures should not bias statistical
analyses of the data. Note that a modest error in a measurement will
have a much smaller effect than implementing a QA process that builds in
bias.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run TADA_PairReplicates to add new TADA.ReplicateSampleID column</span></span>
<span><span class="va">TADAProfileClean3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_PairReplicates.html">TADA_PairReplicates</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review unique values in TADA.ReplicateSampleID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean3b</span><span class="op">$</span><span class="va">TADA.ReplicateSampleID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter df to include only unique values that are paired replicate samples (parent-result and child-replicate).</span></span>
<span></span>
<span><span class="co"># Exclude NA's</span></span>
<span><span class="va">TADAProfileClean3b</span> <span class="op">&lt;-</span> <span class="va">TADAProfileClean3b</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TADAProfileClean3b</span><span class="op">$</span><span class="va">TADA.ReplicateSampleID</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># Exclude orphans</span></span>
<span><span class="va">TADAProfileClean3b</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADAProfileClean3b</span>, <span class="va">TADA.ReplicateSampleID</span> <span class="op">!=</span> <span class="st">"Orphan"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Review unique values in TADA.ReplicateSampleID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean3b</span><span class="op">$</span><span class="va">TADA.ReplicateSampleID</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s remove QC samples/measurements from the dataframe.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove flagged QC samples using the TADA_FindQCActivities function:</span></span>
<span><span class="va">TADAProfileClean4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span><span class="va">TADAProfileClean3</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regenerate table and pie chart</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>, <span class="st">"ActivityTypeCode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>, <span class="st">"ActivityTypeCode"</span><span class="op">)</span></span></code></pre></div>
<p>We’ve completed our review of the ActivityTypeCode.</p>
<p>Now, let’s move on to a different field and see if there are any
values that we want to remove.</p>
<p>In this next example, there are multiple MeasureQualifierCode values
to review.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>, <span class="st">"MeasureQualifierCode"</span><span class="op">)</span></span></code></pre></div>
<p>MeasureQualifierCode definitions are available <a href="https://cdx.epa.gov/wqx/download/DomainValues/ResultMeasureQualifier.CSV" style="font-size: 12pt;" class="external-link">here</a>.</p>
<p>In this example, we show how to use the function
<strong>TADA_FlagMeasureQualifierCode</strong> to add
MeasureQualifierCode definitions and flag and/or remove rows with
specific codes under MeasureQualifierCode that are categorized as
“SUSPECT”.</p>
<p>See ?TADA_FlagMeasureQualifierCode for more information.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flag only</span></span>
<span><span class="va">Review_TADAProfileClean4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMeasureQualifierCode.html">TADA_FlagMeasureQualifierCode</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flaggedonly <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  define <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Review_TADAProfileClean4 is empty because we did not find any Suspect samples</span></span>
<span></span>
<span><span class="va">TADAProfileClean4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMeasureQualifierCode.html">TADA_FlagMeasureQualifierCode</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regenerate table and pie chart</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>, field <span class="op">=</span> <span class="st">"MeasureQualifierCode"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="censored-data">Censored data<a class="anchor" aria-label="anchor" href="#censored-data"></a>
</h2>
<p>Censored data are measurements for which the true value is not known,
but we can estimate the value based on lower or upper detection
conditions and limit types. TADA fills missing
<em>TADA.ResultMeasureValue</em> and
<em>TADA.ResultMeasure.MeasureUnitCode</em> values with values and units
from <em>TADA.DetectionQuantitationLimitMeasure.MeasureValue</em> and
<em>TADA.DetectionQuantitationLimitMeasure.MeasureUnitCode</em>,
respectively, using the TADA_AutoClean function. In other words,
detection limit information is copied and pasted into the result value
column when the original value is NA and detection limit information is
available. The two columns TADA focuses on to define and flag censored
data are <em>ResultDetectionConditionText</em> and
<em>DetectionQuantitationLimitTypeName</em>.</p>
<p>The TADA package currently has functions that summarize censored data
incidence in the dataset and perform simple substitutions of censored
data values, including x times the detection limit and random selection
of a value between 0 and the detection limit. The user may specify the
methods used for non-detects and over-detects separately in the input to
the <strong>TADA_SimpleCensoredMethods</strong> function.</p>
<p>All censored data functions depend first on the
<strong>TADA_IDCensoredData</strong> utility function, which assigns a
<em>TADA.CensoredData.Flag</em> to all data records and identifies
over-detects from non-detects using the
<em>ResultDetectionConditionText</em> and
<em>DetectionQuantitationLimitTypeName</em>. This utility function is
automatically run within the TADA_DataRetrieval function and produces
the <em>TADA.CensoredData.Flag</em> column. All records receive one of
the following classifications: - Uncensored - Not filled with detection
limit value; a detection. - Non-Detect - Left-censored - Over-Detect -
Right-censored - Other Condition/Limit Populated - detection condition
or limit type are ambiguous or not associated with a lower/upper
detection limit. - Conflict between Condition and Limit - detection
condition and limit type for a single record do not agree, e.g. one
suggests over-detect and the other suggests non-detect. - Detection
condition or detection limit is not documented in TADA reference tables.
- detection condition or limit type is not characterized in the TADA
reference tables, which are based on WQX domain tables. - Detection
condition is missing and required for censored data ID. - Result needs
more information before being categorized.</p>
<p>The <strong>TADA_SimpleCensoredMethods</strong> function also adds a
<em>TADA.MeasureQualifierCode.Def</em> column which contains the
<em>MeasureQualiferCode</em> concatenated with the WQX definition for
each qualifier code. This provides additional information to the user
which may assist in deciding which records to retain for analysis.</p>
<p>The next step we take in this example is to perform simple
conversions to the censored data in the dataset: we keep over-detects as
is (no conversion made) and convert non-detect values to 0.5 times the
detection limit (half the detection limit). Please review
<strong>?TADA_Stats</strong> and
<strong>?TADA_SimpleCensoredMethods</strong> for more information.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span>,</span>
<span>  nd_method <span class="op">=</span> <span class="st">"multiplier"</span>,</span>
<span>  nd_multiplier <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  od_method <span class="op">=</span> <span class="st">"as-is"</span>,</span>
<span>  od_multiplier <span class="op">=</span> <span class="st">"null"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, review unique values within the
<em>TADA.CensoredData.Flag</em>,
<em>DetectionQuantitationLimitTypeName</em>, and
<em>ResultDetectionConditionText</em> columns.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># review unique values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">$</span><span class="va">TADA.CensoredData.Flag</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">$</span><span class="va">DetectionQuantitationLimitTypeName</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">$</span><span class="va">ResultDetectionConditionText</span><span class="op">)</span></span></code></pre></div>
<p>Also, review the <em>TADA.ResultMeasureValueDataTypes.Flag</em> to
see if any NA’s or ND’s (non-detects) remain.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span></code></pre></div>
<p>Count how many NA’s remain in the TADA.ResultMeasureValue.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Filter down to only numeric data. Remove data where the
TADA.ResultMeasureValueDataTypes.Flag = “Text” or “NA - Not Available”.
You can also remove any columns not required for the TADA workflow that
contain only NAs. The <strong>TADA_AutoFilter()</strong> function
removes non-numeric data and optional columns containing only NAs.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Removes rows where the result value is not numeric. Specifically, removes rows with "Text" or "NA - Not Available" in the TADA.ResultMeasureValueDataTypes.Flag column, or NA in the TADA.ResultMeasureValue column. Removes optional columns containing only NAs.</span></span>
<span><span class="va">TADAProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AutoFilter.html">TADA_AutoFilter</a></span><span class="op">(</span><span class="va">TADAProfileClean4</span><span class="op">)</span></span></code></pre></div>
<p>Double check to make sure no NA’s or ND’s remain.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-synonymous-characteristic-fraction-speciation-and-unit-values-to-a-consistent-convention-based-on-user-definedtada-standards">Convert synonymous characteristic, fraction, speciation, and unit
values to a consistent convention based on user-defined/TADA
standards<a class="anchor" aria-label="anchor" href="#convert-synonymous-characteristic-fraction-speciation-and-unit-values-to-a-consistent-convention-based-on-user-definedtada-standards"></a>
</h2>
<p>The <strong>TADA_GetSynonymRef</strong> function generates a synonym
reference table that is specific to the input dataframe. Users can
review how their input data relates to standard TADA values for the
following elements:</p>
<ul>
<li><p><em>TADA.CharacteristicName</em></p></li>
<li><p><em>TADA.ResultSampleFractionText</em></p></li>
<li><p><em>TADA.MethodSpeciationName</em></p></li>
<li><p><em>TADA.ResultMeasure.MeasureUnitCode</em></p></li>
</ul>
<p>Users can also edit the reference file to meet their needs if
desired. The download argument can be used to save the harmonization
file to your current working directory when download = TRUE, the default
is download = FALSE.</p>
<p>The <strong>TADA_HarmonizeSynonyms</strong> function then compares
the input dataframe to the TADA Synonym Reference Table and makes
conversions where target characteristics/fractions/speciations/units are
provided. This function also appends a column called
TADA.Harmonized.Flag, indicating which results had metadata
changed/converted in this function. The purpose of this function is to
make similar data consistent and therefore easier to compare and
analyze.</p>
<p>Here are some examples of how the TADA_HarmonizeSynonyms function can
be used:</p>
<ol style="list-style-type: decimal">
<li><p><em>TADA.ResultSampleFractionText</em> specifies forms of
constituents. In some cases, a single <em>TADA.CharacteristicName</em>
will have both “Total” and “Dissolved” forms specified, which should not
be combined. In these cases, each <em>TADA.CharacteristicName</em> and
<em>TADA.ResultSampleFractionText</em> combination is given a different
identifier. This identifier can be used later on to identify comparable
data groups for calculating statistics and creating figures for each
combination.</p></li>
<li><p>Some variables have different names but represent the same
constituent (e.g., “Total Kjeldahl nitrogen (Organic N &amp; NH3)” and
“Kjeldahl nitrogen”). The <strong>TADA_HarmonizeSynonyms</strong>
function gives a consistent name (and identifier) to synonyms.</p></li>
</ol>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UniqueHarmonizationRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetSynonymRef.html">TADA_GetSynonymRef</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_HarmonizeSynonyms.html">TADA_HarmonizeSynonyms</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span>,</span>
<span>  ref <span class="op">=</span> <span class="va">UniqueHarmonizationRef</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="total-nitrogen-and-total-phosphorus-calculations">Total Nitrogen and Total Phosphorus Calculations<a class="anchor" aria-label="anchor" href="#total-nitrogen-and-total-phosphorus-calculations"></a>
</h2>
<p>This section covers summing nutrient subspecies to estimate total
nitrogen and phosphorus. This can be a challenging endeavor because some
subspecies/compounds overlap in total nutrient calculations. Thus,
<strong>TADA_CalculateTotalNP</strong> uses the <a href="https://echo.epa.gov/trends/loading-tool/resources/nutrient-aggregation" class="external-link">Nutrient
Aggregation logic</a> to add together specific subspecies to obtain a
total. TADA adds one more equation to the mix: total particulate
nitrogen + total dissolved nitrogen. The function uses as many
subspecies as possible to calculate a total for each given site, date,
and depth group, but it will estimate total nitrogen with whatever
subspecies are present. This function creates NEW total nutrient
measurements (total nitrogen unfiltered as N and total phosphorus
unfiltered as P) and adds them to the dataframe.</p>
<p>Users can use the default summation worksheet (see
<strong>TADA_GetNutrientSummationRef</strong>) or customize it to suit
their needs. The function also requires a daily aggregation value,
either minimum, maximum, or mean. The default is ‘max’, which means that
if multiple measurements of the same subspecies-fraction-speciation-unit
occur on the same day at the same site and depth, the function will pick
the maximum value to use in summation calculations.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_CalculateTotalNP.html">TADA_CalculateTotalNP</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span>, daily_agg <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-level-filtering">Parameter Level Filtering<a class="anchor" aria-label="anchor" href="#parameter-level-filtering"></a>
</h2>
<p>In this section, you can select a single parameter, and review the
unique values in specified fields. You may then choose to remove
particular values by filtering.</p>
<p>To start, review the list of parameters in the dataframe using the
<strong>TADA_FieldValuesTable</strong> function.</p>
<p>Enter ?TADA_FieldValuesTable into the console for more
information.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, field <span class="op">=</span> <span class="st">"TADA.CharacteristicName"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can revisit the <strong>TADA_FieldCounts</strong> function
at the characteristic level to review how many unique allowable values
are included within each of the following fields:</p>
<ul>
<li><p><em>ActivityCommentText</em></p></li>
<li><p><em>ActivityTypeCode</em></p></li>
<li><p><em>TADA.ActivityMediaName</em></p></li>
<li><p><em>ActivityMediaSubdivisionName</em></p></li>
<li><p><em>MeasureQualifierCode</em></p></li>
<li><p><em>MonitoringLocationTypeName</em></p></li>
<li><p><em>HydrologicCondition</em></p></li>
<li><p><em>HydrologicEvent</em></p></li>
<li><p><em>ResultStatusIdentifier</em></p></li>
<li><p><em>MethodQualifierTypeName</em></p></li>
<li><p><em>ResultCommentText</em></p></li>
<li><p><em>ResultLaboratoryCommentText</em></p></li>
<li><p><em>TADA.ResultMeasure.MeasureUnitCode</em></p></li>
<li><p><em>TADA.ResultSampleFractionText</em></p></li>
<li><p><em>ResultTemperatureBasisText</em></p></li>
<li><p><em>ResultValueTypeName</em></p></li>
<li><p><em>ResultWeightBasisText</em></p></li>
<li><p><em>SampleCollectionEquipmentName</em></p></li>
<li><p><em>LaboratoryName</em></p></li>
<li><p><em>MethodDescriptionText</em></p></li>
<li><p><em>ResultParticleSizeBasisText</em></p></li>
<li><p><em>SampleCollectionMethod.MethodIdentifier</em></p></li>
<li><p><em>SampleCollectionMethod.MethodIdentifierContext</em></p></li>
<li><p><em>SampleCollectionMethod.MethodName</em></p></li>
<li><p><em>DataQuality.BiasValue</em></p></li>
<li><p><em>MethodSpeciationName</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodName</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodIdentifier</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodIdentifierContext</em></p></li>
<li><p><em>AssemblageSampledName</em></p></li>
<li><p><em>DetectionQuantitationLimitTypeName</em></p></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, display <span class="op">=</span> <span class="st">"most"</span>, characteristicName <span class="op">=</span> <span class="st">"TOTAL PHOSPHORUS, MIXED FORMS"</span><span class="op">)</span></span></code></pre></div>
<p>Selecting a parameter generates the list above, which is subset by
the selected parameter. The list includes fields you may want to review,
and the number of unique values in each field.</p>
<p>Next, choose a field from the list.</p>
<p>Review the WQX domain files for definitions: <a href="https://www.epa.gov/waterdata/storage-and-retrieval-and-water-quality-exchange-domain-services-and-downloads" class="external-link uri">https://www.epa.gov/waterdata/storage-and-retrieval-and-water-quality-exchange-domain-services-and-downloads</a></p>
<p>Now, we’ll use <strong>TADA_FieldValuesTable</strong> and
<strong>TADA_FieldValuesPie</strong> at the characteristic-level to
review a column of interest.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In this example we review values from the SampleCollectionMethod.MethodName field</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, field <span class="op">=</span> <span class="st">"SampleCollectionMethod.MethodName"</span>, characteristicName <span class="op">=</span> <span class="st">"TOTAL PHOSPHORUS, MIXED FORMS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, field <span class="op">=</span> <span class="st">"SampleCollectionMethod.MethodName"</span>, characteristicName <span class="op">=</span> <span class="st">"TOTAL PHOSPHORUS, MIXED FORMS"</span><span class="op">)</span></span></code></pre></div>
<p>Generate a scatterplot with two</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># review unique identifiers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose two and generate scatterplot</span></span>
<span><span class="fu"><a href="../reference/TADA_TwoCharacteristicScatterplot.html">TADA_TwoCharacteristicScatterplot</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TOTAL NITROGEN, MIXED FORMS_UNFILTERED_AS N_MG/L"</span>, <span class="st">"TOTAL PHOSPHORUS, MIXED FORMS_UNFILTERED_AS P_UG/L"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we will summarize results for a single comparable data group
using the TADA.ComparableDataIdentifier (i.e., comparable
characteristic, unit, speciation, and fraction combination) using
<strong>TADA_Histogram</strong> and <strong>TADA_Boxplot</strong>. Note
that users may generate a list output of multiple plots if their input
dataset has more than one unique comparable data group.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># review TADA.ComparableDataIdentifier</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADAProfileClean5</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter dataframe to only "TOTAL PHOSPHORUS, MIXED FORMS"</span></span>
<span><span class="va">TADAProfileCleanTP</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span>, <span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"TOTAL PHOSPHORUS, MIXED FORMS_UNFILTERED_AS P_UG/L"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate stats table</span></span>
<span><span class="va">TADAProfileCleanTP_stats</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Stats.html">TADA_Stats</a></span><span class="op">(</span><span class="va">TADAProfileCleanTP</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TADAProfileCleanTP_stats</span></span>
<span></span>
<span><span class="co"># generate a histogram</span></span>
<span><span class="va">TP_Histogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Histogram.html">TADA_Histogram</a></span><span class="op">(</span><span class="va">TADAProfileCleanTP</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view histogram</span></span>
<span><span class="va">TP_Histogram</span></span></code></pre></div>
<p>Generate interactive box plot.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TP_Boxplot</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Boxplot.html">TADA_Boxplot</a></span><span class="op">(</span><span class="va">TADAProfileCleanTP</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TP_Boxplot</span></span></code></pre></div>
<p>Generate interactive scatterplot.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileCleanTP_dailymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AggregateMeasurements.html">TADA_AggregateMeasurements</a></span><span class="op">(</span><span class="va">TADAProfileCleanTP</span>,</span>
<span>  agg_fun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span><span class="op">)</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TP_Scatterplot</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Scatterplot.html">TADA_Scatterplot</a></span><span class="op">(</span><span class="va">TADAProfileCleanTP_dailymax</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TP_Scatterplot</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retain-tada-required-columns">Retain TADA Required Columns<a class="anchor" aria-label="anchor" href="#retain-tada-required-columns"></a>
</h2>
<p>Now we can review the “TADA” prefixed columns we have added to the
data set. If we are satisfied with the conversions, filtering, flagging,
etc. and the resulting “TADA” columns, we can use the
<strong>TADA_RetainRequired</strong> function to remove any columns that
are not required or used as filters in the TADA workflow. This reduces
the size of the data frame.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TADAProfileClean7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_RetainRequired.html">TADA_RetainRequired</a></span><span class="op">(</span><span class="va">TADAProfileClean6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tada-shiny-application">TADA Shiny Application<a class="anchor" aria-label="anchor" href="#tada-shiny-application"></a>
</h2>
<p>Finally, take a look at an alternative workflow, TADA Shiny Module 1:
Data Discovery and Cleaning. This is a Shiny application that runs many
of the TADA functions covered in this document behind a graphical user
interface. The shiny application queries the WQP, contains maps and data
visualizations, flags suspect data results, handles censored data, and
more. You can launch it using the code below.</p>
<p>DRAFT <a href="https://owshiny-dev.app.cloud.gov/tada-dev/" class="external-link">Module
1</a> is also currently hosted on the web with minimal server
memory/storage allocated.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download TADA Shiny repository</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADAShiny"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># launch the app locally.</span></span>
<span><span class="fu">TADAShiny</span><span class="fu">::</span><span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-this-article-from-github">Download this Article from GitHub<a class="anchor" aria-label="anchor" href="#download-this-article-from-github"></a>
</h2>
<p>Go to: <a href="https://github.com/USEPA/TADA/blob/develop/vignettes/TADAModule1.Rmd" class="external-link uri">https://github.com/USEPA/TADA/blob/develop/vignettes/TADAModule1.Rmd</a></p>
<p><a href="https://github.com/USEPA/TADA/blob/develop/vignettes/TADAModule1.Rmd" class="external-link"><img src="images/DownloadModule1.jpg" alt="Click the highlighted icon to download TADAModule1.Rmd from GitHub. Open this file in R Studio to follow along. Alternatively, you can copy and paste desired lines of code from here into your own script. Note: You must have a GitHub account to download TADAModule1.Rmd from GitHub"></a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by U.S. Environmental Protection Agency, Cristina Mullin, Jacob Greif, Elise Hinman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
