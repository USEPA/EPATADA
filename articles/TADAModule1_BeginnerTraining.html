<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TADA Module 1: Training for Beginner R Users • EPATADA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TADA Module 1: Training for Beginner R Users">
<meta name="description" content="An introduction to major TADA Module 1 functions for users unfamiliar with R and RStudio.">
<meta property="og:description" content="An introduction to major TADA Module 1 functions for users unfamiliar with R and RStudio.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EPATADA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CONTRIBUTING.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/TADAAssessmentUnitUseCase.html">TADA: Assessment Unit Use Case Demo</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_AdvancedTraining.html">TADA Module 1: Training for Intermediate/Advanced R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_BeginnerTraining.html">TADA Module 1: Training for Beginner R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1.html">TADA Module 1: Water Quality Portal Data Discovery and Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule2.html">TADA Module 2: Geospatial Functions</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule3_PartA.html">TADA Module 3A: Associating WQP Characteristic Names with Applicable ATTAINS State, Tribal or EPA 304(a) Parameter and Use Names</a></li>
    <li><a class="dropdown-item" href="../articles/TADAWaterSciConWorkshopDemo.html">TADA: WaterSciCon Workshop Demo</a></li>
    <li><a class="dropdown-item" href="../articles/WQXValidationService.html">WQX QAQC Service User Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/EPATADA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TADA Module 1: Training for Beginner R Users</h1>
                        <h4 data-toc-skip class="author">TADA Team</h4>
            
            <h4 data-toc-skip class="date">2025-03-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EPATADA/blob/develop/vignettes/TADAModule1_BeginnerTraining.Rmd" class="external-link"><code>vignettes/TADAModule1_BeginnerTraining.Rmd</code></a></small>
      <div class="d-none name"><code>TADAModule1_BeginnerTraining.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="welcome">Welcome<a class="anchor" aria-label="anchor" href="#welcome"></a>
</h2>
<p>Thank you for your interest in Tools for Automated Data Analysis
(TADA). TADA is an open-source tool set built in the R programming
language. This <a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">RMarkdown</a> document
walks users through how to download the TADA R package from GitHub,
access and parameterize several important functions, and create basic
visualizations with a sample data set. The sample data set contains data
from one week from all EPA Region 5 states.</p>
<p><strong>Note: TADA is still under development. New functionality is
added weekly, and sometimes we need to make bug fixes in response to
tester and user feedback. We appreciate your feedback, patience, and
interest in these helpful tools.</strong></p>
<p><strong>If you are interested in contributing to TADA development,
more information is available at [Contributing] (<a href="https://usepa.github.io/EPATADA/articles/CONTRIBUTING.html" class="uri">https://usepa.github.io/EPATADA/articles/CONTRIBUTING.html</a>).
We welcome collaboration with external partners.</strong></p>
</div>
<div class="section level2">
<h2 id="install-and-load-packages">Install and load packages<a class="anchor" aria-label="anchor" href="#install-and-load-packages"></a>
</h2>
<p>First, install and load the remotes package specifying the repo. This
is needed before installing TADA because it is only available on
GitHub.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span>,</span>
<span>  repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, install and load TADA using the remotes package. TADA R Package
dependencies will also be downloaded automatically from CRAN with the
TADA install. You may be prompted in the console to update dependency
packages that have more recent versions available. If you see this
prompt, it is recommended to update all of them (enter 1 into the
console).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/EPATADA"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remotes::install_github("USGS-R/dataRetrieval", dependencies=TRUE)</span></span></code></pre></div>
<p>Finally, use the <strong>library()</strong> function to load the TADA
R Package into your R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/EPATADA/">EPATADA</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="help-pages">Help pages<a class="anchor" aria-label="anchor" href="#help-pages"></a>
</h2>
<p>All TADA R package functions have their own individual help pages,
listed on the <a href="https://usepa.github.io/EPATADA/reference/index.html">Function
reference</a> page on the GitHub site. Users can also access the help
page for a given function in R or RStudio using the following format
(example below): <code>?[name of TADA function]</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access help page for TADA_DataRetrieval</span></span>
<span><span class="op">?</span><span class="va">TADA_DataRetrieval</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-wqp-data">Retrieve WQP data<a class="anchor" aria-label="anchor" href="#retrieve-wqp-data"></a>
</h2>
<p>WQP data is retrieved and processed for compatibility with TADA. This
function, <strong>TADA_DataRetrieval</strong>, builds on USGS’s
dataRetrieval R package functions. It joins three WQP profiles: Site,
Sample Results (physical/chemical metadata), and Project. In addition,
when the function input applyautoclean = TRUE, it changes all data in
the characteristic, speciation, fraction, and unit fields to uppercase
and addresses result values that include special characters.</p>
<p>Query filters are consistent with those available from <a href="https://www.waterqualitydata.us/" class="external-link">Water Quality Portal (WQP)</a>
and can include:</p>
<ul>
<li><p>startDate</p></li>
<li><p>endDate</p></li>
<li><p>characteristicName</p></li>
<li><p>sampleMedia</p></li>
<li><p>siteType</p></li>
<li><p>statecode (review list of possible state and territory <a href="https://www2.census.gov/geo/docs/reference/state.txt" class="external-link">abbreviations</a>)</p></li>
<li><p>countycode</p></li>
<li><p>siteid</p></li>
<li><p>organization</p></li>
<li><p>project</p></li>
<li><p>huc</p></li>
<li><p>characteristicType</p></li>
</ul>
<p>Tips:</p>
<ol style="list-style-type: decimal">
<li>
<p>All the query filters for the WQP work as an AND but within the
fields there are ORs. For example:</p>
<ul>
<li><p>Characteristics: If you choose pH &amp; DO - it’s an OR. You will
retrieve both pH OR DO data if available.</p></li>
<li><p>States: Similarly, if you choose MI and IL, it’s an OR. You will
retrieve both MI OR IL data if available.</p></li>
<li><p>Combinations of fields are ANDs, such as State/MI AND
Characteristic/DO. This means you will receive all DO data available in
MI.</p></li>
<li><p>Characteristic and Characteristic Type also work as an AND. This
means that the Characteristic must fall within the CharacteristicGroup
if both filters are being used, if not you will get an error.</p></li>
</ul>
</li>
<li><p>The “siteid” is a general term WQP uses to describe both Site IDs
from USGS databases and Monitoring Location Identifiers (from WQX). Each
monitoring location in the Water Quality Portal (WQP) has a unique
Monitoring Location Identifier, regardless of the database from which it
derives.</p></li>
</ol>
<p>The example dataset in this demo includes monitoring data from
multiple organizations collected during one week (May 1, 2019 - May, 7
2019) in Region 5 states (Illinois, Indiana, Michigan, Minnesota, Ohio,
and Wisconsin).</p>
<p>For demonstration purposes, the R5 example data set has already been
downloaded. The default <strong>TADA_DataRetrieval</strong> function
automatically runs the <strong>TADA_AutoClean</strong> function. In this
example, we set <strong>TADA_AutoClean</strong> <em>= FALSE</em> and run
it as a separate step in the work flow. You can run the code chunk below
to access the pre-downloaded data set. The original query has also been
included and can be accessed by uncommenting and running the
<strong>TADA_DataRetrieval</strong> function below.</p>
<p>Downloads using <strong>TADA_DataRetrieval</strong> will have the
same columns each time. Any columns with a “TADA” prefix were added
during data retrieval. <strong>TADA_DataRetrieval</strong> automatically
converts the date times to UTC and data to dates, datetimes, and
numerics based on a standard algorithm. Data are uploaded to the Water
Quality Portal by individual organizations, which may or may not follow
the same conventions. Data and metadata quality are not guaranteed!
Carefully explore any data and make conservative quality assurance
decisions where information is limited.</p>
<p><strong>Note:</strong> USGS and EPA are working together to create
WQP 3.0 data profiles. Once released, one data profile will contain the
columns critical to TADA, removing the need to combine profiles. TADA
package users likely will not notice a difference in their usage of the
<strong>TADA_DataRetrieval</strong> function, but it will simplify the
steps needed to upload a custom or WQP GUI-downloaded data set into the
R package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Uncomment query below to download data set from WQP</span></span>
<span><span class="co"># TADAProfile &lt;- TADA_DataRetrieval(statecode = c("IL", "IN", "MI", "MN", "OH", "WI"), startDate = "2019-05-01", endDate = "2019-05-07", applyautoclean = FALSE)</span></span>
<span></span>
<span><span class="co"># For demo purposes, import pre-downloaded R5 data set</span></span>
<span><span class="va">R5Profile</span> <span class="op">&lt;-</span> <span class="va">Data_R5_TADAPackageDemo</span></span></code></pre></div>
<p><strong>R5 Profile</strong></p>
<p><em>The table above shows the first 100 records from the R5 Water
Quality Portal Query.</em></p>
<p><strong>Question 1: How many results did TADA_DataRetrieval
return?</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine number of rows in the data set</span></span>
<span><span class="va">R5_nresults</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5Profile</span><span class="op">)</span></span></code></pre></div>
<p>If you need to download a large amount of data from across a large
area, and the <strong>TADA_DataRetrieval</strong> function is not
working due to WQP timeout issues, then the
<strong>TADA_BigDataRetrieval</strong> function may work better. See
<strong>?TADA_BigDataRetrieval</strong> for more details or the TADA
Module 1 vignette for more details.</p>
</div>
<div class="section level2">
<h2 id="review-and-filter-by-media-type">Review and Filter By Media Type<a class="anchor" aria-label="anchor" href="#review-and-filter-by-media-type"></a>
</h2>
<p>TADA is primarily designed to accommodate water data from the WQP.
Let’s see what activity media types are represented in the data set.</p>
<p>To help answer this question, we can use TADA functions to create a
table or pie chart of the counts of unique values in a user-specified
field with <strong>TADA_FieldValuesTable</strong> or
<strong>TADA_FieldValuesPie</strong>. We’ll start with
<em>TADA.ActivityMediaName</em>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create pie chart for ActivityMediaName</span></span>
<span><span class="va">ActMedName_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"ActivityMediaName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ActMedName_Pie</span></span>
<span></span>
<span><span class="co"># Create table with count for each ActivityMediaName</span></span>
<span><span class="va">FieldValues_ActMedia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"ActivityMediaName"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 2: How many unique ‘ActivityMediaName’ values exist
in your dataset? Are there any media types that are not
water?</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_media</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">FieldValues_ActMedia</span><span class="op">$</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unique_media</span> <span class="op">&lt;-</span> <span class="va">FieldValues_ActMedia</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Value</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">media</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_replace.html" class="external-link">stri_replace_last</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">","</span>, <span class="st">" and"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_not_water</span> <span class="op">&lt;-</span> <span class="va">FieldValues_ActMedia</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Value</span> <span class="op">!=</span> <span class="st">"Water"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n_not_water <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filter-for-surface-water-data">Filter for Surface Water Data<a class="anchor" aria-label="anchor" href="#filter-for-surface-water-data"></a>
</h2>
<p>Some TADA users are interested in using WQP data for surface water
only or including some non-water data. The
<strong>TADA_AnalysisDataFilter</strong> identifies surface water,
groundwater, and sediment results. Multiple columns are used to identify
groundwater results as organizations may populate different combinations
of fields in order to identify groundwater results.</p>
<p>Users can specify whether all results should be returned with a new
column, <em>TADA.UseForAnalysis.Flag</em>, providing information about
the result’s media type and identifying if the result should be included
in further analysis, or if only results that should be included are
returned.</p>
<p>The defaults are to include surface water, exclude groundwater and
sediment, and to return all results with the added
<em>TADA.UseForAnalysis.Flag</em> column (clean = FALSE). This is shown
in the example below.</p>
<p>We can use <strong>TADA_FieldValuesTable</strong> and
<strong>TADA_FieldValuesPie</strong> again to review this more specific
breakdown of results by media type.</p>
<p><strong>Note:</strong> When WQX 3.0 data profiles are released, this
function will be updated to include fish tissue a filter option.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to flag only surface water results for use in analysis</span></span>
<span><span class="va">R5Profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AnalysisDataFilter.html">TADA_AnalysisDataFilter</a></span><span class="op">(</span><span class="va">R5Profile</span>, clean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create pie chart for TADA.UseForAnalysis.Flag</span></span>
<span><span class="va">FieldVal_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"TADA.UseForAnalysis.Flag"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">FieldVal_Pie</span></span>
<span></span>
<span><span class="va">FieldValues_AnalysisFlag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"TADA.UseForAnalysis.Flag"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 3: How many SURFACE WATER results can we retain for
further analysis</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to flag only surface water results for use in analysis</span></span>
<span></span>
<span><span class="va">n_sur_water</span> <span class="op">&lt;-</span> <span class="va">FieldValues_AnalysisFlag</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Value</span> <span class="op">==</span> <span class="st">"Yes - SURFACE WATER"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Count</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to retain only surface water results for use in analysis</span></span>
<span><span class="va">R5Profile</span> <span class="op">&lt;-</span> <span class="va">R5Profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.UseForAnalysis.Flag</span> <span class="op">==</span> <span class="st">"Yes - SURFACE WATER"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="autoclean">AutoClean<a class="anchor" aria-label="anchor" href="#autoclean"></a>
</h2>
<p>Now <strong>TADA_AutoClean</strong> can be run on the surface
water-only data set. It performs the following functions on the data
retrieved from the WQP:</p>
<ul>
<li><p><strong>TADA_ConvertSpecialChars</strong> - converts result value
columns to numeric and flags non-numeric values that could not be
converted.</p></li>
<li><p><strong>TADA_ConvertResultUnits</strong> - unifies result units
for easier quality control and review</p></li>
<li><p><strong>TADA_ConvertDepthUnits</strong> - converts depth units to
a consistent unit (meters). This function can also be run on its own,
for example if you would like to convert depths from meters to feet
later in the workflow.</p></li>
<li><p><strong>TADA_IDCensoredData</strong> - categorizes detection
limit data and identifies mismatches in result detection condition and
result detection limit type.</p></li>
<li><p>Other helpful actions - converts important text columns to all
upper-case letters, removes exact duplicates, and uses WQX format rules
to harmonize specific NWIS metadata conventions (e.g. move
characteristic speciation from the
<em>TADA.ResultMeasure.MeasureUnitCode</em> column to the
<em>TADA.MethodSpeciationName</em> column)</p></li>
</ul>
<p>As a general rule, TADA functions do not change any contents in the
WQP-served columns. Instead, they add new columns with the prefix
“TADA.” The following columns are numeric versions of their WQP origins:
<em>TADA.ResultMeasureValue</em>,
<em>TADA.DetectionQuantitationLimitMeasure.MeasureValue</em>,
<em>TADA.LatitudeMeasure</em>, and <em>TADA.LongitudeMeasure</em>.</p>
<p>These functions also add the columns
<em>TADA.ResultMeasureValueDataTypes.Flag</em> and
<em>TADA.DetectionQuantitationLimitMeasure.MeasureValueDataTypes.Flag</em>,
which provide information about the result values that is needed to
address censored data later on. These new columns flag if special
characters are included in result values, and specify what the special
characters are.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run TADA_AutoClean on filtered dataset to convert special characters, result units, and depth units and identify censored data.</span></span>
<span><span class="va">R5Profile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AutoClean.html">TADA_AutoClean</a></span><span class="op">(</span><span class="va">R5Profile</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="monitoring-location-review">Monitoring Location Review<a class="anchor" aria-label="anchor" href="#monitoring-location-review"></a>
</h2>
<p>Now let’s take a look at a breakdown of these monitoring location
types. The previous function removed non-surface water results.
Depending upon your program’s goals and methods, you might want to
further filter the monitoring location types in the data set.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MonLocTypNam_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"TADA.MonitoringLocationTypeName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MonLocTypNam_Pie</span></span></code></pre></div>
<p><strong>Question 4: How many unique Monitoring Location Types
(TADA.MonitoringLocationTypeName) are present? Which is the most
common?</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FieldValues_MLs_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5Profile</span>, field <span class="op">=</span> <span class="st">"TADA.MonitoringLocationTypeName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mlt_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">FieldValues_MLs_table</span><span class="op">$</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mlt_most_common</span> <span class="op">&lt;-</span> <span class="va">FieldValues_MLs_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Count</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s filter by mlt_most_common and focus the rest of this demo
on the mlt_most_common[1] subset of results.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5Profile</span> <span class="op">&lt;-</span> <span class="va">R5Profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.MonitoringLocationTypeName</span> <span class="op">==</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">mlt_most_common</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next we can review station locations and summary information using
the <strong>TADA_OverviewMap</strong> function.
<strong>TADA_OverviewMap</strong> counts the number of unique results,
characteristics, and organizations at each monitoring location and
creates a map for reviewing summary stats. Larger point sizes indicate
more results, while darker blue colors indicate more unique
characteristics collected at the site. Users may click on a site to view
a pop-up with this summary information. This can be a good first step in
identifying incorrect coordinates that are outside of the desired
state(s) of interest or outside of the US.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_OverviewMap.html">TADA_OverviewMap</a></span><span class="op">(</span><span class="va">R5Profile</span><span class="op">)</span></span></code></pre></div>
<p>Another function, <strong>TADA_FlagCoordinates</strong>, identifies
and flags potentially invalid coordinate data. Its functionality will
not be showcased in this demo due to time constraints. For details see
TADA: Module 1 or enter <em>?TADA_FlagCoordinates</em> in the R console
for more information and examples.</p>
</div>
<div class="section level2">
<h2 id="summarize-by-characteristic">Summarize by Characteristic<a class="anchor" aria-label="anchor" href="#summarize-by-characteristic"></a>
</h2>
<p><strong>TADA_SummarizeColumn</strong> summarizes the data set based
on a user specified column and returns a dataframe displaying the number
of sites and number of records for each unique value in the specified
column. This example uses <em>TADA.CharacteristicName</em>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Review the number of sites and number of records for each CharacteristicName in TADAProfile</span></span>
<span><span class="va">R5Profile_CharSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SummarizeColumn.html">TADA_SummarizeColumn</a></span><span class="op">(</span><span class="va">R5Profile</span>, <span class="st">"TADA.CharacteristicName"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 5: How many unique values of TADA.CharacteristicName
are included in the data set? Which TADA.CharacteristicName was
collected at the greatest number of sites? Which TADA.CharacteristicName
has the most results?</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of unique values of TADA.CharacteristicName</span></span>
<span><span class="va">n_char_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">R5Profile_CharSummary</span><span class="op">$</span><span class="va">TADA.CharacteristicName</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter for record with max number of sites per Character</span></span>
<span><span class="va">max_sites</span> <span class="op">&lt;-</span> <span class="va">R5Profile_CharSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">n_sites</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter for record with max number of results per Character</span></span>
<span><span class="va">max_results</span> <span class="op">&lt;-</span> <span class="va">R5Profile_CharSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">n_records</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wqx-quality-assurance-and-quality-control-qaqc-service-result-flags">WQX Quality Assurance and Quality Control (QAQC) Service Result
Flags<a class="anchor" aria-label="anchor" href="#wqx-quality-assurance-and-quality-control-qaqc-service-result-flags"></a>
</h2>
<p>Next we’ll run several functions to address suspect method, fraction,
speciation, and unit metadata by characteristic. The default is clean =
TRUE, which will remove suspect results. You can change this to clean =
FALSE to flag results, but not remove them.</p>
<p>See documentation for more details:</p>
<ul>
<li><p>?<strong>TADA_FlagMethod</strong></p></li>
<li><p>?<strong>TADA_FlagSpeciation</strong></p></li>
<li><p>?<strong>TADA_FlagResultUnit</strong></p></li>
<li><p>?<strong>TADA_FlagFraction</strong></p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMethod.html">TADA_FlagMethod</a></span><span class="op">(</span><span class="va">R5Profile</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span>, clean <span class="op">=</span> <span class="st">"suspect_only"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span>, clean <span class="op">=</span> <span class="st">"suspect_only"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 6: How many rows were removed due to the WQX QAQC
service functions? What might be a helpful first step in investigating
why these removals occurred?</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine number of rows removed</span></span>
<span><span class="va">R5Profile_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5Profile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean1_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rows_removed_n</span> <span class="op">&lt;-</span> <span class="va">R5Profile_n</span> <span class="op">-</span> <span class="va">R5ProfileClean1_n</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wqx-national-upper-and-lower-thresholds">WQX national upper and lower thresholds<a class="anchor" aria-label="anchor" href="#wqx-national-upper-and-lower-thresholds"></a>
</h2>
<p>Run the following code to flag or remove results that are above or
below the national upper and lower bound for each characteristic and
unit combination. See documentation for more details:</p>
<ul>
<li><p>?<strong>TADA_FlagAboveThreshold</strong></p></li>
<li><p>?<strong>TADA_FlagBelowThreshold</strong></p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagAboveThreshold.html">TADA_FlagAboveThreshold</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagBelowThreshold.html">TADA_FlagBelowThreshold</a></span><span class="op">(</span><span class="va">R5ProfileClean2</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 7: How many results were removed due to the WQX
upper and lower thresholds?</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine number of rows removed</span></span>
<span><span class="va">R5ProfileClean1_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean3_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">threshold_removed_n</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean1_n</span> <span class="op">-</span> <span class="va">R5ProfileClean3_n</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="potential-duplicates">Potential duplicates<a class="anchor" aria-label="anchor" href="#potential-duplicates"></a>
</h2>
<p>Sometimes multiple organizations submit the exact same data to Water
Quality Portal (WQP). Let’s start by looking at the submitting
organizations for this data set and their relative contributions.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create dataframe with result counts by organization</span></span>
<span><span class="va">FieldValues_Orgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5ProfileClean3</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 8: How many organizations submitted data? Which
organization submitted the most results? Which organization submitted
the fewest results?</strong></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orgs_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">FieldValues_Orgs</span><span class="op">$</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">org_max</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">FieldValues_Orgs</span>, <span class="va">Count</span><span class="op">)</span></span>
<span></span>
<span><span class="va">org_min</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span><span class="va">FieldValues_Orgs</span>, <span class="va">Count</span><span class="op">)</span></span></code></pre></div>
<p>Organizations occasionally submit the same data multiple times to the
Portal. The following functions check for and identify data that may be
duplicates based on date, time, characteristic, result value, and a
distance buffer. Each pair or group of potential duplicate rows is
flagged with a unique ID. For more information, review the documentation
by entering the following into the console:</p>
<ul>
<li><strong>?TADA_FindPotentialDuplicatesMultipleOrgs</strong></li>
<li><strong>?TADA_FindPotentialDuplicatesSingleOrg</strong></li>
</ul>
<p>Flag potential duplicates from a single organization:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindPotentialDuplicatesSingleOrg.html">TADA_FindPotentialDuplicatesSingleOrg</a></span><span class="op">(</span><span class="va">R5ProfileClean3</span><span class="op">)</span></span></code></pre></div>
<p>Remove flagged duplicates from a single organization (random
selection of single result):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean4</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">TADA.SingleOrgDup.Flag</span> <span class="op">==</span> <span class="st">"Unique"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Question 9: How many total duplicate results were removed?
How could you prioritize retaining results from your organization when
duplicate results are identified?</strong></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine how many duplicate results were removed</span></span>
<span><span class="va">R5ProfileClean3_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean4_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">duplicate_removed_n</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean3_n</span> <span class="op">-</span> <span class="va">R5ProfileClean4_n</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-dataframe-filtering">Full Dataframe Filtering<a class="anchor" aria-label="anchor" href="#full-dataframe-filtering"></a>
</h2>
<p>In this section a TADA user can review the unique values in specific
fields and may choose to remove data with particular values.</p>
<p>To start, review the list of common fields used for filtering, and
the number of unique values in each field using the
<strong>TADA_FieldCounts</strong> function.</p>
<p>This function returns counts for you the entire dataframe for each of
the following fields (if populated, columns that are populated only with
NA’s are not included in the output):</p>
<ul>
<li><p><em>ActivityTypeCode</em></p></li>
<li><p><em>TADA.ActivityMediaName</em></p></li>
<li><p><em>ActivityMediaSubdivisionName</em></p></li>
<li><p><em>ActivityCommentText</em></p></li>
<li><p><em>MonitoringLocationTypeName</em></p></li>
<li><p><em>StateCode</em></p></li>
<li><p><em>OrganizationFormalName</em></p></li>
<li><p><em>TADA.CharacteristicName</em></p></li>
<li><p><em>HydrologicCondition</em></p></li>
<li><p><em>HydrologicEvent</em></p></li>
<li><p><em>BiologicalIntentName</em></p></li>
<li><p><em>MeasureQualifierCode</em></p></li>
<li><p><em>ActivityGroup</em></p></li>
<li><p><em>AssemblageSampledName</em></p></li>
<li><p><em>ProjectName</em></p></li>
<li><p><em>CharacteristicNameUserSupplied</em></p></li>
<li><p><em>DetectionQuantitationLimitTypeName</em></p></li>
<li><p><em>SampleTissueAnatomyName</em></p></li>
<li><p><em>LaboratoryName</em></p></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create table of field counts</span></span>
<span><span class="va">FieldCounts_Table_R5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">R5ProfileClean4</span><span class="op">)</span></span></code></pre></div>
<p>The <em>ActivityTypeCode</em> field has multiple unique values.
Before we remove the QC samples/measurements from this dataset to
prepare for analyses, lets review flagged Quality Control (QC) values
using the <strong>TADA_FindQCActivities</strong> function, which a
<em>TADA.ActivityType.Flag</em> column.</p>
<p>For example, the new <em>QC_replicate</em> flag in
<em>TADA.ActivityType.Flag</em> column indicates that the flagged rows
include any of the following replicate values: Quality Control Field
Replicate Habitat Assessment, Quality Control Field Replicate Msr/Obs,
Quality Control Field Replicate Portable Data Logger, Quality Control
Field Replicate Sample-Composite and Quality Control Sample-Field
Replicate.</p>
<p>See WQX domain file to review all the
<strong>ActivityTypeCode</strong> allowable values: <a href="https://cdx.epa.gov/wqx/download/DomainValues/ActivityType.CSV" class="external-link uri">https://cdx.epa.gov/wqx/download/DomainValues/ActivityType.CSV</a></p>
<p>Other functions, such as <strong>TADA_PairReplicates</strong> which
identifies replicates and their original (parent) samples, may also be
useful when reviewing QC results. For now, let’s simply remove QC
samples/measurements from the dataframe.</p>
<p>For more information on <strong>TADA_PairReplicates</strong> and
suggestions for handling paired replicates (outside the TADA package)
see TADA Module 1 or enter “?TADA_PairReplicates” in the console.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove flagged QC samples using the TADA_FindQCActivities function:</span></span>
<span><span class="va">R5ProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span><span class="va">R5ProfileClean4</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate pie chart for ActivityTypeCode</span></span>
<span><span class="va">ActTypCod_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>, <span class="st">"ActivityTypeCode"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ActTypCod_Pie</span></span></code></pre></div>
<p><strong>Question 10: How many ActivityTypeCodes are present after
removing QC samples? Which ActivityTypeCode is the most
common?</strong></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of ActivityTypeCodes</span></span>
<span><span class="va">activity_type_code_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span><span class="op">$</span><span class="va">ActivityTypeCode</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Most common Activity Type Code</span></span>
<span><span class="va">most_common_activity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>, <span class="st">"ActivityTypeCode"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">Count</span><span class="op">)</span></span></code></pre></div>
<p>We’ve completed our review of the ActivityTypeCode. Now, let’s move
on to a different field and see if there are any values that we want to
remove. In this next example, there are multiple MeasureQualifierCode
values to review.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MQC_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>, <span class="st">"MeasureQualifierCode"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MQC_Pie</span></span></code></pre></div>
<p>MeasureQualifierCode definitions are available <a href="https://cdx.epa.gov/wqx/download/DomainValues/ResultMeasureQualifier.CSV" style="font-size: 12pt;" class="external-link">here</a>.</p>
<p>In this example, we show how to use the function
<strong>TADA_FlagMeasureQualifierCode</strong> to add
<em>MeasureQualifierCode</em> definitions and flag and/or remove rows
with specific codes under <em>MeasureQualifierCode</em> that are
categorized as “SUSPECT”.</p>
<p>See <strong>?TADA_FlagMeasureQualifierCode</strong> for more
information.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flag only</span></span>
<span><span class="va">Review_R5ProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMeasureQualifierCode.html">TADA_FlagMeasureQualifierCode</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flaggedonly <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  define <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Review number of suspect results</span></span>
<span><span class="va">suspect_n</span> <span class="op">&lt;-</span> <span class="va">Review_R5ProfileClean5</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.MeasureQualifierCode.Flag</span> <span class="op">==</span> <span class="st">"SUSPECT"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run function with clean = TRUE</span></span>
<span><span class="va">R5ProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagMeasureQualifierCode.html">TADA_FlagMeasureQualifierCode</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 11: How many results were identified as “SUSPECT”
based on the MeasureQualifierCode?</strong></p>
</div>
<div class="section level2">
<h2 id="censored-data">Censored data<a class="anchor" aria-label="anchor" href="#censored-data"></a>
</h2>
<p>Censored data are measurements for which the true value is not known,
but we can estimate the value based on lower or upper detection
conditions and limit types. TADA fills missing
<em>TADA.ResultMeasureValue</em> and
<em>TADA.ResultMeasure.MeasureUnitCode</em> values with values and units
from <em>TADA.DetectionQuantitationLimitMeasure.MeasureValue</em> and
<em>TADA.DetectionQuantitationLimitMeasure.MeasureUnitCode</em>,
respectively, using the <strong>TADA_AutoClean</strong> function. In
other words, detection limit information is copied and pasted into the
result value column when the original value is NA and detection limit
information is available. The two columns TADA focuses on to define and
flag censored data are <em>ResultDetectionConditionText</em> and
<em>DetectionQuantitationLimitTypeName</em>.</p>
<p>The TADA package currently has functions that summarize censored data
incidence in the dataset and perform simple substitutions of censored
data values, including x times the detection limit and random selection
of a value between 0 and the detection limit. The user may specify the
methods used for non-detects and over-detects separately in the input to
the <strong>TADA_SimpleCensoredMethods</strong> function.</p>
<p>All censored data functions depend first on the
<strong>TADA_IDCensoredData</strong> utility function, which assigns a
<em>TADA.CensoredData.Flag</em> to all data records and identifies
over-detects from non-detects using the
<em>ResultDetectionConditionText</em> and
<em>DetectionQuantitationLimitTypeName</em>. This utility function is
automatically run within the <strong>TADA_AutoClean</strong> function
and produces the <em>TADA.CensoredData.Flag</em> column. All records
receive one of the following classifications: Uncensored; Non-Detect;
Over-Detect; Other Condition/Limit Populated; Conflict between Condition
and Limit; Detection condition or detection limit is not documented in
TADA; or Detection condition is missing and required for censored data
ID.</p>
<p>The <strong>TADA_SimpleCensoredMethods</strong> function also adds a
<em>TADA.MeasureQualifierCode.Def</em> column which contains the
<em>MeasureQualiferCode</em> concatenated with the WQX definition for
each qualifier code. This provides additional information to the user
which may assist in deciding which records to retain for analysis.</p>
<p>The next step we take in this example is to perform simple
conversions to the censored data in the dataset: we keep over-detects as
is (no conversion made) and convert non-detect values to 0.5 times the
detection limit (half the detection limit). Please review
<strong>?TADA_Stats</strong> and
<strong>?TADA_SimpleCensoredMethods</strong> for more information.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span>,</span>
<span>  nd_method <span class="op">=</span> <span class="st">"multiplier"</span>,</span>
<span>  nd_multiplier <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  od_method <span class="op">=</span> <span class="st">"as-is"</span>,</span>
<span>  od_multiplier <span class="op">=</span> <span class="st">"null"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 12: How many NAs in the TADA.ResultMeasureValue
column remain after running TADA_SimpleCensoredMethods? What is the
difference between the values in the MeasureQualifierCode and
TADA.MeasureQualifierCode.Def columns?</strong></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine number of NA results remaining</span></span>
<span><span class="va">result_na_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show unique values of MeasureQualifierCode and TADA.MeasureQualifierCode.Def</span></span>
<span><span class="va">mqc</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean5</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">MeasureQualifierCode</span>, <span class="va">TADA.MeasureQualifierCode.Def</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to filter down to only numeric data. Remove data where
the <em>TADA.ResultMeasureValueDataTypes.Flag</em> = “Text” or “NA - Not
Available”. You can also remove any columns not required for the TADA
workflow that contain only NAs. The <strong>TADA_AutoFilter</strong>
function removes non-numeric data and optional columns containing only
NAs.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Removes rows where the result value is not numeric. Specifically, removes rows with "Text" or "NA - Not Available" in the TADA.ResultMeasureValueDataTypes.Flag column, or NA in the TADA.ResultMeasureValue column. Removes optional columns containing only NAs.</span></span>
<span><span class="va">R5ProfileClean6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AutoFilter.html">TADA_AutoFilter</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 13: How many NAs remain in the data set for
TADA.ResultMeasureValue after running TADA_Autofilter? How many
non-numeric values in TADA.ResultMeasureValueDataTypes.Flag remain in
the data set? How many rows were removed from the data set?</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_nas_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">R5ProfileClean6</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">non_numeric_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">R5ProfileClean6</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="st">"Result Value/Unit Estimated from Detection Limit"</span>, <span class="st">"Result Value/Unit Copied from Detection Limit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean5_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean6_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">autofilter_removed_n</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean5_n</span> <span class="op">-</span> <span class="va">R5ProfileClean6_n</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-synonymous-characteristic-fraction-speciation-and-unit-values-to-a-consistent-convention-based-on-user-definedtada-standards">Convert synonymous characteristic, fraction, speciation, and unit
values to a consistent convention based on user-defined/TADA
standards<a class="anchor" aria-label="anchor" href="#convert-synonymous-characteristic-fraction-speciation-and-unit-values-to-a-consistent-convention-based-on-user-definedtada-standards"></a>
</h2>
<p>The <strong>TADA_GetSynonymRef</strong> function generates a synonym
reference table that is specific to the input dataframe. Users can
review how their input data relates to standard TADA values for the
following elements:</p>
<ul>
<li><p><em>TADA.CharacteristicName</em></p></li>
<li><p><em>TADA.ResultSampleFractionText</em></p></li>
<li><p><em>TADA.MethodSpeciationName</em></p></li>
<li><p><em>TADA.ResultMeasure.MeasureUnitCode</em></p></li>
</ul>
<p>Users can also edit the reference file to meet their needs if
desired. The download argument can be used to save the harmonization
file to your current working directory when download = TRUE, the default
is download = FALSE.</p>
<p>The <strong>TADA_HarmonizeSynonyms</strong> function then compares
the input dataframe to the TADA Synonym Reference Table and makes
conversions where target characteristics/fractions/speciations/units are
provided. This function also appends a column called
<em>TADA.Harmonized.Flag</em>, indicating which results had metadata
changed/converted in this function. The purpose of this function is to
make similar data consistent and therefore easier to compare and
analyze.</p>
<p>Here are some examples of how the
<strong>TADA_HarmonizeSynonyms</strong> can be useful:</p>
<ol style="list-style-type: decimal">
<li><p><em>TADA.ResultSampleFractionText</em> specifies forms of
constituents. In some cases, a single <em>TADA.CharacteristicName</em>
will have both “Total” and “Dissolved” forms specified, which should not
be combined. In these cases, each <em>TADA.CharacteristicName</em> and
<em>TADA.ResultSampleFractionText</em> combination is given a different
identifier. This identifier can be used later on to identify comparable
data groups (<em>TADA.ComparableDataIdentifier</em>) for calculating
statistics and creating figures for each combination.</p></li>
<li><p>Some variables have different names but represent the same
constituent (e.g., “Total Kjeldahl nitrogen (Organic N &amp; NH3)” and
“Kjeldahl nitrogen”). The <strong>TADA_HarmonizeSynonyms</strong>
function gives a consistent name (and identifier) to synonyms.</p></li>
</ol>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get harmonization reference table</span></span>
<span><span class="va">UniqueHarmonizationRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetSynonymRef.html">TADA_GetSynonymRef</a></span><span class="op">(</span><span class="va">R5ProfileClean6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter out records without target to display in table</span></span>
<span><span class="va">UniqueHarmonizationRef_no_na</span> <span class="op">&lt;-</span> <span class="va">UniqueHarmonizationRef</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Target.TADA.CharacteristicName</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Harominze data set</span></span>
<span><span class="va">R5ProfileClean7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_HarmonizeSynonyms.html">TADA_HarmonizeSynonyms</a></span><span class="op">(</span><span class="va">R5ProfileClean6</span>,</span>
<span>  ref <span class="op">=</span> <span class="va">UniqueHarmonizationRef</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><em>The table above shows the first 100 rows of the
UniqueHarmonizationRef table.</em></p>
</div>
<div class="section level2">
<h2 id="total-nitrogen-and-total-phosphorus-calculations">Total Nitrogen and Total Phosphorus Calculations<a class="anchor" aria-label="anchor" href="#total-nitrogen-and-total-phosphorus-calculations"></a>
</h2>
<p>This section covers summing nutrient subspecies to estimate total
nitrogen and phosphorus. This can be challenging because some
subspecies/compounds overlap in total nutrient calculations. Thus,
<strong>TADA_CalculateTotalNP</strong> uses the <a href="https://echo.epa.gov/trends/loading-tool/resources/nutrient-aggregation" class="external-link">Nutrient
Aggregation logic</a> to add subspecies to obtain a total. TADA adds one
more equation to the mix: total particulate nitrogen + total dissolved
nitrogen. The function uses as many subspecies as possible to calculate
a total for each given site, date, and depth group, but it will estimate
total nitrogen with whatever subspecies are present. This function
creates NEW total nutrient measurements (total nitrogen unfiltered as N
and total phosphorus unfiltered as P) and adds them to the
dataframe.</p>
<p>Users can use the default summation worksheet (see
<strong>TADA_GetNutrientSummationRef</strong>) or customize it. The
function also requires a daily aggregation value, either minimum,
maximum, or mean. The default is ‘max’, which means that if multiple
measurements of the same subspecies-fraction-speciation-unit occur on
the same day at the same site and depth, the function will pick the
maximum value to use for summation.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_CalculateTotalNP.html">TADA_CalculateTotalNP</a></span><span class="op">(</span><span class="va">R5ProfileClean7</span>, daily_agg <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 14: How many new Total Nitrogen or Total Phosphorus
rows were added? Can users customize nutrient summation?</strong></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean7_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean8_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nutrient_n</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean8_n</span> <span class="op">-</span> <span class="va">R5ProfileClean7_n</span></span>
<span></span>
<span><span class="va">total_N_P_subset</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean8</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.NutrientSummation.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nutrient summation from one or more subspecies."</span>, <span class="st">"Nutrient summation from one subspecies."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span>, <span class="va">TADA.ResultMeasureValue</span>, <span class="va">TADA.ResultMeasure.MeasureUnitCode</span>, <span class="va">TADA.NutrientSummation.Flag</span>, <span class="va">TADA.NutrientSummationEquation</span>, <span class="va">TADA.NutrientSummationGroup</span><span class="op">)</span></span></code></pre></div>
<p><em>The table above shows the first 100 rows added by calculating
Total N and P. Columns included in the table are
TADA.CharacteristicName, TADA.ResultMeasureValue,
TADA.ResultMeasure.MeasureUnitCode, TADA.NutrientSummation.Flag,
TADA.NutrientSummationEquation, and
TADA.NutrientSummationGroup.</em></p>
</div>
<div class="section level2">
<h2 id="parameter-level-filtering">Parameter Level Filtering<a class="anchor" aria-label="anchor" href="#parameter-level-filtering"></a>
</h2>
<p>In this section, you can select a single parameter, and review the
unique values in specified fields. You may then choose to remove
particular values by filtering.</p>
<p>To start, review the list of parameters in the dataframe using the
<strong>TADA_FieldValuesTable</strong> function.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Char_Table</span> <span class="op">&lt;-</span> <span class="va">FieldValuesTable_Chars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, field <span class="op">=</span> <span class="st">"TADA.CharacteristicName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Char_Table</span></span></code></pre></div>
<p>Next, we can revisit the <strong>TADA_FieldCounts</strong> function
at the characteristic level to review how many unique allowable values
are included within each of the following fields:</p>
<ul>
<li><p><em>ActivityCommentText</em></p></li>
<li><p><em>ActivityTypeCode</em></p></li>
<li><p><em>TADA.ActivityMediaName</em></p></li>
<li><p><em>ActivityMediaSubdivisionName</em></p></li>
<li><p><em>MeasureQualifierCode</em></p></li>
<li><p><em>MonitoringLocationTypeName</em></p></li>
<li><p><em>HydrologicCondition</em></p></li>
<li><p><em>HydrologicEvent</em></p></li>
<li><p><em>ResultStatusIdentifier</em></p></li>
<li><p><em>MethodQualifierTypeName</em></p></li>
<li><p><em>ResultCommentText</em></p></li>
<li><p><em>ResultLaboratoryCommentText</em></p></li>
<li><p><em>TADA.ResultMeasure.MeasureUnitCode</em></p></li>
<li><p><em>TADA.ResultSampleFractionText</em></p></li>
<li><p><em>ResultTemperatureBasisText</em></p></li>
<li><p><em>ResultValueTypeName</em></p></li>
<li><p><em>ResultWeightBasisText</em></p></li>
<li><p><em>SampleCollectionEquipmentName</em></p></li>
<li><p><em>LaboratoryName</em></p></li>
<li><p><em>MethodDescriptionText</em></p></li>
<li><p><em>ResultParticleSizeBasisText</em></p></li>
<li><p><em>SampleCollectionMethod.MethodIdentifier</em></p></li>
<li><p><em>SampleCollectionMethod.MethodIdentifierContext</em></p></li>
<li><p><em>SampleCollectionMethod.MethodName</em></p></li>
<li><p><em>DataQuality.BiasValue</em></p></li>
<li><p><em>MethodSpeciationName</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodName</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodIdentifier</em></p></li>
<li><p><em>ResultAnalyticalMethod.MethodIdentifierContext</em></p></li>
<li><p><em>AssemblageSampledName</em></p></li>
<li><p><em>DetectionQuantitationLimitTypeName</em></p></li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5_FieldCounts_Chars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, display <span class="op">=</span> <span class="st">"most"</span>, characteristicName <span class="op">=</span> <span class="st">"DISSOLVED OXYGEN (DO)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5_FieldCounts_Chars</span></span></code></pre></div>
<p>Selecting a parameter generates the list above, which is subset by
the selected parameter. The list includes fields you may want to review,
and the number of unique values in each field.</p>
<p>Next, choose a field from the list.</p>
<p>Review the WQX domain files for definitions: <a href="https://www.epa.gov/waterdata/storage-and-retrieval-and-water-quality-exchange-domain-services-and-downloads" class="external-link uri">https://www.epa.gov/waterdata/storage-and-retrieval-and-water-quality-exchange-domain-services-and-downloads</a></p>
<p>Now, we’ll use <strong>TADA_FieldValuesTable</strong> and
<strong>TADA_FieldValuesPie</strong> at the characteristic-level to
review a column of interest. In this example we review values from the
<em>SampleCollectionMethod.MethodName</em> field for Dissolved Oxygen
(DO) results.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Create subset of DO data</span></span>
<span><span class="va">DO_R5ProfileClean8</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean8</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span> <span class="op">==</span> <span class="st">"DISSOLVED OXYGEN (DO)"</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># # Create pie chart for SampleCollectionMethod.MethodName for Dissolved Oxygen (DO results)</span></span>
<span><span class="va">DO_SCM_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, field <span class="op">=</span> <span class="st">"SampleCollectionMethod.MethodName"</span>, characteristicName <span class="op">=</span> <span class="st">"DISSOLVED OXYGEN (DO)"</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">DO_SCM_Pie</span></span>
<span></span>
<span><span class="co"># Create table for SampleCollectionMethod.MethodName for Dissolved Oxygen (DO results)</span></span>
<span><span class="va">FieldValuesTable_DO_scm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, field <span class="op">=</span> <span class="st">"SampleCollectionMethod.MethodName"</span>, characteristicName <span class="op">=</span> <span class="st">"DISSOLVED OXYGEN (DO)"</span><span class="op">)</span></span></code></pre></div>
<p><br>
Generate a scatterplot with two characteristics.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># review unique identifiers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span><span class="op">)</span></span></code></pre></div>
<p>Select two characteristics to plot using the id_cols function
input.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># choose two and generate scatterplot</span></span>
<span><span class="fu"><a href="../reference/TADA_TwoCharacteristicScatterplot.html">TADA_TwoCharacteristicScatterplot</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TEMPERATURE_NA_NA_DEG C"</span>, <span class="st">"DISSOLVED OXYGEN (DO)_NA_NA_MG/L"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we will summarize results for a single comparable data group
using the TADA.ComparableDataIdentifier (i.e., comparable
characteristic, unit, speciation, and fraction combination) using
<strong>TADA_Histogram</strong> and <strong>TADA_Boxplot</strong>. Note
that users may generate a list output of multiple plots if their input
dataset has more than one unique comparable data group.</p>
<p>First, filter the dataframe to include only “DISSOLVED OXYGEN
(DO)_NA_NA_MG/L”</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter dataframe to only "DISSOLVED OXYGEN (DO)_NA_NA_MG/L"</span></span>
<span><span class="va">R5ProfileCleanDO</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span>, <span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"DISSOLVED OXYGEN (DO)_NA_NA_MG/L"</span><span class="op">)</span></span></code></pre></div>
<p>Generate histogram.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate a histogram</span></span>
<span><span class="fu"><a href="../reference/TADA_Histogram.html">TADA_Histogram</a></span><span class="op">(</span><span class="va">R5ProfileCleanDO</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate stats table</span></span>
<span><span class="va">R5ProfileCleanDO_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Stats.html">TADA_Stats</a></span><span class="op">(</span><span class="va">R5ProfileCleanDO</span><span class="op">)</span></span></code></pre></div>
<p>Generate interactive box plot.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_Boxplot.html">TADA_Boxplot</a></span><span class="op">(</span><span class="va">R5ProfileCleanDO</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span></code></pre></div>
<p>Generate a new dataframe with only the daily max dissolved oxygen
values.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileCleanDO_dailymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_AggregateMeasurements.html">TADA_AggregateMeasurements</a></span><span class="op">(</span><span class="va">R5ProfileCleanDO</span>,</span>
<span>  agg_fun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span><span class="op">)</span>,</span>
<span>  clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Generate interactive scatterplot of max daily dissolved oxygen over
time.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_Scatterplot.html">TADA_Scatterplot</a></span><span class="op">(</span><span class="va">R5ProfileCleanDO_dailymax</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 15: Which figure generating functions can be used to
visualize more than one characteristic? Which can be used to visualize
only one characteristic?</strong></p>
</div>
<div class="section level2">
<h2 id="retain-tada-required-columns">Retain TADA Required Columns<a class="anchor" aria-label="anchor" href="#retain-tada-required-columns"></a>
</h2>
<p>Now we can review the “TADA” prefixed columns we have added to the
data set. If we are satisfied with the conversions, filtering, flagging,
etc. and the resulting “TADA” columns, we can use the
<strong>TADA_RetainRequired</strong> function to remove any columns that
are not required or used as filters in the TADA workflow. This reduces
the size of the dataframe.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean9</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_RetainRequired.html">TADA_RetainRequired</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 16: How many columns were removed during
TADA_RetainRequired?</strong></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R5ProfileClean8_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">R5ProfileClean8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R5ProfileClean9_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">R5ProfileClean9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">retain_required_n</span> <span class="op">&lt;-</span> <span class="va">R5ProfileClean8_n</span> <span class="op">-</span> <span class="va">R5ProfileClean9_n</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tada-shiny-application">TADA Shiny Application<a class="anchor" aria-label="anchor" href="#tada-shiny-application"></a>
</h2>
<p>Finally, take a look at an alternative workflow, TADA Shiny Module 1:
Data Discovery and Cleaning. This is a Shiny application that runs many
of the TADA functions covered in this document behind a graphical user
interface. The shiny application queries the WQP, contains maps and data
visualizations, flags suspect data results, handles censored data, and
more. You can launch it using the code below.</p>
<p>DRAFT <a href="https://rconnect-public.epa.gov/TADAShiny/" class="external-link">Module
1</a> is also currently hosted on the web with minimal server
memory/storage allocated.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download TADA Shiny repository</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADAShiny"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># launch the app locally.</span></span>
<span></span>
<span><span class="fu">TADAShiny</span><span class="fu">::</span><span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cristina Mullin, Hillary Marler, Jacob Greif, Elise Hinman, Kenny Wong, Kathryn Willi, Matt Brousil, Kathleen Healy, Justin Bousquin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
