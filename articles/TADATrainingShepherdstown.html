<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A foray into TADA's major functions for users familiar with R and RStudio.">
<title>TADA R Package Training: A Markdown for Shepherdstown • TADA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TADA R Package Training: A Markdown for Shepherdstown">
<meta property="og:description" content="A foray into TADA's major functions for users familiar with R and RStudio.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TADA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CONTRIBUTING.html">Contributing</a>
    <a class="dropdown-item" href="../articles/TADAModule1.html">TADA Module 1: Water Quality Portal Data Discovery and Cleaning</a>
    <a class="dropdown-item" href="../articles/TADAR5.html">TADA Package Training: A Markdown For Region 5 R Users Network</a>
    <a class="dropdown-item" href="../articles/TADATrainingShepherdstown.html">TADA R Package Training: A Markdown for Shepherdstown</a>
    <a class="dropdown-item" href="../articles/WQXValidationService.html">WQX QAQC Service User Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/TADA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>TADA R Package Training: A Markdown for Shepherdstown</h1>
                        <h4 data-toc-skip class="author">TADA Team</h4>
            
            <h4 data-toc-skip class="date">2024-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/TADA/blob/HEAD/vignettes/TADATrainingShepherdstown.Rmd" class="external-link"><code>vignettes/TADATrainingShepherdstown.Rmd</code></a></small>
      <div class="d-none name"><code>TADATrainingShepherdstown.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="welcome">Welcome!<a class="anchor" aria-label="anchor" href="#welcome"></a>
</h2>
<p>Thank you for your interest in Tools for Automated Data Analysis
(TADA). TADA is an open-source tool set built in the R programming
language and available for anyone to download and edit to their specific
needs. This <a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">RMarkdown</a> document
walks users through how to download the TADA R package from GitHub,
access and parameterize several important functions with a sample
dataset, and create basic visualizations. The workflow is similar to a
funnel: at each decision point, data that fail QC checks are removed
from the core dataset and placed in a separate dataframe, while data
that pass are carried into the next step. At the end of the QC checks,
the user should be confident that their data are properly documented and
applicable to the analysis at hand.</p>
<p><strong>Note: TADA is still under development. New functionality is
added weekly, and sometimes we need to make bug fixes in response to
tester and user feedback. We appreciate your feedback, patience, and
interest in these helpful tools.</strong></p>
</div>
<div class="section level2">
<h2 id="customize-or-contribute">Customize or contribute<a class="anchor" aria-label="anchor" href="#customize-or-contribute"></a>
</h2>
<p>TADA is housed in a repository on <a href="https://github.com/USEPA/TADA" class="external-link">GitHub</a>. Users desiring to
review the base code and customize the package for their own purposes
may:</p>
<ul>
<li><p>Clone the repository using Git</p></li>
<li><p>Open the repository using GitHub Desktop, or</p></li>
<li><p>Download a zip file of the repository to their desktop.</p></li>
</ul>
<p>Interested in contributing to the TADA package? The TADA team highly
encourages input and development from users. Check out the <a href="https://usepa.github.io/TADA/articles/CONTRIBUTING.html">Contributing</a>
page on the TADA GitHub site for guidance on collaboration
conventions.</p>
</div>
<div class="section level2">
<h2 id="install-and-setup">Install and setup<a class="anchor" aria-label="anchor" href="#install-and-setup"></a>
</h2>
<p>Users can install the TADA package from GitHub into their R library
using the <code>remotes</code> package. Copy and paste the code below
into your R or RStudio console to download and install.</p>
<p>TADA package relies on other packages, therefore you may be prompted
in the console to update dependency packages that have more recent
versions available. If you see this prompt, it is recommended to update
all of them (enter 1 into the console).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install TADA</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"remotes"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADA"</span>, ref <span class="op">=</span> <span class="st">"develop"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/TADA/">TADA</a></span><span class="op">)</span></span></code></pre></div>
<p>It’s that easy! The most stable branch for TADA right now is the
develop branch. Contributors generally create their own branches based
on develop, make some improvements, and then submit a pull request to be
reviewed by the TADA Team. Once approved, updates are then merged into
the develop branch. However, you are welcome to download any branch
you’d like using the <code>ref</code> input in
<code>install_github</code> (see code chunk above). This functionality
is mainly only useful to TADA package developers/contributors.</p>
<p>The following code block ensures the additional packages needed to
run the code in this RMarkdown document are loaded. However, users may
also use the <code>package name:: package function</code> notation to
avoid the list of <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list.of.packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span>
<span><span class="va">new.packages</span> <span class="op">&lt;-</span> <span class="va">list.of.packages</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">list.of.packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="help-pages">Help pages<a class="anchor" aria-label="anchor" href="#help-pages"></a>
</h2>
<p>All TADA R package functions have their own individual help pages,
listed on the <a href="https://usepa.github.io/TADA/reference/index.html">Function
reference</a> page on the GitHub site. Users can also access the help
page for a given function in R or RStudio using the following format
(example below): <code>?TADA::[name of TADA function]</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">TADA</span><span class="fu">::</span><span class="va"><a href="../reference/TADA_DataRetrieval.html">TADA_DataRetrieval</a></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="upload-data">Upload data<a class="anchor" aria-label="anchor" href="#upload-data"></a>
</h2>
<p>Now let’s start using the TADA R package functions. The first step is
to bring a dataset into the R environment. TADA is designed to work with
<a href="https://www.waterqualitydata.us/" class="external-link">Water Quality Portal</a>
(WQP) data. This means that all of its functions will look for WQP
column names and create new TADA-specific columns based on these
elements. Users may upload their own custom dataset into R for use with
TADA by ensuring their column names and data formats (e.g. numeric,
character) align with WQP profiles.</p>
<p>If you are interested in reviewing the column headers and formats
required to run TADA, use the function below, which saves an example
spreadsheet to the user’s working directory. You can also take a look at
an example dataset, like <code><a href="../reference/Data_Nutrients_UT.html">TADA::Data_Nutrients_UT</a></code> to get an
idea of the data structure and format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find your working directory</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_GetTemplate.html">TADA_GetTemplate</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># download template to working directory</span></span>
<span></span>
<span><span class="co"># uncomment below to review example dataset</span></span>
<span><span class="co"># Data_Nutrients_UT &lt;- TADA::Data_Nutrients_UT</span></span></code></pre></div>
<p><code>TADA_DataRetrieval</code> is built upon USGS’s
<code>readWQPdata</code> function within the dataRetrieval package,
which uses web service calls to bring WQP data into the R environment.
Additionally, <code>TADA_DataRetrieval</code> performs some basic
quality control checks on the data using new TADA-specific columns to
preserve the original dataset:</p>
<ul>
<li><p>Converts key character columns to ALL CAPS for easier
harmonization and validation.</p></li>
<li><p>Removes complete duplicate results.</p></li>
<li><p>Identifies different classes of result values (numeric, text,
percentage, comma-separated numeric, greater than/less than, numbers
preceded by a tilde, etc.) and converts values to numeric where
feasible.</p></li>
<li><p>Fills NA result values and units with detection limit values and
units where the detection condition text indicates a censored data
value. Identifies censored data results and categorizes them as
over-detect, non-detect, or other. These data preprocessing features
facilitate more complex detection limit value handling using other TADA
functions (more details to come later in this training).</p></li>
<li><p>Unifies result and depth units to common units to improve ease of
data harmonization. See <code><a href="../reference/TADA_ConvertResultUnits.html">?TADA_ConvertResultUnits</a></code> and
<code><a href="../reference/TADA_ConvertDepthUnits.html">?TADA_ConvertDepthUnits</a></code> for more information on these
processes.</p></li>
</ul>
<p>Let’s give it a try. <code>TADA_DataRetrieval</code> follows similar
parameterization to <code>readWQPdata</code>, but check out the <a href="https://usepa.github.io/TADA/reference/TADA_DataRetrieval.html">help
page</a> or enter ?TADA::TADA_DataRetrieval into the console for more
information about input parameters and to see several examples.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download data for NCTC's HUC12</span></span>
<span><span class="co"># dataset_0 = TADA::TADA_DataRetrieval(</span></span>
<span><span class="co">#   startDate = "2020-06-22",</span></span>
<span><span class="co">#   endDate = "null",</span></span>
<span><span class="co">#   countycode = "null",</span></span>
<span><span class="co">#   huc = "02070004",</span></span>
<span><span class="co">#   siteid = "null",</span></span>
<span><span class="co">#   siteType = "null",</span></span>
<span><span class="co">#   characteristicName = "null",</span></span>
<span><span class="co">#   characteristicType = "null",</span></span>
<span><span class="co">#   sampleMedia = "null",</span></span>
<span><span class="co">#   statecode = "null",</span></span>
<span><span class="co">#   organization = "null",</span></span>
<span><span class="co">#   project = "null",</span></span>
<span><span class="co">#   applyautoclean = TRUE</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="co"># For brevity, we'll skip pinging the WQP and instead load the example dataset:</span></span>
<span><span class="va">dataset_0</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="va"><a href="../reference/Data_NCTCShepherdstown_HUC12.html">Data_NCTCShepherdstown_HUC12</a></span></span>
<span></span>
<span><span class="co"># Let's take a look at all of the TADA-created columns:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"TADA."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Currently, the <code>TADA_DataRetrieval</code> function combines
three WQP data profiles: Sample Results (Physical/Chemical), Site data,
and Project data. This ensures that all important quality control
columns are included in the dataset.</p>
<p><strong>Note:</strong> USGS and EPA are working together to create
WQP 3.0 data profiles. Once released, one data profile will contain the
columns critical to TADA, removing the need to combine profiles in this
first step. TADA package users likely will not notice a difference in
their usage of the <code>TADA_DataRetrieval</code> function, but it will
simplify the steps needed to upload a custom or WQP GUI-downloaded
dataset into the R package.</p>
</div>
<div class="section level2">
<h2 id="initial-data-review">Initial data review<a class="anchor" aria-label="anchor" href="#initial-data-review"></a>
</h2>
<p>Now that we’ve pulled the data into the R session, let’s take a look
at it. Note that any column names with a leading “TADA.” were generated
from the TADA_DataRetrieval function.</p>
<p>First, always good to take a look at the data frame dimensions.</p>
<p><strong>Question 1: What are the dimensions of your
dataset?</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span> <span class="co"># returns x and of x (as the numbers of rows and columns respectively)</span></span></code></pre></div>
<p>Before we start filtering and flagging our data, let’s create a
function (dimCheck) that performs dimension checks between the results
that pass each filter or QC flag check (and are retained) and those that
do not (and are removed). These dimension checks ensure that the total
number of rows in the original input dataset (all_result_num) equal the
the total number of rows added up between the passing (pass_data) and
removed (fail_data) data frames.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># defining a dimension check function that compares removed and retained data dimensions against the initial data input</span></span>
<span><span class="va">dimCheck</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">pass_data</span>, <span class="va">fail_data</span>, <span class="va">checkName</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># check result numbers after split</span></span>
<span>  <span class="va">final_result_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pass_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fail_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># always good to do a dimension check</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">all_result_num</span> <span class="op">==</span> <span class="va">final_result_num</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Help! Results do not add up between dataset and removed after "</span>, <span class="va">checkName</span>, <span class="st">" check."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Good to go. Zero results created or destroyed in "</span>, <span class="va">checkName</span>, <span class="st">" check."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># let's first get the total number of rows in the dataset.</span></span>
<span><span class="va">all_result_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Next, we can use the TADA <code><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts()</a></code> function to
see how many unique values are contained within each column of the
dataset. The function can either return all column counts, most, or just
the key columns. We’ll try the input with <code>display = "key"</code>
and <code>display = "all"</code>. Enter ?TADA::TADA_FieldCounts() into
the console for more information on this function.</p>
<p><strong>Question 2: Which column should have a unique value in every
row and why?</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">dataset_0</span>, display <span class="op">=</span> <span class="st">"key"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">dataset_0</span>, display <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 3: How many unique ‘TADA.ActivityMediaName’ values
exist in your dataset? Are there any media types that are not
water?</strong></p>
<p>TADA is currently designed to accommodate water data from the WQP.
Let’s ensure that we remove all non-water data first.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove data with media type that is not water</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="va">dataset_0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">TADA.ActivityMediaName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WATER"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Activity media is not water."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># what other media types exist in dataset?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">removed</span><span class="op">$</span><span class="va">TADA.ActivityMediaName</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clean dataset contains only water</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset_0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ActivityMediaName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WATER"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Activity Media"</span><span class="op">)</span></span></code></pre></div>
<p>Two additional helper functions one can use at any step in the
process are <code><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable()</a></code> and
<code><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie()</a></code>. These functions create a summary
table and pie chart (respectively) of all the unique values in a given
column. Let’s give it a try on ActivityTypeCode, which is a WQP column
describing the type of sample collected for each result.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 4: When might a user choose to view a column’s
unique values as a table rather than in a pie chart?</strong></p>
<p>We can take a quick look at some of the TADA-created columns that
review result value types. Because TADA is intended to work with numeric
data, at this point, it would be good to remove those result values that
are NA without any detection limit info, or contain text or special
characters that cannot be converted to numeric. Note that TADA will fill
in missing values with detection limit values and units if the
ResultDetectionConditionText and DetectionQuantitationLimitType fields
are populated. Use <code><a href="../reference/TADA_ConvertSpecialChars.html">?TADA_ConvertSpecialChars</a></code> for more
details on result value types and handling.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># take a look at datatypes</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Numeric or numeric-coerced data types</span></span>
<span><span class="va">rv_datatypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rv_datatypes</span></span>
<span></span>
<span><span class="co"># Non-numeric data types coerced to NA</span></span>
<span><span class="va">na_rv_datatypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="va">na_rv_datatypes</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># these are all of the NOT allowable data types in the dataset.</span></span>
<span><span class="va">incompatible_datatype</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="st">"Less Than"</span>, <span class="st">"Greater Than"</span>, <span class="st">"Approximate Value"</span>, <span class="st">"Percentage"</span>, <span class="st">"Comma-Separated Numeric"</span>, <span class="st">"Numeric Range - Averaged"</span>, <span class="st">"Result Value/Unit Copied from Detection Limit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Result value type cannot be converted to numeric or no detection limit values provided."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take a look at the difficult data types - do they make sense?</span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">incompatible_datatype</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TADA.CharacteristicName"</span>, <span class="st">"ResultMeasureValue"</span>, <span class="st">"TADA.ResultMeasureValue"</span>, <span class="st">"ResultMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.ResultMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span>, <span class="st">"DetectionQuantitationLimitMeasure.MeasureValue"</span>, <span class="st">"TADA.DetectionQuantitationLimitMeasure.MeasureValue"</span>, <span class="st">"DetectionQuantitationLimitMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.DetectionQuantitationLimitMeasure.MeasureUnitCode"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="st">"Less Than"</span>, <span class="st">"Greater Than"</span>, <span class="st">"Approximate Value"</span>, <span class="st">"Percentage"</span>, <span class="st">"Comma-Separated Numeric"</span>, <span class="st">"Numeric Range - Averaged"</span>, <span class="st">"Result Value/Unit Copied from Detection Limit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">incompatible_datatype</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">incompatible_datatype</span>, <span class="va">check</span>, <span class="va">rv_datatypes</span>, <span class="va">na_rv_datatypes</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Result Format"</span><span class="op">)</span></span></code></pre></div>
<p>During <code>TADA_DataRetrieval</code>, TADA automatically sorts
result values into detection limit categories (e.g. non-detect,
over-detect) based on populated values in the
ResultDetectionConditionText and DetectionQuantitationLimitTypeName
columns. You can find the reference tables used to make these decisions
in <code><a href="../reference/TADA_GetDetCondRef.html">TADA_GetDetCondRef()</a></code> and
<code><a href="../reference/TADA_GetDetLimitRef.html">TADA_GetDetLimitRef()</a></code> functions. In some cases, results are
missing detection limit/condition info, or there is a conflict in the
detection limit and condition. The user may want to remove problematic
detection limit data before proceeding.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"TADA.CensoredData.Flag"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">problem_censored</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">TADA.CensoredData.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-Detect"</span>, <span class="st">"Over-Detect"</span>, <span class="st">"Other"</span>, <span class="st">"Uncensored"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Detection limit information contains errors or missing information."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's take a look at the problematic data that we filtered out (if any)</span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">problem_censored</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TADA.CharacteristicName"</span>, <span class="st">"ResultDetectionConditionText"</span>, <span class="st">"DetectionQuantitationLimitTypeName"</span>, <span class="st">"TADA.CensoredData.Flag"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.CensoredData.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-Detect"</span>, <span class="st">"Over-Detect"</span>, <span class="st">"Other"</span>, <span class="st">"Uncensored"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">problem_censored</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">problem_censored</span>, <span class="va">check</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Censored Data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-flagging">Data flagging<a class="anchor" aria-label="anchor" href="#data-flagging"></a>
</h2>
<p>We’ve taken a quick look at the raw dataset and split off some data
that are not compatible with TADA, now let’s run through some quality
control checks. The most important ones to run to ensure your dataset is
ready for subsequent steps are <code><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction()</a></code>,
<code><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation()</a></code>, <code><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit()</a></code>,
and <code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code>. With the exception of
<code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code>, these flagging functions leverage
WQX’s <a href="https://cdx.epa.gov/wqx/download/DomainValues/QAQCCharacteristicValidation.CSV" class="external-link">QAQC
Validation Table</a>. <code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code> uses a
TADA-specific domain table users can review with
<code><a href="../reference/TADA_GetActivityTypeRef.html">TADA_GetActivityTypeRef()</a></code>. All QAQC tables are frequently
updated in the package to ensure they match the latest version on the
web. You can find guidance for using the WQX QAQC Validation Tables in
this <a href="https://usepa.github.io/TADA/articles/WQXValidationService.html">vignette</a>
on the TADA GitHub site.</p>
<p>Bring the QAQC Validation Table into your R session to view or save
with the following command:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qaqc_ref</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_GetWQXCharValRef.html">TADA_GetWQXCharValRef</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">qaqc_ref</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">qaqc_ref</span><span class="op">$</span><span class="va">Type</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 5: What do you think the <code>qaqc_ref$Type</code>
column indicates?</strong></p>
<p>TADA joins this validation table to the data and uses the “Valid” and
“Invalid” labels in the Status column to create easily understandable
flagging columns for each function. Let’s run these four flagging
functions.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction</a></span><span class="op">(</span><span class="va">dataset</span>, clean <span class="op">=</span> <span class="cn">FALSE</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="st">"none"</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="st">"none"</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="cn">FALSE</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset_flags</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Run Flag Functions"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 6: Did any warnings or messages appear in the
console after running these flagging functions? What do they
say?</strong></p>
<p>Now that we’ve run all the key flagging functions, let’s take a look
at the results and make some decisions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.SampleFraction.Flag"</span><span class="op">)</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.MethodSpeciation.Flag"</span><span class="op">)</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ResultUnit.Flag"</span><span class="op">)</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ActivityType.Flag"</span><span class="op">)</span></span></code></pre></div>
<p>Any results flagged as “Invalid” are recognized in the QAQC
Validation Table as having some data quality issue. “NonStandardized”
means that the format has not been fully vetted or processed, while
“Valid” confirms that the characteristic combination is widely
recognized as correctly formatted. Let’s add any invalid results to the
removed dataset for later review.</p>
<p><strong>Note: if you find any errors in the QAQC Validation Table,
please contact the WQX Help Desk at WQX@epa.gov to help correct it.
Thanks in advance!</strong></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># grab all the flagged results from the four functions</span></span>
<span><span class="va">problem_flagged</span> <span class="op">&lt;-</span> <span class="va">dataset_flags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.SampleFraction.Flag</span> <span class="op">==</span> <span class="st">"Invalid"</span> <span class="op">|</span> <span class="va">TADA.MethodSpeciation.Flag</span> <span class="op">==</span> <span class="st">"Invalid"</span> <span class="op">|</span> <span class="va">TADA.ResultUnit.Flag</span> <span class="op">==</span> <span class="st">"Invalid"</span> <span class="op">|</span> <span class="op">!</span><span class="va">TADA.ActivityType.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="st">"Non_QC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Invalid Unit, Method, Speciation, or Activity Type."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="va">dataset_flags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">ResultIdentifier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">problem_flagged</span><span class="op">$</span><span class="va">ResultIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">problem_flagged</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">problem_flagged</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset_flags</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Filter Flag Functions"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 7: Are there any other metadata columns that you
review and filter in your workflow?</strong></p>
<p>We’ve finished running the recommended flagging functions and
removing results that do not pass QC checks. Let’s look at the breakdown
of these data in the removed object.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">removed</span>, field <span class="op">=</span> <span class="st">"TADA.RemovalReason"</span><span class="op">)</span></span></code></pre></div>
<p>You can review any other columns of interest and create custom domain
tables of your “Valid” and “Invalid” criteria using R or Excel. Also
check out some of the other flagging functions available in TADA:</p>
<ul>
<li><p><code>?TADA_FlagAboveThreshold()</code></p></li>
<li><p><code>?TADA_FlagBelowThreshold()</code></p></li>
<li><p><code>?TADA_FindContinuousData()</code></p></li>
<li><p><code>?TADA_FlagCoordinates()</code></p></li>
<li><p><code>?TADA_FlagMethod()</code></p></li>
<li><p><code>?TADA_FindQAPPApproval()</code></p></li>
<li><p><code>?TADA_FindQAPPDoc()</code></p></li>
<li><p><code>?TADA_FindPotentialDuplicates()</code> - in
development</p></li>
</ul>
<p>Please let us know of other flagging functions you think would have
broad appeal in the TADA package or need assistance
brainstorming/developing.</p>
</div>
<div class="section level2">
<h2 id="censored-data-handling">Censored data handling<a class="anchor" aria-label="anchor" href="#censored-data-handling"></a>
</h2>
<p>We have already identified, flagged, and in some cases removed
problematic detection limit data from our dataset, but that doesn’t keep
them from being difficult. Because we do not know the result value with
adequate precision, water quality data users often set non-detect values
to some number below the reported detection limit. TADA contains some
simple methods for handling detection limits: users may multiply the
detection limit by some number between 0 and 1, or convert the detection
limit value to a random number between 0 and the detection limit. More
complex detection limit estimation requiring regression models (Maximum
Likelihood, Kaplan-Meier, Robust Regression on Order Statistics) or
similar must be performed outside of the current version of TADA (though
future development is planned).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_cens</span> <span class="op">&lt;-</span> <span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods</a></span><span class="op">(</span><span class="va">dataset_flags</span>, nd_method <span class="op">=</span> <span class="st">"multiplier"</span>, nd_multiplier <span class="op">=</span> <span class="fl">0.5</span>, od_method <span class="op">=</span> <span class="st">"as-is"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 8: How would you parameterize
<code><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods()</a></code> to make non-detect values a
random number between 0 and the provided detection limit?</strong></p>
<p>Let’s take a look at how the censored data handling function affects
the <code>TADA.ResultMeasureValueDataTypes.Flag</code> column.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span>
<span><span class="co"># after</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 9: Is there a difference between the first and
second tables?</strong></p>
<p>If you’d like to start thinking about using statistical methods to
estimate detection limit values, check out the
<code>?TADA_SummarizeCensoredData</code> function, which accepts
user-defined data groupings to prescribe estimation tests based on the
number of results, % of dataset censored, and number of censoring levels
(detection limits). The decision tree used in the function was outlined
in an <a href="https://www.epa.gov/sites/default/files/2016-05/documents/tech_notes_10_jun2014_r.pdf" class="external-link">National
Nonpoint Source Tech Memo</a>.</p>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>How are you feeling about your test dataset? Does it seem ready for
the next step(s) in your analyses? There’s probably a lot more you’d
like to look at/filter out before you’re ready to say: QC complete.
Let’s first check out characteristics in the dataset using
<code>dplyr</code> functions and pipes.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display full table</span></span>
<span><span class="va">nrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dataset_cens</span><span class="op">$</span><span class="va">TADA.CharacteristicName</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get table of characteristics with number of results, sites, and organizations</span></span>
<span><span class="va">dataset_cens</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Result_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ResultIdentifier</span><span class="op">)</span>, Site_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">MonitoringLocationIdentifier</span><span class="op">)</span><span class="op">)</span>, Org_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">OrganizationIdentifier</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Result_Count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nrow</span><span class="op">)</span></span></code></pre></div>
<p>You may see a characteristic that you’d like to investigate further
in isolation. <code><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie()</a></code> will also produce
summary pie charts for a given column <em>within</em> a specific
characteristic. Let’s take a look.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># go ahead and pick a characteristic name from the table generated above. I picked nitrogen, mixed forms</span></span>
<span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.ResultSampleFractionText"</span>, characteristicName <span class="op">=</span> <span class="st">"NITROGEN, MIXED FORMS (NH3), (NH4), ORGANIC, (NO2) AND (NO3)"</span><span class="op">)</span></span></code></pre></div>
<p>We can view the site locations using a TADA mapping function. In this
map, the circles indicate monitoring locations in the dataset; their
size corresponds to the number of results collected at that site, while
the darker the circle, the more characteristics were sampled at that
site.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_OverviewMap.html">TADA_OverviewMap</a></span><span class="op">(</span><span class="va">dataset_cens</span><span class="op">)</span></span></code></pre></div>
<p>Out of curiosity, let’s take a look at a breakdown of these
monitoring location types. Do they all indicate surface water samples?
Depending upon your program’s goals and methods, you might want to
filter out some of the types you see.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"MonitoringLocationTypeName"</span><span class="op">)</span></span></code></pre></div>
<p>One of the next big steps is data harmonization: translating and
aggregating synonyms, combining multiple forms/species of certain
characteristics, etc. We won’t get to that in this demo (more coming
soon in TADA!), but we can start looking at data distributions within a
single characteristic-speciation-fraction-unit using the plotting
functions <code><a href="../reference/TADA_Histogram.html">TADA_Histogram()</a></code> and <code><a href="../reference/TADA_Boxplot.html">TADA_Boxplot()</a></code>.
We can also view a stats table using <code>TADA_Stats</code>.</p>
<p>Let’s first take a look at the column TADA.ComparableDataIdentifier,
which breaks down characteristics into groups by name, fraction,
speciation, and unit. These four columns are important to evaluate
together to ensure the plotted data are sufficiently similar to appear
on a single plot together: it doesn’t make sense to plot characteristics
with different units or fractions in the same distribution.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trusty field values table - lets just look at the first few entries with the most associated records</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have an idea for what the TADA.ComparableDataIdentifier
looks like, we can check out how it is used to plot distinct
characteristic groups.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at a histogram, boxplot, and stats for TADA.ComparableDataIdentifier(s) of your choice.</span></span>
<span><span class="va">comp_data_id</span> <span class="op">&lt;-</span> <span class="st">"TEMPERATURE, WATER_NA_NA_DEG C"</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset_cens</span>, <span class="va">dataset_cens</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">comp_data_id</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Histogram.html">TADA_Histogram</a></span><span class="op">(</span><span class="va">plot_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Boxplot.html">TADA_Boxplot</a></span><span class="op">(</span><span class="va">plot_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">TADA</span><span class="fu">::</span><span class="fu"><a href="../reference/TADA_Stats.html">TADA_Stats</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can download our PASS and FAIL datasets together into an
Excel spreadsheet.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_and_removed</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dataset_cens</span>, <span class="va">removed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Un-comment to download Excel spreadsheet to your working directory</span></span>
<span><span class="co"># install.packages(writexl)</span></span>
<span><span class="co"># library(writexl)</span></span>
<span><span class="co"># writexl::write_xlsx(dataset_and_removed, "NCTCShepherdstownData.xlsx")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tada-r-shiny-modules">TADA R Shiny Modules<a class="anchor" aria-label="anchor" href="#tada-r-shiny-modules"></a>
</h2>
<p>Finally, take a look at an alternative workflow for QC’ing WQP data:
TADA Shiny Module 1: Data Discovery and Cleaning. This is a Shiny
application that runs many of the TADA functions covered in this
training document behind a graphical user interface. The shiny
application queries the WQP, contains maps and data visualizations,
flags suspect data results, handles censored data, and more. You can
launch it using the code below.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download TADA Shiny repository</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADAShiny"</span>, ref <span class="op">=</span> <span class="st">"develop"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># launch the app locally.</span></span>
<span><span class="fu">TADAShiny</span><span class="fu">::</span><span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>DRAFT <a href="https://owshiny-dev.app.cloud.gov/tada-dev/" class="external-link">Module
1</a> is also currently hosted on the web with minimal server
memory/storage allocated.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by U.S. Environmental Protection Agency, Cristina Mullin, Jacob Greif, Elise Hinman, Hillary Marler, Kathleen Healy, Justin Bousquin, Renae Myers.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
