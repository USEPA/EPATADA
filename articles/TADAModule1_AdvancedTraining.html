<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TADA Module 1: Training for Intermediate/Advanced R Users • EPATADA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TADA Module 1: Training for Intermediate/Advanced R Users">
<meta name="description" content="A foray into major TADA Module 1 functions for users familiar with R and RStudio.">
<meta property="og:description" content="A foray into major TADA Module 1 functions for users familiar with R and RStudio.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EPATADA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CONTRIBUTING.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/TADAAssessmentUnitUseCase.html">TADA: Assessment Unit Use Case Demo</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_AdvancedTraining.html">TADA Module 1: Training for Intermediate/Advanced R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_BeginnerTraining.html">TADA Module 1: Training for Beginner R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1.html">TADA Module 1: Water Quality Portal Data Discovery and Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule2.html">TADA Module 2: Geospatial Functions</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule3_PartA.html">TADA Module 3A: Associating WQP Characteristic Names with Applicable ATTAINS State, Tribal or EPA 304(a) Parameter and Use Names</a></li>
    <li><a class="dropdown-item" href="../articles/TADAWaterSciConWorkshopDemo.html">TADA: WaterSciCon Workshop Demo</a></li>
    <li><a class="dropdown-item" href="../articles/WQXValidationService.html">WQX QAQC Service User Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/EPATADA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TADA Module 1: Training for Intermediate/Advanced R Users</h1>
                        <h4 data-toc-skip class="author">TADA Team</h4>
            
            <h4 data-toc-skip class="date">2025-03-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EPATADA/blob/develop/vignettes/TADAModule1_AdvancedTraining.Rmd" class="external-link"><code>vignettes/TADAModule1_AdvancedTraining.Rmd</code></a></small>
      <div class="d-none name"><code>TADAModule1_AdvancedTraining.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="welcome">Welcome!<a class="anchor" aria-label="anchor" href="#welcome"></a>
</h2>
<p>Thank you for your interest in Tools for Automated Data Analysis
(TADA). TADA is an open-source tool set built in the R programming
language and available for anyone to download and edit to their specific
needs. This <strong>TADA Module 1: Training for Intermediate/Advanced R
Users</strong> RMarkdown document (<a href="https://bookdown.org/yihui/rmarkdown/" class="external-link">learn more about
RMarkdown</a>) walks through how to download the TADA R package from
GitHub, access and parameterize several important functions with a
sample dataframe, and create basic visualizations. The workflow is
similar to a funnel: at each decision point, data that fail QC checks
are removed from the core dataframe and placed in a separate dataframe,
while data that pass are carried into the next step. At the end of the
QC checks, the user should be confident that their data are properly
documented and applicable to the analysis at hand.</p>
<p><strong>Note: TADA is still under development. New functionality is
added weekly, and sometimes we need to make bug fixes in response to
tester and user feedback. We appreciate your feedback, patience, and
interest in these helpful tools.</strong></p>
</div>
<div class="section level2">
<h2 id="customize-or-contribute">Customize or contribute<a class="anchor" aria-label="anchor" href="#customize-or-contribute"></a>
</h2>
<p>TADA is housed in a repository on <a href="https://github.com/USEPA/EPATADA" class="external-link">GitHub</a>. Users desiring to
review the base code and customize the package for their own purposes
may:</p>
<ul>
<li><p>Clone the repository using Git</p></li>
<li><p>Open the repository using GitHub Desktop, or</p></li>
<li><p>Download a zip file of the repository to their desktop.</p></li>
</ul>
<p>Interested in contributing to the TADA package? The TADA team highly
encourages input and development from users. Check out the <a href="https://usepa.github.io/EPATADA/articles/CONTRIBUTING.html">Contributing</a>
page on the TADA GitHub site for guidance on collaboration
conventions.</p>
</div>
<div class="section level2">
<h2 id="install-and-setup">Install and setup<a class="anchor" aria-label="anchor" href="#install-and-setup"></a>
</h2>
<p>Users can install the TADA package from GitHub into their R library
using the <code>remotes</code> package. Copy and paste the code below
into your R or RStudio console to download and install.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"remotes"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span></code></pre></div>
<p>TADA package relies on other packages, therefore you may be prompted
in the console to update dependency packages that have more recent
versions available. If you see this prompt, it is recommended to update
all of them (enter 1 into the console).</p>
<p>The most stable branch for TADA right now is the develop branch.
Contributors generally create their own branches based on develop, make
some improvements, and then submit a pull request to be reviewed by the
TADA Team. Once approved, updates are then merged into the develop
branch. However, you are welcome to download any branch you’d like using
the <code>ref</code> input in <code>install_github</code> (see code
chunk below). This functionality is mainly only useful to TADA package
developers/contributors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/EPATADA"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Use the <strong>library()</strong> function to load the TADA R
Package into your R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/EPATADA/">EPATADA</a></span><span class="op">)</span></span></code></pre></div>
<p>It’s that easy!</p>
<p>The following code block ensures the additional packages needed to
run the code in this RMarkdown document are loaded. However, users may
also use the <code>package name:: package function</code> notation to
avoid the list of <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> calls.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"tidyverse"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="help-pages">Help pages<a class="anchor" aria-label="anchor" href="#help-pages"></a>
</h2>
<p>All TADA R package functions have their own individual help pages,
listed on the <a href="https://usepa.github.io/EPATADA/reference/index.html">Function
reference</a> page on the GitHub site. Users can also access the help
page for a given function in R or RStudio using the following format
(example below): <code>?[name of TADA function]</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">TADA_DataRetrieval</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="upload-data">Upload data<a class="anchor" aria-label="anchor" href="#upload-data"></a>
</h2>
<p>Now let’s start using the TADA R package functions. The first step is
to bring a dataframe into the R environment. TADA is designed to work
with <a href="https://www.waterqualitydata.us/" class="external-link">Water Quality Portal</a>
(WQP) data. This means that all of its functions will look for WQP
column names and create new TADA-specific columns based on these
elements. Users may upload their own custom dataframe into R for use
with TADA by ensuring their column names and data formats (e.g. numeric,
character) align with WQP profiles.</p>
<p>If you are interested in reviewing the column headers and formats
required to run TADA, use the function below, which saves an example
spreadsheet to the user’s working directory. You can also take a look at
an example dataframe, like <code>Data_Nutrients_UT</code> to get an idea
of the data structure and format.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find your working directory</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetTemplate.html">TADA_GetTemplate</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># download template to working directory</span></span>
<span></span>
<span><span class="co"># review example dataframe</span></span>
<span><span class="va">exampledata_Nutrients_UT</span> <span class="op">&lt;-</span> <span class="va">Data_Nutrients_UT</span></span></code></pre></div>
<p><code>TADA_DataRetrieval</code> is built upon USGS’s
<code><a href="https://rdrr.io/pkg/dataRetrieval/man/readWQPdata.html" class="external-link">dataRetrieval::readWQPdata</a></code> and
<code><a href="https://rdrr.io/pkg/dataRetrieval/man/wqpSpecials.html" class="external-link">dataRetrieval::whatWQPsites</a></code> functions within the
dataRetrieval package, which uses web service calls to bring WQP data
into the R environment. Additionally, <code>TADA_DataRetrieval</code>
performs some basic quality control checks via
<code>TADA_AutoClean</code> on the data using new TADA-specific columns
to preserve the original dataframe:</p>
<ul>
<li><p>Converts key character columns to ALL CAPS for easier
harmonization and validation.</p></li>
<li><p>Identifies different classes of result values (numeric, text,
percentage, comma-separated numeric, greater than/less than, numbers
preceded by a tilde, etc.) and converts values to numeric where
feasible.</p></li>
<li><p>Unifies result and depth units to common units to improve ease of
data harmonization. See <code><a href="../reference/TADA_ConvertResultUnits.html">?TADA_ConvertResultUnits</a></code> and
<code><a href="../reference/TADA_ConvertDepthUnits.html">?TADA_ConvertDepthUnits</a></code> for more information on these
processes. These functions can also be run separately if the user wishes
to convert result or depth values to different units.</p></li>
</ul>
<p>Let’s give it a try. Setting applyautoclean to TRUE in
<code>TADA:TADA_DataRetrieval</code> means that the basic quality
control steps described above are run. See <code><a href="../reference/TADA_AutoClean.html">?TADA_AutoClean</a></code>
for more details. <code>TADA_DataRetrieval</code> follows similar
parameterization to the dataRetrieval package function
<code><a href="https://rdrr.io/pkg/dataRetrieval/man/readWQPdata.html" class="external-link">dataRetrieval::readWQPdata</a></code>, but check out the <a href="https://usepa.github.io/EPATADA/reference/TADA_DataRetrieval.html">help
page</a> or enter <code><a href="../reference/TADA_DataRetrieval.html">?TADA_DataRetrieval</a></code> into the console for
more information about input parameters and to see several examples.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download example data</span></span>
<span><span class="co"># dataset_0  &lt;- TADA_DataRetrieval(</span></span>
<span><span class="co">#   organization = c("REDLAKE_WQX",</span></span>
<span><span class="co">#                    "SFNOES_WQX",</span></span>
<span><span class="co">#                    "PUEBLO_POJOAQUE",</span></span>
<span><span class="co">#                    "FONDULAC_WQX",</span></span>
<span><span class="co">#                    "PUEBLOOFTESUQUE",</span></span>
<span><span class="co">#                    "CNENVSER"),</span></span>
<span><span class="co">#   startDate = "2018-01-01",</span></span>
<span><span class="co">#   endDate = "2023-01-01")</span></span>
<span></span>
<span><span class="co"># For brevity, we'll skip pinging the WQP and instead load the example dataframe:</span></span>
<span><span class="va">dataset_0</span> <span class="op">&lt;-</span> <span class="va">Data_6Tribes_5y</span></span>
<span></span>
<span><span class="co"># Let's take a look at all of the TADA-created columns:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"TADA."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Currently, the <code>TADA_DataRetrieval</code> function combines
three WQP data profiles: Sample Results (Physical/Chemical), Site data,
and Project data. This ensures that all important quality control
columns are included in the dataframe.</p>
<p><strong>Note:</strong> USGS and EPA are working together to create
WQP 3.0 data profiles. Once released (coming in 2025), one data profile
will contain the columns critical to TADA, removing the need to combine
profiles in this first step. This will simplify the steps needed to
upload a custom or WQP GUI-downloaded dataframe into the R package.
However, column names are changing in the new WQP 3.0 data profiles.
This may impact TADA package users usage of the
<code>TADA_DataRetrieval</code> function in their workflows. The WQP and
TADA teams are available to assist with cross walking the old to new
column names when the time comes.</p>
</div>
<div class="section level2">
<h2 id="initial-data-review">Initial data review<a class="anchor" aria-label="anchor" href="#initial-data-review"></a>
</h2>
<p>Now that we’ve pulled the data into the R session, let’s take a look
at it. Note that any column names with the “TADA.” prefix were generated
from the <code>TADA_DataRetrieval</code> function.</p>
<p>First, always good to take a look at the dataframe dimensions.</p>
<p><strong>Question 1: What are the dimensions of your
dataframe?</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span> <span class="co"># returns x and of x (as the numbers of rows and columns respectively)</span></span></code></pre></div>
<p>Before we start filtering and flagging our data, let’s create a
function (<code>dimCheck</code>) that performs dimension checks between
the results that pass each filter or QC flag check (and are retained)
and those that do not (and are removed). These dimension checks ensure
that the total number of rows in the original input dataframe
(<code>all_result_num</code>) equal the the total number of rows added
up between the passing (<code>pass_data</code>) and removed
(<code>fail_data</code>) dataframes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># defining a dimension check function that compares removed and retained data dimensions against the initial data input</span></span>
<span><span class="va">dimCheck</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">pass_data</span>, <span class="va">fail_data</span>, <span class="va">checkName</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># check result numbers after split</span></span>
<span>  <span class="va">final_result_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pass_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fail_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># always good to do a dimension check</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">all_result_num</span> <span class="op">==</span> <span class="va">final_result_num</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Help! Results do not add up between dataframe and removed after "</span>, <span class="va">checkName</span>, <span class="st">" check."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Good to go. Zero results created or destroyed in "</span>, <span class="va">checkName</span>, <span class="st">" check."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># let's first get the total number of rows in the dataframe.</span></span>
<span><span class="va">all_result_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dataset_0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Next, we can use the <code><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts()</a></code> function to see
how many unique values are contained within each column of the
dataframe. The function can either return all column counts, most, or
just the key columns. We’ll try the input with
<code>display = "key"</code> and <code>display = "all"</code>. Enter
<code>?TADA_FieldCounts()</code> into the console for more information
on this function.</p>
<p><strong>Question 2: Which column should have a unique value in every
row and why?</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">key_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">dataset_0</span>, display <span class="op">=</span> <span class="st">"key"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">key_counts</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldCounts.html">TADA_FieldCounts</a></span><span class="op">(</span><span class="va">dataset_0</span>, display <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_counts</span></span></code></pre></div>
<p><strong>Question 3: How many unique ‘TADA.ActivityMediaName’ values
exist in your dataframe? Are there any media types that are not
water?</strong></p>
<p>TADA is currently designed to accommodate water data from the WQP.
Let’s ensure that we remove all non-water data first.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove data with media type that is not water</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="va">dataset_0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">TADA.ActivityMediaName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WATER"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Activity media is not water."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># what other media types exist in dataframe?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">removed</span><span class="op">$</span><span class="va">TADA.ActivityMediaName</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clean dataframe containing only water</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset_0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ActivityMediaName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WATER"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Activity Media"</span><span class="op">)</span></span></code></pre></div>
<p>Two additional helper functions one can use at any step in the
process are <code><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable()</a></code> and
<code><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie()</a></code>. These functions create a summary
table and pie chart (respectively) of all the unique values in a given
column. Let’s give it a try on OrganizationFormalName, which is a WQP
column naming the organization that supplied the result.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">org_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">org_counts</span></span></code></pre></div>
<p><strong>Question 4: When might a user choose to view a column’s
unique values as a table rather than in a pie chart?</strong></p>
<p>We can take a quick look at some of the TADA-created columns that
review result value types. Because TADA is intended to work with numeric
data, at this point, it would be good to remove those result values that
are NA without any detection limit info, or contain text or special
characters that cannot be converted to numeric. Note that TADA will fill
in missing values with detection limit values and units with the
<code>TADA_IDCensoredData</code> if the ResultDetectionConditionText and
DetectionQuantitationLimitType fields are populated. See
<code><a href="../reference/TADA_ConvertSpecialChars.html">?TADA_ConvertSpecialChars</a></code> for more details on result value
types and handling and <code><a href="../reference/TADA_IDCensoredData.html">?TADA_IDCensoredData</a></code> for details on
censored data preparation.</p>
<p>First, we can run <code>TADA_IDCensoredData</code> to fill in as many
NA/missing values as possible. We can use
<code>TADA_FieldValuesPie</code> to view the censored data flags
identified in the dataframe and their relative frequency.
<code>TADA_IDCensoredData</code> sorts result values into detection
limit categories (e.g. non-detect, over-detect) based on populated
values in the ResultDetectionConditionText and
DetectionQuantitationLimitTypeName columns.</p>
<p>You can find the reference tables used to make these decisions in
<code><a href="../reference/TADA_GetDetCondRef.html">TADA_GetDetCondRef()</a></code> and <code><a href="../reference/TADA_GetDetLimitRef.html">TADA_GetDetLimitRef()</a></code>
functions. In some cases, results are missing detection limit/condition
info, or there is a conflict in the detection limit and condition. The
user may want to remove problematic detection limit data before
proceeding. We can also filter for the “problem” data by
TADA.CensoredData.Flag and review the unique reasons for data
removal.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_IDCensoredData.html">TADA_IDCensoredData</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"TADA.CensoredData.Flag"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">problem_censored</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">TADA.CensoredData.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-Detect"</span>, <span class="st">"Over-Detect"</span>, <span class="st">"Other"</span>, <span class="st">"Uncensored"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Detection limit information contains errors or missing information."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's take a look at the problematic data that we filtered out (if any)</span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">problem_censored</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TADA.CharacteristicName"</span>, <span class="st">"ResultDetectionConditionText"</span>, <span class="st">"DetectionQuantitationLimitTypeName"</span>, <span class="st">"TADA.CensoredData.Flag"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">check</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.CensoredData.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Non-Detect"</span>, <span class="st">"Over-Detect"</span>, <span class="st">"Other"</span>, <span class="st">"Uncensored"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's take a look at the removed data</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">problem_censored</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dimension check</span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Censored Data"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can take a look at the data types present and filter out any
non-allowable types.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># take a look at datatypes</span></span>
<span><span class="va">flag.datatypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Numeric or numeric-coerced data types</span></span>
<span><span class="va">rv_datatypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Non-numeric data types coerced to NA</span></span>
<span><span class="va">na_rv_datatypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># these are all of the NOT allowable data types in the dataset.</span></span>
<span><span class="va">incompatible_datatype</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="st">"Less Than"</span>, <span class="st">"Greater Than"</span>, <span class="st">"Approximate Value"</span>, <span class="st">"Percentage"</span>, <span class="st">"Comma-Separated Numeric"</span>, <span class="st">"Numeric Range - Averaged"</span>, <span class="st">"Result Value/Unit Copied from Detection Limit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Result value type cannot be converted to numeric or no detection limit values provided."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take a look at the difficult data types - do they make sense?</span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">incompatible_datatype</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TADA.CharacteristicName"</span>, <span class="st">"ResultMeasureValue"</span>, <span class="st">"TADA.ResultMeasureValue"</span>, <span class="st">"ResultMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.ResultMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span>, <span class="st">"DetectionQuantitationLimitMeasure.MeasureValue"</span>, <span class="st">"TADA.DetectionQuantitationLimitMeasure.MeasureValue"</span>, <span class="st">"DetectionQuantitationLimitMeasure.MeasureUnitCode"</span>, <span class="st">"TADA.DetectionQuantitationLimitMeasure.MeasureUnitCode"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">check</span></span></code></pre></div>
<p>Then we can take a closer look at the removed results and run another
dimension check on the data set.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter data set to include allowable data types</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">TADA.ResultMeasureValueDataTypes.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Numeric"</span>, <span class="st">"Less Than"</span>, <span class="st">"Greater Than"</span>, <span class="st">"Approximate Value"</span>, <span class="st">"Percentage"</span>, <span class="st">"Comma-Separated Numeric"</span>, <span class="st">"Numeric Range - Averaged"</span>, <span class="st">"Result Value/Unit Copied from Detection Limit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe to includ all removed results</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">incompatible_datatype</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dimension check</span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Result Format"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-flagging">Data flagging<a class="anchor" aria-label="anchor" href="#data-flagging"></a>
</h2>
<p>We’ve taken a quick look at the raw dataframe and split off some data
that are not compatible with TADA, now let’s run through some quality
control checks. The most important ones to run to ensure your dataframe
is ready for subsequent steps are <code><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction()</a></code>,
<code><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation()</a></code>, <code><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit()</a></code>,
and <code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code>. With the exception of
<code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code>, these flagging functions leverage
WQX’s <a href="https://cdx.epa.gov/wqx/download/DomainValues/QAQCCharacteristicValidation.CSV" class="external-link">QAQC
Validation Table</a>. See the <a href="https://usepa.github.io/EPATADA/articles/WQXValidationService.html">WQX
QAQC Service User Guide</a> for more details on how TADA leverages the
validation table to flag potentially suspect data.
<code><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities()</a></code> uses a TADA-specific domain table
users can review with <code><a href="../reference/TADA_GetActivityTypeRef.html">TADA_GetActivityTypeRef()</a></code>. All QAQC
tables are frequently updated in the package to ensure they match the
latest version on the web.</p>
<p>Bring the QAQC Validation Table into your R session to view or save
with the following command:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qaqc_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetWQXCharValRef.html">TADA_GetWQXCharValRef</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">qaqc_ref</span><span class="op">$</span><span class="va">Type</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 5: What do you think the <code>qaqc_ref$Type</code>
column indicates?</strong></p>
<p>TADA joins this validation table to the data and uses the “Pass” and
“Suspect” labels in the TADA.WQXVal.Flag column to create easily
understandable flagging columns for each function. Let’s run these four
flagging functions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction</a></span><span class="op">(</span><span class="va">dataset</span>, clean <span class="op">=</span> <span class="cn">FALSE</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="st">"none"</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="st">"none"</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span><span class="va">dataset_flags</span>, clean <span class="op">=</span> <span class="cn">FALSE</span>, flaggedonly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset_flags</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Run Flag Functions"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 6: Did any warnings or messages appear in the
console after running these flagging functions? What do they
say?</strong></p>
<p>Now that we’ve run all the key flagging functions, let’s take a look
at the results and make some decisions.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.SampleFraction.Flag"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.MethodSpeciation.Flag"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ResultUnit.Flag"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ActivityType.Flag"</span><span class="op">)</span></span></code></pre></div>
<p>Any results flagged as “Suspect” are recognized in the QAQC
Validation Table as having some data quality issue. “NonStandardized”
means that the format has not been fully vetted or processed, while
“Pass” confirms that the characteristic combination is widely recognized
as correctly formatted. Let’s add any suspect results to the removed
dataframe for later review.</p>
<p><strong>Note: if you find any errors in the QAQC Validation Table,
please contact the WQX Help Desk at WQX@epa.gov to help correct it.
Thanks in advance!</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># grab all the flagged results from the four functions</span></span>
<span><span class="va">problem_flagged</span> <span class="op">&lt;-</span> <span class="va">dataset_flags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.SampleFraction.Flag</span> <span class="op">==</span> <span class="st">"Suspect"</span> <span class="op">|</span> <span class="va">TADA.MethodSpeciation.Flag</span> <span class="op">==</span> <span class="st">"Suspect"</span> <span class="op">|</span> <span class="va">TADA.ResultUnit.Flag</span> <span class="op">==</span> <span class="st">"Suspect"</span> <span class="op">|</span> <span class="op">!</span><span class="va">TADA.ActivityType.Flag</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="st">"Non_QC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TADA.RemovalReason <span class="op">=</span> <span class="st">"Invalid Unit, Method, Speciation, or Activity Type."</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset_flags</span> <span class="op">&lt;-</span> <span class="va">dataset_flags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">ResultIdentifier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">problem_flagged</span><span class="op">$</span><span class="va">ResultIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe of removed results</span></span>
<span><span class="va">removed</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span><span class="op">(</span><span class="va">removed</span>, <span class="va">problem_flagged</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove df no longer needed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">problem_flagged</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># dimension check</span></span>
<span><span class="fu">dimCheck</span><span class="op">(</span><span class="va">all_result_num</span>, <span class="va">dataset_flags</span>, <span class="va">removed</span>, checkName <span class="op">=</span> <span class="st">"Filter Flag Functions"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 7: Are there any other metadata columns that you
review and filter in your workflow?</strong></p>
<p>We’ve finished running the recommended flagging functions and
removing results that do not pass QC checks. Let’s look at the breakdown
of these data in the removed object.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">removal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">removed</span>, field <span class="op">=</span> <span class="st">"TADA.RemovalReason"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">removal</span></span></code></pre></div>
<p>You can review any other columns of interest and create custom domain
tables of your “Valid” and “Invalid” criteria using R or Excel. Also
check out some of the other flagging functions available in TADA:</p>
<ul>
<li><p><code>?TADA_FindNearbySites()</code></p></li>
<li><p><code>?TADA_FindPotentialDuplicatesMultipleOrgs()</code></p></li>
<li><p><code>?TADA_FindPotentialDuplicatesSingleOrg()</code></p></li>
<li><p><code>?TADA_FindQAPPApproval()</code></p></li>
<li><p><code>?TADA_FindQAPPDoc()</code></p></li>
<li><p><code>?TADA_FlagAboveThreshold()</code></p></li>
<li><p><code>?TADA_FlagBelowThreshold()</code></p></li>
<li><p><code>?TADA_FlagContinuousData()</code></p></li>
<li><p><code>?TADA_FlagCoordinates()</code></p></li>
<li><p><code>?TADA_FlagMeasureQualifierCode()</code></p></li>
<li><p><code>?TADA_FlagMethod()</code></p></li>
</ul>
<p>Please let us know of other flagging functions you think would have
broad appeal in the TADA package or need assistance
brainstorming/developing.</p>
</div>
<div class="section level2">
<h2 id="censored-data-handling">Censored data handling<a class="anchor" aria-label="anchor" href="#censored-data-handling"></a>
</h2>
<p>We have already identified, flagged, and in some cases removed
problematic detection limit data from our dataframe, but that doesn’t
keep them from being difficult. Because we do not know the result value
with adequate precision, water quality data users often set non-detect
values to some number below the reported detection limit. TADA contains
some simple methods for handling detection limits: users may multiply
the detection limit by some number between 0 and 1, or convert the
detection limit value to a random number between 0 and the detection
limit. More complex detection limit estimation requiring regression
models (Maximum Likelihood, Kaplan-Meier, Robust Regression on Order
Statistics) or similar must be performed outside of the current version
of TADA (though future development is planned).</p>
<p><strong>Question 8: How would you parameterize
<code><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods()</a></code> to make non-detect values
equal to the provided detection limit? What would you need to change in
the example below?</strong></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_cens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods</a></span><span class="op">(</span><span class="va">dataset_flags</span>,</span>
<span>  nd_method <span class="op">=</span> <span class="st">"multiplier"</span>,</span>
<span>  nd_multiplier <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  od_method <span class="op">=</span> <span class="st">"as-is"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at how the censored data handling function affects
the <code>TADA.ResultMeasureValueDataTypes.Flag</code> column.</p>
<p>First, we can look use <code>TADA_FieldValuesTable</code> to look at
the TADA.ResultMeasureValueDataTypes.Flag column in data set before we
ran <code>TADA_SimpleCensoredMethods</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_flags</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span></code></pre></div>
<p>Then we can use <code>TADA_FieldValuesTable</code> again to look at
the same column after <code>TADA_SimpleCensoredMethods</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># after</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.ResultMeasureValueDataTypes.Flag"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 9: Is there a difference between the first and
second tables?</strong></p>
<p>If you’d like to start thinking about using statistical methods to
estimate detection limit values, check out the <code><a href="../reference/TADA_Stats.html">?TADA_Stats</a></code>
function, which accepts user-defined data groupings (or defaults to
TADA.ComparableDataIdentifier to determine measurement count, location
count, censored data stats, min, max, and percentile stats, and suggests
non-detect estimation methods based on the number of results, % of data
frame censored, and number of censoring levels (detection limits). The
decision tree used in the function was outlined in a <a href="https://www.epa.gov/sites/default/files/2016-05/documents/tech_notes_10_jun2014_r.pdf" class="external-link">National
Nonpoint Source Tech Memo</a>.</p>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>How are you feeling about your test dataframe? Does it seem ready for
the next step(s) in your analyses? There’s probably a lot more you’d
like to look at/filter out before you’re ready to say: QC complete.
Let’s first check out characteristics in the dataframe using
<code>dplyr</code> functions and pipes.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get table of characteristics with number of results, sites, and organizations</span></span>
<span><span class="va">dataset_cens_summary</span> <span class="op">&lt;-</span> <span class="va">dataset_cens</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Result_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ResultIdentifier</span><span class="op">)</span>, Site_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TADA.MonitoringLocationIdentifier</span><span class="op">)</span><span class="op">)</span>, Org_Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">OrganizationIdentifier</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">Result_Count</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You may see a characteristic that you’d like to investigate further
in isolation. <code><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie()</a></code> will also produce
summary pie charts for a given column <em>within</em> a specific
characteristic. Let’s take a look.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># go ahead and pick a characteristic name from the table generated above. I picked dissolved oxygen (DO) amd selected OrganizationFormalName as the field to see the relative contribution of each org to DO results</span></span>
<span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span>, characteristicName <span class="op">=</span> <span class="st">"DISSOLVED OXYGEN (DO)"</span><span class="op">)</span></span></code></pre></div>
<p>We can view the site locations using a TADA mapping function. In this
map, the circles indicate monitoring locations in the data set; their
size corresponds to the number of results collected at that site, while
the darker the circle, the more characteristics were sampled at that
site.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_OverviewMap.html">TADA_OverviewMap</a></span><span class="op">(</span><span class="va">dataset_cens</span><span class="op">)</span></span></code></pre></div>
<p>Out of curiosity, let’s take a look at a breakdown of these
monitoring location types. Do they all indicate surface water samples?
Depending upon your program’s goals and methods, you might want to
filter out some of the types you see.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.MonitoringLocationTypeName"</span><span class="op">)</span></span></code></pre></div>
<p>One of the next big steps is data harmonization: translating and
aggregating synonyms, combining multiple forms/species of certain
characteristics, etc. We won’t get to that in this demo (more details
can be found here: <a href="https://usepa.github.io/EPATADA/articles/TADAModule1.html">TADA
Module 1: Water Quality Portal Data Discovery and Cleaning</a> or <a href="https://usepa.github.io/EPATADA/reference/TADA_HarmonizeSynonyms.html">TADA_HarmonizeSynonyms()</a>),
but for now we can start looking at data distributions within a single
characteristic-speciation-fraction-unit using the plotting functions
<code><a href="../reference/TADA_Histogram.html">TADA_Histogram()</a></code> and <code><a href="../reference/TADA_Boxplot.html">TADA_Boxplot()</a></code>. We can
also view a stats table using <code>TADA_Stats</code>.</p>
<p>Let’s first take a look at the column TADA.ComparableDataIdentifier,
which breaks down characteristics into groups by name, fraction,
speciation, and unit. These four columns are important to evaluate
together to ensure the plotted data are sufficiently similar to appear
on a single plot together: it doesn’t make sense to plot characteristics
with different units or fractions in the same distribution.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trusty field values table - lets just look at the first few entries with the most associated records</span></span>
<span><span class="va">compid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesTable.html">TADA_FieldValuesTable</a></span><span class="op">(</span><span class="va">dataset_cens</span>, field <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have an idea for what the TADA.ComparableDataIdentifier
looks like, we can check out how it is used to plot distinct
characteristic groups.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at a histogram, boxplot, and stats for TADA.ComparableDataIdentifier(s) of your choice.</span></span>
<span><span class="va">comp_data_id</span> <span class="op">&lt;-</span> <span class="st">"PH_NA_NA_NONE"</span></span>
<span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dataset_cens</span>, <span class="va">dataset_cens</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">comp_data_id</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 10: How does selecting the different options on the
left side of the histogram change the data displayed? When might you
want to use a histogram vs. a boxplot?</strong></p>
<p>Let’s take a look at the histogram and boxplot for the comparable
data identifier we selected.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_Histogram.html">TADA_Histogram</a></span><span class="op">(</span><span class="va">plot_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/TADA_Boxplot.html">TADA_Boxplot</a></span><span class="op">(</span><span class="va">plot_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Stats.html">TADA_Stats</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span></code></pre></div>
<p>We can also explore depth profiles for selected characteristics at
specific site on a single date. There are a few functions that can help
with this. First we can use <code>TADA_FlagDepthCategory</code> to place
results into various depth categories (surface, middle, and bottom).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FlagDepthCategory.html">TADA_FlagDepthCategory</a></span><span class="op">(</span><span class="va">dataset_cens</span><span class="op">)</span></span></code></pre></div>
<p>We can also use another function, <code>TADA_IDDepthProfiles</code>
to identify location/date/characteristic combinations in the data set
that can be used for depth profile plots or analysis. The default number
of values required to identify a location/date/characteristic as a depth
profile is 2, but this can be changed by the user. We will specify a
larger value, 5, so that any depth profiles identified will have results
from at least 5 different depths.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depth_profile_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_IDDepthProfiles.html">TADA_IDDepthProfiles</a></span><span class="op">(</span><span class="va">dataset_depth</span>, nvalue <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><strong>Question 11: How can TADA_IDDepthProfiles() help users use
TADA_DepthProfilePlot most efficiently?</strong></p>
<p>Now, we can use <code>TADA_DepthProfilePlot</code> to plot up to
three characteristics against depth. In this example, we will look at
pH, secchi depth, and pH.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TADA_DepthProfilePlot.html">TADA_DepthProfilePlot</a></span><span class="op">(</span><span class="va">dataset_cens</span>,</span>
<span>  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TEMPERATURE, WATER_NA_NA_DEG C"</span>,</span>
<span>    <span class="st">"DEPTH, SECCHI DISK DEPTH_NA_NA_M"</span>,</span>
<span>    <span class="st">"PH_NA_NA_NONE"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"REDLAKE_WQX-ANKE"</span>,</span>
<span>  activity_date <span class="op">=</span> <span class="st">"2018-10-04"</span>,</span>
<span>  depthcat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  surfacevalue <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  bottomvalue <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"m"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can download our PASS and FAIL data sets together into an
Excel spreadsheet.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_and_removed</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dataset_cens</span>, <span class="va">removed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Un-comment to download Excel spreadsheet to your working directory</span></span>
<span><span class="co"># install.packages(writexl)</span></span>
<span><span class="co"># library(writexl)</span></span>
<span><span class="co"># writexl::write_xlsx(dataset_and_removed, "NCTCShepherdstownData.xlsx")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tada-r-shiny-modules">TADA R Shiny Modules<a class="anchor" aria-label="anchor" href="#tada-r-shiny-modules"></a>
</h2>
<p>Finally, take a look at an alternative workflow for QC’ing WQP data:
TADA Shiny Module 1: Data Discovery and Cleaning. This is a Shiny
application that runs many of the TADA functions covered in this
training document behind a graphical user interface. The shiny
application queries the WQP, contains maps and data visualizations,
flags suspect data results, handles censored data, and more. You can
launch it using the code below.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download TADA Shiny repository</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/TADAShiny"</span>, ref <span class="op">=</span> <span class="st">"develop"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># launch the app locally.</span></span>
<span><span class="fu">TADAShiny</span><span class="fu">::</span><span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>DRAFT <a href="https://rconnect-public.epa.gov/TADAShiny/" class="external-link">Module
1</a> is also currently hosted on the web with minimal server
memory/storage allocated.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cristina Mullin, Hillary Marler, Jacob Greif, Elise Hinman, Kenny Wong, Kathryn Willi, Matt Brousil, Kathleen Healy, Justin Bousquin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
