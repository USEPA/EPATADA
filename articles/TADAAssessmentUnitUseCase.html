<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TADA: Assessment Unit Use Case Demo • EPATADA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TADA: Assessment Unit Use Case Demo">
<meta name="description" content="An overview of a TADA use case for a single Assessment Unit.">
<meta property="og:description" content="An overview of a TADA use case for a single Assessment Unit.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EPATADA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CONTRIBUTING.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/TADAAssessmentUnitUseCase.html">TADA: Assessment Unit Use Case Demo</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_AdvancedTraining.html">TADA Module 1: Training for Intermediate/Advanced R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1_BeginnerTraining.html">TADA Module 1: Training for Beginner R Users</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule1.html">TADA Module 1: Water Quality Portal Data Discovery and Cleaning</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule2.html">TADA Module 2: Geospatial Functions</a></li>
    <li><a class="dropdown-item" href="../articles/TADAModule3_PartA.html">TADA Module 3A: Associating WQP Characteristic Names with Applicable ATTAINS State, Tribal or EPA 304(a) Parameter and Use Names</a></li>
    <li><a class="dropdown-item" href="../articles/TADAWaterSciConWorkshopDemo.html">TADA: WaterSciCon Workshop Demo</a></li>
    <li><a class="dropdown-item" href="../articles/WQXValidationService.html">WQX QAQC Service User Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/EPATADA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TADA: Assessment Unit Use Case Demo</h1>
                        <h4 data-toc-skip class="author">TADA Team</h4>
            
            <h4 data-toc-skip class="date">2025-03-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EPATADA/blob/develop/vignettes/TADAAssessmentUnitUseCase.Rmd" class="external-link"><code>vignettes/TADAAssessmentUnitUseCase.Rmd</code></a></small>
      <div class="d-none name"><code>TADAAssessmentUnitUseCase.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>We will walk through the specific use case of query, downloading,
preparing, QA/QCing data from a single Assessment Unit with multiple
Monitoring Locations sampled by several organizations. Three
characteristics, pH, water temperature, and total nitrogen are used in
this example. Two of the characteristics, pH and water temperature, will
be compared to a state water quality standard from Illinois. The third
characteristic, total nitrogen, does not have an Illinois water quality
standard, but is used to demonstrate some helpful functions for data
exploration and visualization.</p>
<p>This vignette is designed to be concise and provide an example of how
you might use TADA functions for basic data discovery and analysis with
regards to a single Assessment Unit and a small subset of
characteristics. It leverages functions from TADA Modules 1 and 2. For
more details on each function, see the <a href="https://usepa.github.io/EPATADA/reference/index.html">TADA
Function Reference</a> or the more comprehensive module vignettes:</p>
<ul>
<li><p><a href="https://usepa.github.io/EPATADA/articles/TADAModule1_BeginnerTraining.html">TADA
Module 1 Beginner Training</a></p></li>
<li><p><a href="https://usepa.github.io/EPATADA/articles/TADAModule1_AdvancedTraining.html">TADA
Module 1 Advanced Training</a></p></li>
<li><p><a href="https://usepa.github.io/EPATADA/articles/TADAModule1.html">TADA
Module 1 Water Quality Portal Data Discovery and Cleaning</a></p></li>
<li><p><a href="https://usepa.github.io/EPATADA/articles/TADAModule2.html">TADA
Module 2</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="install-and-load-packages">Install and load packages<a class="anchor" aria-label="anchor" href="#install-and-load-packages"></a>
</h2>
<p>First, install and load the remotes package specifying the repo. This
is needed before installing TADA because it is only available on GitHub
(not CRAN).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span>,</span>
<span>  repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, install and load EPATADA using the remotes package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"USEPA/EPATADA"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"develop"</span>,</span>
<span>  dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-required-packages">Load Required Packages<a class="anchor" aria-label="anchor" href="#load-required-packages"></a>
</h2>
<p>The fist step is to load the TADA package and other packages used in
our workflow. (If you are a first-time TADA user, see <a href="https://usepa.github.io/EPATADA/articles/TADAModule1_BeginnerTraining.html">TADA
Module 1 Beginner Training</a> for TADA package installation
instructions.)</p>
<p>We’ll also record the start time for our analysis, beginning after
loading packages.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list.of.packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"dplyr"</span>, <span class="st">"yaml"</span>, <span class="st">"lwgeom"</span>, <span class="st">"sf"</span>, <span class="st">"lubridate"</span>,</span>
<span>  <span class="st">"knitr"</span>, <span class="st">"DT"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">new.packages</span> <span class="op">&lt;-</span> <span class="va">list.of.packages</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">list.of.packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="st">"Package"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">new.packages</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vubiostat/r-yaml/" class="external-link">yaml</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/lwgeom/" class="external-link">lwgeom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT" class="external-link">DT</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Record start time</span></span>
<span><span class="va">start.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-retrieval---water-chemistry">Data Retrieval - Water Chemistry<a class="anchor" aria-label="anchor" href="#data-retrieval---water-chemistry"></a>
</h2>
<p>The water chemistry data we will use are downloaded from the Water
Quality Portal (<a href="https://www.waterqualitydata.us/" class="external-link uri">https://www.waterqualitydata.us/</a>). The WQP integrates
publicly available water quality data from the USGS National Water
Information System (<strong>NWIS</strong>) and the EPA Water Quality
Exchange (<strong>WQX</strong>) Data Warehouse. The EPA water quality
data originate from the <a href="https://www.epa.gov/waterdata/water-quality-data" class="external-link">Water Quality
Exchange</a>, the EPA’s repository of water quality monitoring data
collected by water resource management groups across the country.
Organizations, including states, tribes, watershed groups, other federal
agencies, volunteer groups, and universities, submit data to the
WQX.</p>
<p>We are interested in Assessment Unit “IL_I-84”. This is a Mississippi
River Assessment Unit. Because we don’t have a comprehensive list of the
Monitoring Locations in this Assessment Unit, we will need to create a
broad query to retrieve all results that might be associated the
IL_I-84. One way to do this is to include all HUC10s that are relevant
to the Assessment Unit.</p>
<p>We can use <code>TADA_DataRetrieval</code> to retrieve WQP data. In
this example, we have specified lists of HUCs and Characteristic Types
to reduce the size of the query since we have a general idea of the
location of our assessment unit of interest and know which
characteristics we’d like to explore. One quick way to find this
information is to view IL_I-84’s Waterbody Report on How’s My Waterway:
<a href="https://mywaterway.epa.gov/waterbody-report/IL_EPA/IL_I-84/2022" class="external-link">WaterbodyReport/IL_EPA/IL_I-84/2022</a>.</p>
<p>We’ll also need to set start and end dates. For this example we’ll
use a ten year range between 2010 and 2020. We will also set the
Characteristic Type to “Nutrient” and “Physical”, because these types
contain nitrogen, pH and water temperature Characteristics. It is
possible to query by a specific Characteristic Name, but different
organizations may input the same name in a variety of ways. Therefore,
we recommend keeping your initial queries as broad as possible so all
relevant results are downloaded and useful data from synonymous
Characteristics are not missed. There are TADA functions that can be
used to harmonize these synonyms.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import data from WQP</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_DataRetrieval.html">TADA_DataRetrieval</a></span><span class="op">(</span></span>
<span>  statecode <span class="op">=</span> <span class="st">"IL"</span>,</span>
<span>  startDate <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span>
<span>  endDate <span class="op">=</span> <span class="st">"2020-12-31"</span>,</span>
<span>  huc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0714010505"</span>, <span class="st">"0714010504"</span>, <span class="st">"0714010508"</span>, <span class="st">"0714010501"</span>, <span class="st">"0714010503"</span><span class="op">)</span>,</span>
<span>  applyautoclean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="autoclean">AutoClean<a class="anchor" aria-label="anchor" href="#autoclean"></a>
</h2>
<p>As part of <code>TADA_DataRetrieval</code>,
<code>TADA_AutoClean</code> is performed automatically unless specified
otherwise by the user (by setting applyautoclean = FALSE). When
<code>TADA_AutoClean</code> is run, the following functions are
performed on the data retrieved from the WQP:</p>
<ul>
<li><p><code>TADA_ConvertSpecialChars</code> - converts result value
columns to numeric and flags non-numeric values that could not be
converted.</p></li>
<li><p><code>TADA_ConvertResultUnits</code> - unifies result units for
easier quality control and review</p></li>
<li><p><code>TADA_ConvertDepthUnits</code> - converts depth units to a
consistent unit (meters).</p></li>
<li><p><code>TADA_IDCensoredData</code> - categorizes detection limit
data and identifies mismatches in result detection condition and result
detection limit type.</p></li>
<li><p>Other helpful actions - converts important text columns to all
upper-case letters, and uses WQX format rules to harmonize specific NWIS
metadata conventions (e.g. move characteristic speciation from the
TADA.ResultMeasure.MeasureUnitCode column to the
TADA.MethodSpeciationName column)</p></li>
</ul>
<p>As a general rule, TADA functions do not change any contents in the
WQP-served columns. Instead, they add new columns with the prefix
“TADA.” This allows users to easily review any changes TADA functions
have made.</p>
</div>
<div class="section level2">
<h2 id="data-retrieval---geospatial">Data Retrieval - Geospatial<a class="anchor" aria-label="anchor" href="#data-retrieval---geospatial"></a>
</h2>
<p>All geospatial data used in this example are downloaded from the
Assessment Total Maximum Daily Load (TMDL) Tracking and Implementation
System (<strong>ATTAINS</strong>) (<a href="https://www.epa.gov/waterdata/attains" class="external-link uri">https://www.epa.gov/waterdata/attains</a>).
<strong>ATTAINS</strong> is an online system for accessing information
about conditions in the Nation’s surface waters.</p>
<p>This information reported to EPA by states is available in
<strong>ATTAINS</strong>. The public information is made available via
<strong>ATTAINS</strong> web services. New TADA functions leverage the
<strong>ATTAINS</strong> geospatial services to make geospatial
information including catchment and assessment unit geometry easily
accessible to R users.</p>
<p>We can use the function, <code>TADA_GetATTAINS</code> to obtain
geospatial data from <strong>ATTAINS</strong> relevant to the Monitoring
Locations included in the <strong>WQP</strong> data set. See <a href="https://usepa.github.io/EPATADA/articles/TADAModule2.html">TADA
Module 2</a> for a much more detailed look at the logic behind this and
the other TADA geospatial functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import data from ATTAINS geospatial services</span></span>
<span><span class="va">ATTAINS_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetATTAINS.html">TADA_GetATTAINS</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="view-geospatial-features">View Geospatial Features<a class="anchor" aria-label="anchor" href="#view-geospatial-features"></a>
</h2>
<p>The <code>TADA_ViewATTAINS</code> function allows us to see where the
monitoring locations from the <strong>WQP</strong> data set are relative
to <strong>ATTAINS-</strong>indexed catchments and assessment units.
This can be helpful when deciding which Monitoring Locations should be
retained for additional analysis. For this demo, we are focusing on a
single Assessment Unit, IL-84, with multiple monitoring locations
(<em>MonitoringLocationIdentifier</em>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View catchments and assessment units on map</span></span>
<span></span>
<span><span class="va">ATTAINS_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_ViewATTAINS.html">TADA_ViewATTAINS</a></span><span class="op">(</span><span class="va">ATTAINS_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ATTAINS_map</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="monitoring-location-filter-and-review">Monitoring Location Filter and Review<a class="anchor" aria-label="anchor" href="#monitoring-location-filter-and-review"></a>
</h2>
<p>Now that we’ve associated geospatial data from
<strong>ATTAINS</strong> with the <strong>WQP</strong> data, we can
filter the data set to retain only results that were collected in the
specified Assessment Unit. We can also generate a new table to give us
some information about the individual monitoring locations within the
assessment unit. After this filter step is complete, we can remove the
“ATTAINS.” prefixed columns to reduce the size of the data set, as we
won’t need them for the remaining steps in this example.</p>
<p>We can also create a table with some basic information about the
Monitoring Locations in Assessment Unit IL-84 and a pie chart to display
the relative number of results contributed by each organization.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter data for specified assessment unit</span></span>
<span></span>
<span><span class="va">AUID_data</span> <span class="op">&lt;-</span> <span class="va">ATTAINS_data</span><span class="op">$</span><span class="va">TADA_with_ATTAINS</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ATTAINS.assessmentunitidentifier</span> <span class="op">==</span> <span class="st">"IL_I-84"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="va">ATTAINS_data</span><span class="op">$</span><span class="va">TADA_with_ATTAINS</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ATTAINS.assessmentunitidentifier</span> <span class="op">==</span> <span class="st">"IL_I-84"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"ATTAINS."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_RetainRequired.html">TADA_RetainRequired</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create table of monitoring location identifiers</span></span>
<span></span>
<span><span class="va">MonitoringLocations</span> <span class="op">&lt;-</span> <span class="va">Analysis_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">MonitoringLocationName</span>, <span class="va">MonitoringLocationIdentifier</span>, <span class="va">OrganizationFormalName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">MonitoringLocations</span>, fillContainer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create pie of results by organization</span></span>
<span><span class="va">Orgs_pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">Analysis_data</span>, field <span class="op">=</span> <span class="st">"OrganizationFormalName"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Orgs_pie</span></span></code></pre></div>
<p>This allows us to easily review how many monitoring locations,
organizations, and results are in the dataframe for the selected time
period.</p>
</div>
<div class="section level2">
<h2 id="water-chemistry-data-preparation-and-qc">Water Chemistry Data Preparation and QC<a class="anchor" aria-label="anchor" href="#water-chemistry-data-preparation-and-qc"></a>
</h2>
<p>Before we can begin comparisons between the water chemistry results
and a water quality standard, there are some additional data preparation
and QC steps that can be performed using TADA functions.</p>
<p>First, we can check the data for additional conditions which might
cause us to exclude certain results from further analysis. For example,
we can use <code>TADA_FlagMethod</code> to check for invalid analytical
method-characteristic combinations; <code>TADA_FlagSpeciation</code> to
check for invalid characteristics-method speciation combinations,
<code>TADA_FlagResultUnit</code> to check the the validity of each
characteristic-media-result unit combination, and
<code>TADA_FlagFraction</code> to check the validity of
characteristic-fraction combinations. In this simple example, we will
remove all invalid combinations identified by each of these functions.
When setting up your own workflow, you will want to review each function
and its output more carefully before moving on.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flag and remove results</span></span>
<span></span>
<span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="va">Analysis_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagMethod.html">TADA_FlagMethod</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagSpeciation.html">TADA_FlagSpeciation</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagResultUnit.html">TADA_FlagResultUnit</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagFraction.html">TADA_FlagFraction</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Another set of TADA flagging functions,
<code>TADA_FlagAboveThreshold</code> and
<code>TADA_FlagBelowThreshold</code>, can be used to check results
against national lower and upper thresholds. As in the previous
examples, we will set these functions to remove any results that fall
outside the national thresholds.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flag and remove results</span></span>
<span></span>
<span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="va">Analysis_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagAboveThreshold.html">TADA_FlagAboveThreshold</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagBelowThreshold.html">TADA_FlagBelowThreshold</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can also review the data set to see if it contains potential
duplicate results from within a single organization or potential
duplicates from within multiple organizations (such as when two or more
organizations monitor the same location and may submit duplicate
results).</p>
<p>We will select to keep only unique samples from
<code>TADA_FindPotentialDuplicatesSingleOrg</code> by filtering for
TADA.SingleOrgDup.Flag equals “Unique”. Then we will search for
potential duplicates from multiple orgs with
<code>TADA_FindPotentialDuplicatesMultipleOrgs</code> and filter only to
retain only one value per potential duplicate by filtering for
TADA.ResultSelectedMultipleOrgs equals “Y”.</p>
<p>If you would like to prioritize results from one organization over
another, this can be done using the org_hierarchy argument in
<code>TADA_FindPotentialDuplicatesMultipleOrgs</code>. Information on
how to this can be found in the function reference for <a href="https://usepa.github.io/EPATADA/reference/TADA_FindPotentialDuplicatesMultipleOrgs.html">TADA_FindPotentialDuplicatesMultipleOrgs</a>.
In this example, we will use the default setting “none” where a single
representative is selected randomly from each duplicate group.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flag and remove results</span></span>
<span></span>
<span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="va">Analysis_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FindPotentialDuplicatesSingleOrg.html">TADA_FindPotentialDuplicatesSingleOrg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.SingleOrgDup.Flag</span> <span class="op">==</span> <span class="st">"Unique"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FindPotentialDuplicatesMultipleOrgs.html">TADA_FindPotentialDuplicatesMultipleOrgs</a></span><span class="op">(</span></span>
<span>    dist_buffer <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    org_hierarchy <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ResultSelectedMultipleOrgs</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
<p>Next we can remove QC and qualified samples (with qualifiers
identified as suspect) using <code>TADA_FindQCActivities</code> and
<code>TADA_FlagMeasureQualifierCode</code>, respectively. See the TADA
Module 1 vignettes for more information on how these functions identify
and flag results for removal as you may wish to make different decisions
than the TADA defaults regarding which results to retain.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flag and remove results</span></span>
<span></span>
<span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="va">Analysis_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FindQCActivities.html">TADA_FindQCActivities</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/TADA_FlagMeasureQualifierCode.html">TADA_FlagMeasureQualifierCode</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="censored-data">Censored Data<a class="anchor" aria-label="anchor" href="#censored-data"></a>
</h2>
<p>Censored data are measurements for which the true value is not known,
but we can estimate the value based on lower or upper detection
conditions and limit types. TADA fills missing
<em>TADA.ResultMeasureValue</em> and
<em>TADA.ResultMeasure.MeasureUnitCode</em> values with values and units
from <em>TADA.DetectionQuantitationLimitMeasure.MeasureValue</em> and
<em>TADA.DetectionQuantitationLimitMeasure.MeasureUnitCode</em>,
respectively, using the <code>TADA_AutoClean</code> function.</p>
<p>The TADA package currently has functions that summarize censored data
incidence in the dataset and perform simple substitutions of censored
data values, including x times the detection limit and random selection
of a value between 0 and the detection limit. The user may specify the
methods used for non-detects and over-detects separately in the input to
the <code>TADA_SimpleCensoredMethods</code> function. The next step we
take in this example is to perform simple conversions to the censored
data in the dataset: we keep over-detects as is (no conversion made) and
convert non-detect values to 0.5 times the detection limit (half the
detection limit).</p>
<p>See the TADA Module 1 vignettes for more detailed information on the
logic behind
<code>TADA_SimpleCensoredMethods</code><strong>.</strong></p>
<p>After running <code>TADA_SimpleCensoredMethods</code>, we will also
filter the data to remove any remaining NAs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_SimpleCensoredMethods.html">TADA_SimpleCensoredMethods</a></span><span class="op">(</span><span class="va">Analysis_data</span>,</span>
<span>  nd_method <span class="op">=</span> <span class="st">"multiplier"</span>,</span>
<span>  nd_multiplier <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  od_method <span class="op">=</span> <span class="st">"as-is"</span>,</span>
<span>  od_multiplier <span class="op">=</span> <span class="st">"null"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TADA.ResultMeasureValue</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="harmonize-results">Harmonize Results<a class="anchor" aria-label="anchor" href="#harmonize-results"></a>
</h2>
<p>The <code>TADA_GetSynonymRef</code> function generates a synonym
reference table that is specific to the input dataframe. Users can
review how their input data relates to standard TADA values for the
following elements: TADA.CharacteristicName,
TADA.ResultSampleFractionText, TADA.MethodSpeciationName, and
TADA.ResultMeasure.MeasureUnitCode and edit if desired.</p>
<p>Users can also edit the reference file to meet their needs if
desired. The download argument can be used to save the harmonization
file to your current working directory when
<code>download = TRUE</code>, the default is
<code>download = FALSE</code>. In this example, we will modify the
harmonization file to group results with the fraction “NA” and results
with the fraction “TOTAL” for pH and water temperature.</p>
<p>The <code>TADA_HarmonizeSynonyms</code> function then compares the
input dataframe to the TADA Synonym Reference Table and makes
conversions where target characteristics/fractions/speciations/units are
provided. This function also appends a column called
TADA.Harmonized.Flag, indicating which results had metadata
changed/converted in this function. The purpose of this function is to
make similar data consistent and therefore easier to compare and
analyze.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UniqueHarmonizationRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_GetSynonymRef.html">TADA_GetSynonymRef</a></span><span class="op">(</span><span class="va">Analysis_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">UniqueHarmonizationRef_edit</span> <span class="op">&lt;-</span> <span class="va">UniqueHarmonizationRef</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Target.TADA.CharacteristicName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span> <span class="op">==</span> <span class="st">"TEMPERATURE, WATER"</span>, <span class="st">"TEMPERATURE"</span>, <span class="va">TADA.CharacteristicName</span><span class="op">)</span>,</span>
<span>    Target.TADA.ResultSampleFractionText <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span> <span class="op">==</span> <span class="st">"PH"</span>, <span class="cn">NA</span>, <span class="va">Target.TADA.ResultSampleFractionText</span><span class="op">)</span>,</span>
<span>    HarmonizationGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TADA.CharacteristicName</span> <span class="op">==</span> <span class="st">"PH"</span>, <span class="st">"PH"</span>, <span class="va">HarmonizationGroup</span><span class="op">)</span>,</span>
<span>    HarmonizationGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Target.TADA.CharacteristicName</span> <span class="op">==</span> <span class="st">"TEMPERATURE"</span>, <span class="st">"TEMPERATURE"</span>,</span>
<span>      <span class="va">HarmonizationGroup</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">Harmonized_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_HarmonizeSynonyms.html">TADA_HarmonizeSynonyms</a></span><span class="op">(</span><span class="va">Analysis_data</span>,</span>
<span>  ref <span class="op">=</span> <span class="va">UniqueHarmonizationRef_edit</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="total-nitrogen-and-total-phosphorus-calculations">Total Nitrogen and Total Phosphorus Calculations<a class="anchor" aria-label="anchor" href="#total-nitrogen-and-total-phosphorus-calculations"></a>
</h2>
<p><code>TADA_CalculateTotalNP</code> uses the <a href="https://echo.epa.gov/trends/loading-tool/resources/nutrient-aggregation" class="external-link">Nutrient
Aggregation logic</a> to add together specific subspecies to obtain a
total. TADA adds one more equation to the mix: total particulate
nitrogen + total dissolved nitrogen. The function uses as many
subspecies as possible to calculate a total for each given site, date,
and depth group, but it will estimate total nitrogen with whatever
subspecies are present. This function creates NEW total nutrient
measurements (total nitrogen unfiltered as N and total phosphorus
unfiltered as P) and adds them to the dataframe.</p>
<p>Users can use the default summation worksheet (see
<code>TADA_GetNutrientSummationRef</code>) or customize it to suit their
needs. The function also requires a daily aggregation value, either
minimum, maximum, or mean. The default is ‘max’, which means that if
multiple measurements of the same subspecies-fraction-speciation-unit
occur on the same day at the same site and depth, the function will pick
the maximum value to use in summation calculations. In this example, we
will use the default summation worksheet to obtain total nitrogen.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harmonized_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_CalculateTotalNP.html">TADA_CalculateTotalNP</a></span><span class="op">(</span><span class="va">Harmonized_data</span>, daily_agg <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-level-filtering">Parameter Level Filtering<a class="anchor" aria-label="anchor" href="#parameter-level-filtering"></a>
</h2>
<p>Now we can filter to our three parameters of interest and use
<code>TADA_Stats</code> take a look at some basic statistics for each,
including location count, measurement count, min, max, and more.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># review unique identifiers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Harmonized_data</span><span class="op">$</span><span class="va">TADA.ComparableDataIdentifier</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter for three comparable data identifiers of interest</span></span>
<span><span class="va">Filtered_data</span> <span class="op">&lt;-</span> <span class="va">Harmonized_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TEMPERATURE_NA_NA_DEG C"</span>, <span class="st">"PH_NA_NA_STD UNITS"</span>, <span class="st">"TOTAL NITROGEN, MIXED FORMS_UNFILTERED_AS N_MG/L"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate stats table</span></span>
<span><span class="va">Filtered_data_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Stats.html">TADA_Stats</a></span><span class="op">(</span><span class="va">Filtered_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">Filtered_data_stats</span>, fillContainer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="standard-comparisons-with-scatterplot-and-pie-chart">Standard Comparisons With Scatterplot and Pie Chart<a class="anchor" aria-label="anchor" href="#standard-comparisons-with-scatterplot-and-pie-chart"></a>
</h2>
<p>Next, we will create a two characteristic scatterplot of pH and
temperature to begin visualizing the data, using
<code>TADA_TwoCharacteristicScatterplot</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># choose two and generate scatterplot</span></span>
<span><span class="fu"><a href="../reference/TADA_TwoCharacteristicScatterplot.html">TADA_TwoCharacteristicScatterplot</a></span><span class="op">(</span><span class="va">Harmonized_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TEMPERATURE_NA_NA_DEG C"</span>, <span class="st">"PH_NA_NA_STD UNITS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s focus on just one characteristic, pH. We can filter the
dataframe to retain only pH samples. We can also add a column to
indicate whether each result falls within the water quality standard
range for pH (6.5 - 9). From this pH-only frame we can create a table
with just a few columns for easier review, and a single characteristic
scatterplot using <code>TADA_Scatterplot</code>. In this example,
horizontal lines have been added to indicate the upper and lower ends of
the water quality standard. These are not a default option in
<code>TADA_Scatterplot</code> but can be added via the
<code>plotly</code> package.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># comparison to standard for ph</span></span>
<span><span class="va">pH_Standard</span> <span class="op">&lt;-</span> <span class="va">Filtered_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"PH_NA_NA_STD UNITS"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>MeetsStandard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TADA.ResultMeasureValue</span> <span class="op">&gt;=</span> <span class="fl">6.5</span> <span class="op">&amp;</span> <span class="va">TADA.ResultMeasureValue</span> <span class="op">&lt;=</span> <span class="fl">9</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># subset of pH data with fewer rows</span></span>
<span><span class="va">pH_Table</span> <span class="op">&lt;-</span> <span class="va">pH_Standard</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">MonitoringLocationIdentifier</span>, <span class="va">OrganizationFormalName</span>, <span class="va">ActivityStartDate</span>, <span class="va">TADA.ResultMeasureValue</span>,</span>
<span>    <span class="va">MeetsStandard</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">pH_Table</span>, fillContainer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pH scatterplot</span></span>
<span><span class="va">pH_Scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Scatterplot.html">TADA_Scatterplot</a></span><span class="op">(</span><span class="va">pH_Standard</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html" class="external-link">add_lines</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fl">6.5</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pH_Standard</span><span class="op">$</span><span class="va">ActivityStartDate</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pH_Standard</span><span class="op">$</span><span class="va">ActivityStartDate</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    inherit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    showlegend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    hoverinfo <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html" class="external-link">add_lines</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fl">9</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pH_Standard</span><span class="op">$</span><span class="va">ActivityStartDate</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pH_Standard</span><span class="op">$</span><span class="va">ActivityStartDate</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    inherit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    showlegend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    hoverinfo <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">pH_Scatter</span></span></code></pre></div>
<p>Comparison of temperature to water quality standards is a little more
complicated as the maximum temperature varies by season and there are
multiple components of the temperature standard. For this example, we
will focus on the “shall never exceed” seasonal temperature
standards.</p>
<p>These are:</p>
<p>17.7 deg C for January, February, March, and December</p>
<p>33.7 deg C for April, May, June, July, August, September, October,
and November.</p>
<p>We can use <code>lubridate</code> and <code>dplyr</code> functions to
assign the appropriate standard to each result by using
<code><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">lubridate::month</a></code> to identify the month in which each sample
was collected and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code> to create a new column for
the temperature standard. Then the results can be compared to the
standard.</p>
<p>We can use <code>TADA_Scatterplot</code> again to visualize the data.
Due to the seasonal variation in the standard and the ten-year date
range in our data set, we may want to consider other visualizations to
visually review the number of results not meeting the standard. We can
use <code>TADA_FieldValuesPie</code> on the MeetsStandard field we
created to see how many samples met or did not meet the standard.</p>
<p>Creating a table also allows for easy filtering of results to
identify the results that did not meet the standard and review during
which years and seasons they occurred.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># comparison to standard for temperature</span></span>
<span><span class="va">Temp_Standard</span> <span class="op">&lt;-</span> <span class="va">Filtered_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"TEMPERATURE_NA_NA_DEG C"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    MonthForAnalysis <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">ActivityStartDate</span><span class="op">)</span>,</span>
<span>    TempStandard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">MonthForAnalysis</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fl">17.7</span>, <span class="fl">33.7</span><span class="op">)</span>,</span>
<span>    MeetsStandard <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TADA.ResultMeasureValue</span> <span class="op">&lt;</span> <span class="va">TempStandard</span>,</span>
<span>      <span class="st">"Yes"</span>, <span class="st">"No"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># create scatterplot for temperature</span></span>
<span><span class="va">Temp_Scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Scatterplot.html">TADA_Scatterplot</a></span><span class="op">(</span><span class="va">Temp_Standard</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Temp_Scatter</span></span>
<span></span>
<span><span class="co"># create pie chart for temperature</span></span>
<span></span>
<span><span class="va">Temp_Pie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_FieldValuesPie.html">TADA_FieldValuesPie</a></span><span class="op">(</span><span class="va">Temp_Standard</span>, field <span class="op">=</span> <span class="st">"MeetsStandard"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Temp_Pie</span></span>
<span></span>
<span><span class="co"># create subset table for temperature</span></span>
<span><span class="va">Temp_Table</span> <span class="op">&lt;-</span> <span class="va">Temp_Standard</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">MonitoringLocationIdentifier</span>, <span class="va">OrganizationFormalName</span>, <span class="va">ActivityStartDate</span>, <span class="va">TADA.ResultMeasureValue</span>, <span class="va">TempStandard</span>,</span>
<span>    <span class="va">MeetsStandard</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">Temp_Table</span>, fillContainer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-data-exploration">Additional Data Exploration<a class="anchor" aria-label="anchor" href="#additional-data-exploration"></a>
</h2>
<p>We may also want to use TADA functions for exploration and
visualization of characteristics without water quality standards. For
this example, we will use “TOTAL NITROGEN, MIXED FORMS_FILTERED,
LAB_NA_MG/L”.</p>
<p>To better understand the distribution of results, we can use the TADA
functions <code>TADA_Histogram</code> and <code>TADA_Boxplot</code>.</p>
<p><code>TADA_Histogram</code> can be useful for identifying the overall
shape of the data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter dataframe to comparable data identifier of interest</span></span>
<span></span>
<span><span class="va">Nitrogen_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Filtered_data</span>, <span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"TOTAL NITROGEN, MIXED FORMS_UNFILTERED_AS N_MG/L"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate a histogram</span></span>
<span><span class="va">Nitrogen_Histogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Histogram.html">TADA_Histogram</a></span><span class="op">(</span><span class="va">Nitrogen_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view histogram</span></span>
<span><span class="va">Nitrogen_Histogram</span></span></code></pre></div>
<p><code>TADA_Boxplot</code> can be useful for identifying skewness and
percentiles.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Nitrogen_Boxplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Boxplot.html">TADA_Boxplot</a></span><span class="op">(</span><span class="va">Nitrogen_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">Nitrogen_Boxplot</span></span></code></pre></div>
<p>Filtering the results of <code>TADA_Stats</code> for only “TOTAL
NITROGEN, MIXED FORMS_TOTAL RECOVERABLE_NA_MG/L” and selecting a smaller
subset of columns or creating a single characteristic scatterplot may
also provide useful information.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create table with nitrogen stats</span></span>
<span><span class="va">Nitrogen_stats</span> <span class="op">&lt;-</span> <span class="va">Filtered_data_stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TADA.ComparableDataIdentifier</span> <span class="op">==</span> <span class="st">"TOTAL NITROGEN, MIXED FORMS_UNFILTERED_AS N_MG/L"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Location_Count</span>, <span class="va">Measurement_Count</span>, <span class="va">Min</span>, <span class="va">Max</span>, <span class="va">Mean</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">Nitrogen_stats</span>, fillContainer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create nitrogen scatterplot</span></span>
<span><span class="va">Nitrogen_Scatterplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TADA_Scatterplot.html">TADA_Scatterplot</a></span><span class="op">(</span><span class="va">Nitrogen_data</span>, id_cols <span class="op">=</span> <span class="st">"TADA.ComparableDataIdentifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Nitrogen_Scatterplot</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reproducible-and-documented">Reproducible and Documented<a class="anchor" aria-label="anchor" href="#reproducible-and-documented"></a>
</h2>
<p>Major benefits to this type are workflow are that it is reproducible
and the decisions at each step are well documented. This means that it
is easy to go back and review every step, understand the decisions that
were made, make changes as necessary, and run it again. If someone asks
“How were data filtered prior to analysis?” or “How did you identify
additional Monitoring Locations within the Assessment Unit?”, you can
refer to the code and function documentation to provide answers.</p>
<p>For example, we could change the Assessment Unit of interest, modify
the relevant code chunks (potentially including the WQP query if the new
Assessment Unit is in a different HUC or state) and repeat the same
analysis for the same characteristics at a different location. We could
also modify the harmonization reference to group additional comparable
data (if appropriate) or add a step to run
<code>TADA_ConvertResultUnits</code> an additional time outside of
<code>TADA_AutoClean</code> if we wanted to convert temperature results
to deg F for analysis.</p>
<p>Or we could change or add additional characteristics to our analysis.
We could even write additional custom functions or even use functions
from other packages as needed for more complex standards, evaluate
trends, or answer other questions using a TADA dataframe.</p>
<p>The code chunk below displays the elapsed time it took to run the
code chunks and create this document, providing an example of how
incorporating TADA in your workflow can increase efficiency.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">end.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">end.time</span> <span class="op">-</span> <span class="va">start.time</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cristina Mullin, Hillary Marler, Jacob Greif, Elise Hinman, Kenny Wong, Kathryn Willi, Matt Brousil, Kathleen Healy, Justin Bousquin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
